/*!
    Copyright 2009-2010 Jeff Watkins
    
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
    
       http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
    
    --
    
    Portions copyright 2005-2009 Apple Inc.
    
    --
    
    URL Hash implementation based on dojo.hash.
    Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
    Available via Academic Free License >= 2.1 OR the modified BSD license.
    see: http://dojotoolkit.org/license for details
    
    --
    
    Sizzle CSS Selector Engine - v1.0
    Copyright 2009, The Dojo Foundation
    Released under the MIT, BSD, and GPL Licenses.
    More information: http://sizzlejs.com/
*/

if("undefined"!==typeof(coherent)){throw new Error("Library module (coherent) already defined")}var coherent={version:"3.0.0",generateUid:function(){return ++(coherent.__nextUid)},__nextUid:0,globalObject:(function(){return this})()};coherent.Browser={IE:!!(window.attachEvent&&!window.opera)&&(function(){var b=/MSIE (\d+)/;var a=b.exec(navigator.userAgent);return a&&parseInt(a[1],10)})(),Safari:navigator.userAgent.indexOf("AppleWebKit/")>-1,Safari2:(function(){var a=/AppleWebKit\/(\d+(?:\.\d+)?)/;var b=a.exec(navigator.userAgent);return(b&&parseInt(b[1],10)<420)})(),Mozilla:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),SeleniumActive:(-1!==window.name.indexOf("selenium"))};coherent.Support={Properties:("__defineGetter__" in Object.prototype),QuerySelector:("querySelector" in document),Touches:!!document.createTouch,CSS3ColorModel:false,CSSTransitions:false,BorderImage:false,DragAndDrop:!coherent.Browser.SeleniumActive&&((coherent.Browser.Safari&&!coherent.Browser.MobileSafari)||coherent.Browser.IE||(coherent.Browser.Mozilla&&!!window.localStorage))};if(coherent.Support.Properties){coherent.Support.__defineGetter__("CSS3ColorModel",function(){delete this.CSS3ColorModel;var b=document.createElement("span");try{b.style.backgroundColor="rgba(100,100,100,0.5)";return this.CSS3ColorModel=(b.style.length===1)}catch(a){}return(this.CSS3ColorModel=false)});coherent.Support.__defineGetter__("CSSTransitions",function(){delete this.CSSTransitions;var b=document.createElement("span");try{b.style.setProperty("-webkit-transition-duration","1ms","");return this.CSSTransitions=(b.style.length===1)}catch(a){}return(this.CSSTransitions=false)});coherent.Support.__defineGetter__("BorderImage",function(){delete this.BorderImage;var a=document.createElement("div").style;try{a.cssText="-webkit-border-image: inherit; -moz-border-image: inherit;";return this.BorderImage=((a.WebkitBorderImage=="inherit")||(a.MozBorderImage=="inherit"))}catch(b){}return(this.BorderImage=false)})}coherent.typeOf=function(b){if(null===b){return"null"}var a=typeof(b);if("object"!==a&&"function"!==a){return a}return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()};coherent.compareValues=function(f,d){var c=coherent.typeOf(f);if(c!==coherent.typeOf(d)){var a=String(f);var e=String(d);return a.localeCompare(e)}switch(c){case"null":return 0;case"boolean":case"number":var b=(f-d);if(0===b){return b}return(b<0?-1:1);case"regexp":case"function":break;case"string":case"array":case"object":if(f.localeCompare){return f.localeCompare(d)}if(f.compare){return f.compare(d)}break;case"undefined":return true;default:throw new TypeError("Unknown type for comparison: "+c)}return String(f).localeCompare(String(d))};coherent.compareNumbers=function(b,a){return b-a};coherent.reverseCompareNumbers=function(b,a){return a-b};coherent.defineError=function(b){function a(c){this.message=c;this.name=b}a.prototype=new Error;a.prototype.constructor=a;a.prototype.name=b;return a};var InvalidArgumentError=coherent.defineError("InvalidArgumentError");if("undefined"===typeof(window.console)){window.console={}}if("undefined"===typeof(window.console.log)){window.console.log=function(){}}if("undefined"===typeof(window.console.error)){window.console.error=function(){}}if(!Object.keys){Object.keys=function(b){var c=[];for(var a in b){c.push(a)}return c}}if(!Object.getPrototypeOf){if("object"===typeof("test".__proto__)){Object.getPrototypeOf=function(a){return a.__proto__}}else{Object.getPrototypeOf=function(a){return a.constructor.prototype}}}String.prototype.titleCase=function(){return this.charAt(0).toUpperCase()+this.substr(1)};String.prototype.titleCase.displayName="titleCase";if(!String.prototype.trim){String.prototype.trim=function(){var b=this.replace(/^\s+/,"");for(var a=b.length-1;a>0;--a){if(/\S/.test(b.charAt(a))){b=b.substring(0,a+1);break}}return b}}String.prototype.beginsWith=function(a){return a===this.substring(0,a.length)};if(!String.prototype.localeCompare){String.prototype.localeCompare=function(a){if(this<a){return -1}else{if(this>a){return 1}else{return 0}}}}String.prototype.expand=function(c,a){function b(f,d){var e=c[d];if(null===e||"undefined"===typeof(e)){return a}return e}return this.replace(/\$\{(\w+)\}/g,b)};Array.prototype.distinct=function(){var b=this.length;var a=new Array(b);var c;var f;var d=0;for(c=0;c<b;++c){f=this[c];if(-1==a.indexOf(f)){a[d++]=f}}a.length=d;return a};Array.prototype.compare=function(c){var e=this.length-c.length;if(0!==e){return e}var f;var b=this.length;var d;while(b--){if(0!==(d=coherent.compareValues(this[b],c[b]))){return d}}return 0};Array.from=function(a,b){return Array.prototype.slice.call(a,b||0)};if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(0===a&&1===arguments.length){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(0===a&&1===arguments.length){throw new TypeError()}var c=a-1;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c--];break}if(--c<0){throw new TypeError()}}while(true)}for(;c>=0;c--){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.indexOf){Array.indexOf=function(c,b,a){return Array.prototype.indexOf.call(c,b,a)}}if(!Array.lastIndexOf){Array.lastIndexOf=function(c,b,a){return Array.prototype.lastIndexOf.call(c,b,a)}}if(!Array.forEach){Array.forEach=function(c,a,b){return Array.prototype.forEach.call(c,a,b)}}if(!Array.filter){Array.filter=function(c,a,b){return Array.prototype.filter.call(c,a,b)}}if(!Array.map){Array.map=function(c,a,b){return Array.prototype.map.call(c,a,b)}}if(!Array.some){Array.some=function(c,a,b){return Array.prototype.some.call(c,a,b)}}if(!Array.every){Array.every=function(c,a,b){return Array.prototype.every.call(c,a,b)}}if(!Array.reduce){Array.reduce=function(b,a){if(arguments.length>2){return Array.prototype.reduce.apply(b,a,arguments[2])}else{return Array.prototype.reduce.apply(b,a)}}}if(!Array.reduceRight){Array.reduceRight=function(b,a){if(arguments.length>2){return Array.prototype.reduceRight.apply(b,a,arguments[2])}else{return Array.prototype.reduceRight.apply(b,a)}}}Array.from=function(d,e){var b=d.length;var a=[];for(var c=(e||0);c<b;++c){a.push(d[c])}return a};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,b){if("undefined"===typeof(b)){b=0}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a<this.length;a++){if(this[a]===c){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(c,b){if("undefined"===typeof(b)){b=this.length-1}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a>=0;a--){if(this[a]===c){return a}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(c,d){var a=this.length;for(var b=0;b<a;b++){c.call(d,this[b],b,this)}}}if(!Array.prototype.filter){Array.prototype.filter=function(d,e){var a=this.length;var c=[];for(var b=0;b<a;b++){if(d.call(e,this[b],b,this)){c.push(this[b])}}return c}}if(!Array.prototype.map){Array.prototype.map=function(d,e){var a=this.length;var c=[];for(var b=0;b<a;b++){c.push(d.call(e,this[b],b,this))}return c}}if(!Array.prototype.some){Array.prototype.some=function(c,d){var a=this.length;for(var b=0;b<a;b++){if(c.call(d,this[b],b,this)){return true}}return false}}if(!Array.prototype.every){Array.prototype.every=function(c,d){var a=this.length;for(var b=0;b<a;b++){if(!c.call(d,this[b],b,this)){return false}}return true}}if(!Function.prototype.bind){Function.prototype.bind=function(c){var a=this;if(!arguments.length){return a}if(1==arguments.length){return function(){return a.apply(c,arguments)}}var b=Array.from(arguments,1);return function(){return a.apply(c,b.concat(Array.from(arguments)))}}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(c){var a=this;if(1==arguments.length){return function(d){return a.call(c,d||window.event)}}var b=Array.from(arguments);b.shift();return function(d){return a.apply(c,[d||window.event].concat(b))}}}if(!Function.delay){Function.delay=function(e,c,d,b){function a(){a.timer=0;a.fn.apply(a.scope,a.args)}function f(){if(!a.timer){return}window.clearTimeout(a.timer);a.timer=0}a.fn=e;a.args=b||[];a.scope=d||e;a.cancel=f;a.timer=window.setTimeout(a,c);return a}}if(!Function.repeating){Function.repeat=function(d,b,c,a){function f(){f.timer=0;f.fn.apply(f.scope,f.args);f.start()}function e(){if(!f.timer){return}window.clearTimeout(f.timer);f.timer=0}function g(h){if(f.timer){f.cancel()}if(!isNaN(h)){f.delay=h}f.timer=window.setTimeout(f,f.delay)}f.fn=d;f.args=a||[];f.scope=c||d;f.delay=b;f.cancel=e;f.start=g;g();return f}}if(!Function.prototype.delay){Function.prototype.delay=function(d){var b=this;d=d||10;if(arguments.length<2){function a(){b()}return window.setTimeout(a,d)}var c=Array.from(arguments,1);function e(){b.apply(b,c)}return window.setTimeout(e,d)}}if(!Function.prototype.bindAndDelay){Function.prototype.bindAndDelay=function(f,d){var b=this;f=f||b;d=d||10;if(arguments.length<3){function a(){b.call(f)}return window.setTimeout(a,d)}var c=Array.from(arguments,2);function e(){b.apply(f,c)}return window.setTimeout(e,d)}}Function.prototype.sync=function(){var a=arguments.length?this.bind.apply(this,arguments):this;var c={};var b=false;a.stop=function(){b=true};a.waitFor=function(d){if(d in c){c[d]+=1}else{c[d]=1}return function(){if(0!==(c[d]-=1)){return}if(b){return}for(var e in c){if(c[e]){return}}a()}};return a};function Set(){var c=this;if(c.constructor!==Set){c=new Set()}var b=arguments;if(1==b.length&&b[0] instanceof Array){b=b[0]}var a=b.length;while(a--){c[b[a]]=true}return c}Set.union=function(c,b){var a=Object.clone(c);if(!b){return a}var d;for(d in b){a[d]=true}return a};Set.intersect=function(c,b){var a=new Set();var d;for(d in c){if(d in b){a[d]=true}}return a};Set.add=function(b,a){b[a]=true;return b};Set.remove=function(b,a){delete b[a];return b};Set.toArray=function(d){var c;var b=[];for(c in d){b.push(c)}return b};Set.forEach=function(f,c,b){var d;var a=0;for(d in f){c.call(b,d,a++)}};Set.join=function(f,c){var d;var b=[];for(d in f){b.push(d)}return b.join(c||"")};var $S=Set;Object.clone=function(b){var a=(function(){});a.prototype=b;return new a()};Object.get=function(f,b){var e=b||coherent.globalObject;var d=f.split(".");var c;for(var a=0;e&&(c=d[a]);++a){e=e[c]}return e};Object.applyDefaults=function(c,b){c=c||{};if(!b){return c}for(var a in b){if(a in c){continue}c[a]=b[a]}return c};Object.extend=function(c,a){c=c||{};for(var b in a){c[b]=a[b]}return c};Object.markMethods=function(d,b){var a;b=b?(b+"."):"";for(var c in d){a=d[c];if("function"===typeof(a)){a.displayName=b+c}}};Object.merge=function(c,a){var b={};var d;for(d in c){b[d]=c[d]}for(d in a){if(d in b){continue}b[d]=a[d]}return b};(function(){var b=Set("file","submit","image","reset","button");var d={};function e(i,h,j){var g=i[h];var f=coherent.typeOf(g);if("string"===f){i[h]=[g,j]}else{if("array"===f){g.push(j)}else{i[h]=j}}}function c(h){var f=h.name;var g=(h.type||"").toLowerCase();if(h.disabled||g in b){return}if("radio"===g||"checkbox"===g){if(h.checked){e(this,f,h.value)}}else{if(h.multiple){function i(j){if(j.selected){e(this,f,j.value)}}this[f]=[];Array.forEach(h.options,i,this)}else{e(this,f,h.value);if("image"===g){e(this,f+".x",0);e(this,f+".y",0)}}}}Object.fromForm=function(g){var f={};Array.forEach(g.elements,c,f);return f};function a(h){h=h.split("=");if(1===h.length){return}var f=decodeURIComponent(h[0].trim());var g=decodeURIComponent(h[1].trim())||null;e(this,f,g)}Object.fromQueryString=function(g){if("?"==g.charAt(0)){g=g.slice(1)}g=g.split(/\s*&\s*/);var f={};g.forEach(a,f);return f};Object.toQueryString=function(k){if(!k){return""}var h;var j;var f;var g=[];function i(l){if(null!==l&&"undefined"!==typeof(l)){l=encodeURIComponent(l)}else{l=""}if(l){g.push(h+"="+l)}else{g.push(h)}}for(h in k){j=k[h];f=coherent.typeOf(j);if("function"===f||j===d[h]){continue}h=encodeURIComponent(h);if("array"===f){j.forEach(i)}else{i(j)}}return g.join("&")}})();Object.markMethods(Object,"Object");RegExp.escape=function(a){return a.replace(RegExp._escapeRegex,"\\$1")};RegExp.specialCharacters=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];RegExp._escapeRegex=new RegExp("(\\"+RegExp.specialCharacters.join("|\\")+")","g");var Class=(function(){function d(i,l){var j;if(!i&&!l){return i}if(!i){j=function(){return l.apply(this,arguments)}}else{var k=/this\.base/.test(i);if(!k&&!l){return i}if(!k){j=function(){l.call(this);return i.apply(this,arguments)}}else{j=function(){var n=this.base;this.base=l||function(){};var m=i.apply(this,arguments);this.base=n;return m}}}j.valueOf=function(){return i};j.toString=function(){return String(i)};j.displayName="Constructor wrapper";return j}function h(i,j){var k=i.prototype.__factory__.apply(i,j);if("function"!==typeof(k)){throw new Error("Factory function doesn't return a function")}k.__factoryFn__=true;return k}function g(k){if(k.__createFactoryObjects){k.__createFactoryObjects();return}var j;var i;for(j in k.__factories__){i=k[j];if(!i.__factoryFn__){continue}k[j]=i.call(k)}}function c(i,k){if(i&&!(i instanceof Function)){throw new Error("Invalid constructor")}if(k&&!(k instanceof Function)){throw new Error("Invalid superclass")}k=k?k.valueOf():null;i=d(i,k);var j;if(i){i.displayName="Constructor";j=function(){if(!(this instanceof j)){return h(j,arguments)}this.__uid=coherent.generateUid();var l=i.apply(this,arguments);if(l){return l}g(this);if(this.__postConstruct instanceof Function){this.__postConstruct()}return this}}else{j=function(){if(!(this instanceof j)){return h(j,arguments)}this.__uid=this.__uid||coherent.generateUid();g(this);if(this.__postConstruct instanceof Function){this.__postConstruct()}return this}}j.valueOf=function(){return i};j.toString=function(){return String(i||j)};j.displayName="Generated constructor";return j}function b(j){function i(){}i.prototype=j.prototype;return new i()}function f(){}function e(l,j,k){if(!l||!/this\.base/.test(l)){return l}function i(){this.base=k[j]||f;return i.method.apply(this,arguments)}i.valueOf=function(){return l};i.toString=function(){return String(l)};i.method=l;if("__factoryFn__" in l){i.__factoryFn__=l.__factoryFn__}i.displayName=l.displayName||j;return i}function a(j){var i;for(i=j.superclass;i;i=i.superclass){if("__subclassCreated__" in i){i.__subclassCreated__(j)}}}return{create:function(l,j){var i;var k={};switch(arguments.length){case 0:throw new TypeError("Missing superclass and declaration arguments");case 1:j=l;l=undefined;break;default:k=b(l);break}if("function"==typeof(j)){j=j();if(!j){throw new Error("Class declaration function did not return a prototype")}}if(j.hasOwnProperty("constructor")){i=j.constructor;delete j.constructor}i=c(i,l);i.prototype=k;i.prototype.constructor=i;i.superclass=l;if(l){k.__factories__=Object.clone(l.prototype.__factories__)}else{k.__factories__={}}i.__class_id__=coherent.generateUid();this.extend(i,j);a(i);return i},_create:function(l,i){var k={};switch(arguments.length){case 0:throw new TypeError("Missing superclass and declaration arguments");case 1:i=l;l=undefined;break;default:k=b(l);break}var j=f;if(i.hasOwnProperty("constructor")){j=i.constructor;delete i.constructor}j.prototype=k;j.prototype.constructor=j;j.superclass=l;j.__class_id__=coherent.generateUid();Class.extend(j,i);return j},emptyFn:f,addMember:function(j,i,k,m){var l=(k instanceof Function);if(l){k.displayName=i;if(m){k=e(k,i,m)}if(k.__factoryFn__){j.__factories__[i]=k}}j[i]=k;return k},findPropertyName:function(l,i){var j;for(var k in l){j=l[k];if(j===i||("function"===typeof(j)&&j.valueOf()===i)){return k}}return null},extend:(function(){if(coherent.Support.Properties){return function(i,j){var n=i.prototype;var q=i.superclass&&i.superclass.prototype;var k;for(var o in j){var m=j.__lookupGetter__(o);var l=j.__lookupSetter__(o);if(m||l){m&&n.__defineGetter__(o,m);l&&n.__defineSetter__(o,l)}else{Class.addMember(n,o,j[o],q)}}return i}}else{return function(i,j){var k=i.prototype;var m=i.superclass&&i.superclass.prototype;for(var l in j){Class.addMember(k,l,j[l],m)}if(j.toString!=={}.toString){Class.addMember(k,"toString",j.toString,m)}}}})()}})();if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){function a(b){return b<10?"0"+b:b}return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"}}if(!Date.now){Date.now=function(){return(new Date()).valueOf()}}if(isNaN(Date.parse("2010-03-08T17:08:39Z"))){Date._parse=Date.parse;Date.parse=function(b){var a=/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?)?)?$/.exec(b);if(null===a){return Date._parse.apply(this,arguments)}var g=new Date();g.setUTCFullYear(+a[1]);g.setUTCMonth(a[3]?(a[3]>>0)-1:0);g.setUTCDate(a[5]>>0);g.setUTCHours(a[7]>>0);g.setUTCMinutes(a[8]>>0);g.setUTCSeconds(a[10]>>0);g.setUTCMilliseconds(a[12]>>0);if(a[13]&&a[13]!=="Z"){var f=a[16]>>0;var c=a[17]>>0;var e=a[15]==="+";g.setUTCHours((a[7]>>0)+e?-f:f);g.setUTCMinutes((a[8]>>0)+e?-c:c)}return g.valueOf()}}coherent.Array=Class._create({objectAtIndex:function(a){throw new Error("Unimplemented")},count:function(){throw new Error("Unimplemented")},insertObjectAtIndex:function(b,a){throw new Error("Unimplemented")},removeObjectAtIndex:function(a){throw new Error("Unimplemented")},addObject:function(a){throw new Error("Unimplemented")},replaceObjectAtIndexWithObject:function(a,b){throw new Error("Unimplemented")},copy:function(){throw new Error("Unimplemented")},addObjects:function(a){a.forEach(this.addObject,this)},removeObject:function(b){var a=this.indexOfObject(b);if(-1===a){return}this.removeObjectAtIndex(a)},removeObjects:function(d){var a=d.length;var c=[];var b;while(a--){b=this.indexOfObject(d.objectAtIndex(a));if(-1===b){continue}c.push(b)}if(c.length){this.removeObjectsAtIndexes(c)}},insertObjectsAtIndexes:function(b,c){var a=b.length;for(var d=0;d<a;++d){this.insertObjectAtIndex(b[d],c[d])}},objectsAtIndexes:function(c){var b=c.length;var a=new Array(b);for(var d=0;d<b;++d){a[d]=this.objectAtIndex(c[d])}return a},indexOfObject:function(b){var a=this.count();for(var c=0;c<a;++c){if(b===this.objectAtIndex(c)){return c}}return -1},containsObject:function(a){return -1!==this.indexOfObject(a)},forEach:function(c,d){var a=this.count();for(var b=0;b<a;b++){c.call(d,this.objectAtIndex(b),b,this)}},filter:function(e,g){var a=this.count();var c=[];var d;for(var b=0;b<a;b++){d=this.objectAtIndex(b);if(e.call(g,d,b,this)){c.push(d)}}return c},map:function(d,e){var a=this.count();var c=[];for(var b=0;b<a;b++){c.push(d.call(e,this.objectAtIndex(b),b,this))}return c},some:function(c,d){var a=this.count();for(var b=0;b<a;b++){if(c.call(d,this.objectAtIndex(b),b,this)){return true}}return false},every:function(c,d){var a=this.count();for(var b=0;b<a;b++){if(!c.call(d,this.objectAtIndex(b),b,this)){return false}}return true}});(function(){var getTransport=function(){throw new Error("XMLHttpRequest not available.")};if(!coherent.Browser.IE){getTransport=function(){return new XMLHttpRequest()}}else{var progIdCandidates=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];var len=progIdCandidates.length;var progId;var xhr;for(var i=0;i<len;++i){try{progId=progIdCandidates[i];xhr=new ActiveXObject(progId);getTransport=function(){return new ActiveXObject(progId)};break}catch(e){}}}function send(url,method,options){var timeout;function noop(){}function cancel(){if(timeout){window.clearTimeout(timeout)}xhr.onreadystatechange=noop;xhr.abort();XHR.numberOfActiveRequests--}function readyStateChanged(){if(4!==xhr.readyState){return}if(timeout){window.clearTimeout(timeout)}if(!xhrSent){arguments.callee.delay(0);return}var status=xhr.status;var succeeded=(status>=200&&status<300)||304==status;if(0===status||"undefined"===typeof(status)){var protocol=window.location.protocol;succeeded="file:"===protocol||"chrome:"===protocol}var result=xhr.responseText;var err;if(succeeded){if("HEAD"==method){result={};try{var headers=xhr.getAllResponseHeaders();if(headers){headers=headers.split("\n");headers.forEach(function(header){var match=header.match(/^([^:]+):(.+)$/m);var name=match[1].trim();result[name]=match[2].trim()})}}catch(e){}}else{var contentType=options.responseContentType||xhr.getResponseHeader("Content-Type");if(contentType.match(/(?:application\/(?:x-)?json)|(?:text\/json)/)){try{if(""!==result){result=eval("("+result+")")}else{result=null}}catch(e){err=e;succeeded=false}}if(contentType.match(/(?:application|text)\/xml/)){result=xhr.responseXML}}}else{err=new Error("XHR request failed");err.url=url;err.method=method;err.xhr=xhr;err.status=xhr.status;err.statusText=xhr.statusText;err.body=body}if(succeeded){deferred.callback(result)}else{deferred.failure(err)}xhr.onreadystatechange=noop;xhr=null;XHR.numberOfActiveRequests--}var xhr=getTransport();var queryString=Object.toQueryString(options.parameters||{});var body=options.body||"";var async=!options.sync;var deferred=new coherent.Deferred(cancel);var xhrSent=false;method=(method||"GET").toUpperCase();if(!body&&("POST"===method||"PUT"===method)){body=queryString;queryString=""}if("GET"===method&&coherent.Browser.IE&&!options.allowCache){var cache_bust="ie_cache_buster="+(new Date()).getTime();queryString=queryString?(queryString+"&"+cache_bust):cache_bust}if(queryString){var join="";if(-1===url.indexOf("?")){join="?"}else{if("&"!==url.slice(-1)){join="&"}}url=[url,queryString].join(join)}if(options.responseContentType&&xhr.overrideMimeType){xhr.overrideMimeType(options.responseContentType)}if(async){timeout=cancel.delay(options.timeout||30000)}if(options.user){xhr.open(method,url,async,options.user,options.password||"")}else{xhr.open(method,url,async)}var headers=options.headers||{};for(var h in headers){xhr.setRequestHeader(h,headers[h])}if("POST"==method||"PUT"==method){xhr.setRequestHeader("Content-Type",options.contentType||"application/x-www-form-urlencoded")}if(async){xhr.onreadystatechange=readyStateChanged}xhr.send(body);xhrSent=true;if(!async){readyStateChanged()}XHR.numberOfActiveRequests++;return deferred}window.XHR={numberOfActiveRequests:0,get:function(url,parameters,options){return XHR.request("GET",url,parameters,options)},post:function(url,parameters,options){return XHR.request("POST",url,parameters,options)},put:function(url,parameters,options){return XHR.request("PUT",url,parameters,options)},request:function(method,url,parameters,options){method=method.toUpperCase();options=options||{};options.parameters=parameters;return send(url,method,options)}}})();(function(){var assetLookup={};function installCss(css,prefix){css=css.replace(/url\("([^"]*)"\)/g,function(all,relativePath){return'url("'+prefix+relativePath+'")'});var head=document.getElementsByTagName("head")[0];var style=document.createElement("style");style.setAttribute("type","text/css");head.appendChild(style);if(coherent.Browser.IE){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}}function currentAssetPrefix(){var currentUrl=coherent.Scripts.currentScriptUrl();if(this.__currentPrefix&&this.__currentUrl===currentUrl){return this.__currentPrefix}this.__currentUrl=currentUrl;var lastSlash=currentUrl.lastIndexOf("/");return currentUrl.substring(0,lastSlash+1)}coherent.Asset=function(href,content){if(!(this instanceof coherent.Asset)){return new coherent.Asset(href,content)}var prefix=currentAssetPrefix();if("/"!==href.charAt(0)){href=[prefix,href].join("")}if(href in assetLookup){return assetLookup[href]}assetLookup[href]=this;this.href=href;this.dirname=prefix;var lastDot=href.lastIndexOf(".");this.ext=href.substring(lastDot).toLowerCase();this.setContent(content);return this};Class.extend(coherent.Asset,{toString:function(){return this.href},valueOf:function(){return this.href},load:function(sync){var d=XHR.get(this.href,null,{sync:sync,responseContentType:"text/plain"});function received(data){this.setContent(data);return this.__content}d.addCallback(received,this);return d},content:function(){if(!this.__content){this.load(true)}return this.__content},setContent:function(newContent){if(!newContent){this.__content=newContent;return}switch(this.ext){case".json":this.__content=eval("("+newContent+")");break;case".html":this.__content=newContent.replace(/>\s+</g,"><");break;case".js":coherent.Scripts.install(newContent);this.__content=newContent;break;case".css":installCss(newContent,this.dirname);this.__content=newContent;break;default:this.__content=newContent;break}}})})();coherent.strings={"marker.input.multipleValues":"Multiple Values","marker.input.placeholder":"","marker.input.noSelection":"No Selection","marker.text.multipleValues":"Multiple Values","marker.text.placeholder":"","marker.text.noSelection":"No Selection","error.no_description":"An unspecified error occurred.","error.invalid_value":"This value is not valid.","error.invalid_number":"This value is not a valid number."};coherent.localisedString=function(a){return{toString:function(){if(a in coherent.strings){return coherent.strings[a]}console.log("Localisation missing string for key: "+a);return a},toJSON:function(){return this.toString()}}};var _=coherent.localisedString;coherent.Error=Class.create({constructor:function(a){Object.extend(this,a)},description:_("error.no_description"),recoverySuggestion:null,recoveryOptions:null,recoveryAttempter:null});coherent.ChangeType={setting:0,insertion:1,deletion:2,replacement:3,validationError:4};coherent.ChangeNotification=function(d,a,e,c,b){this.object=d;this.changeType=a;this.newValue=e;this.oldValue=c;this.indexes=b;this.notifiedObserverUids={}};coherent.ObserverEntry=Class._create({constructor:function(a,c,b){this.observer=a;this.callback=c;this.context=b},observeChangeForKeyPath:function(b,a){if(!this.callback||!this.observer||this.observer.__uid in b.notifiedObserverUids){return}this.callback.call(this.observer,b,a,this.context)}});coherent.KeyInfo=Class._create({constructor:function(a,d){var c=coherent.KeyInfo.getInfoForKeyOnObject(a,d);this.__uid=[a,coherent.generateUid()].join("_");this.key=a;this.getter=c.methods.get;this.setter=c.methods.set;this.validator=c.methods.validate;this.properties=c.properties;this.mutable=((this.setter||!this.getter)?true:false);if(!this.getter&&!this.setter){this.mutable=true}this.changeCount=0;var b=null;if(this.properties){if(!d.__lookupGetter__(a)){b=this.value=d[a];delete d[a]}else{b=this.value=("value" in c)?c.value:null}if("undefined"===typeof(this.value)){b=this.value=null}}else{b=(a in d)?d[a]:null}if(!b||!b.addObserverForKeyPath){return}coherent.KVO.linkChildToParent(b,d,this)},get:function(b){var a;if(this.getter){a=this.getter.call(b)}else{if(this.properties){a=this.value}else{a=(this.key in b)?b[this.key]:null}}if(a&&a.addObserverForKeyPath){coherent.KVO.linkChildToParent(a,b,this)}else{if(this.parentLink){coherent.KVO.breakParentChildLink(this)}}return a},set:function(b,a){b.willChangeValueForKey(this.key,this);if(this.setter){this.setter.call(b,a)}else{if(this.properties){this.value=("undefined"===typeof(a))?null:a}else{b[this.key]=a}}b.didChangeValueForKey(this.key,this)},validate:function(b,a){if(!this.validator){return a}return this.validator.call(b,a)},unlinkParentLink:function(){if(!this.parentLink){return}this.parentLink.observer=null;this.parentLink.callback=null;this.parentLink=null}});coherent.KeyInfo.getInfoForKeyOnObject=function(n,d){var k=coherent.KeyInfo;var l=coherent.KVO.getClassInfoForObject(d);var p=l&&l.methods[n];if(p){return p}var c=d.constructor;var g=c.prototype;var e=(g==d);var h=(g!=Object.prototype&&g!=coherent.KVO.prototype)?g:d;var o=n.titleCase();var j={get:"get"+o,set:"set"+o,validate:"validate"+o,count:"countOf"+o};var m=null;var b={};var f={};var i=coherent.Support.Properties&&("undefined"!==typeof(b.get=h.__lookupGetter__(n))&&"undefined"!==typeof(b.set=h.__lookupSetter__(n)));if(!i){if(j.get in h){b.get=d[j.get]}else{j.get=n;b.get=d[n]}b.set=d[j.set]}b.validate=d[j.validate];b.count=d[j.count];if(b.count){Object.extend(j,{objectAtIndex:"objectIn"+o+"AtIndex",objectsAtIndexes:n+"AtIndexes",insertObjectAtIndex:"insertObjectIn"+o+"AtIndex",insertObjectsAtIndexes:"insert"+o+"AtIndexes",addObject:"add"+o+"Object",addObjects:"add"+o,removeObject:"remove"+o+"Object",removeObjects:"remove"+o,removeObjectAtIndex:"removeObjectFrom"+o+"AtIndex",removeObjectsAtIndexes:"remove"+o+"AtIndexes",replaceObjectAtIndex:"replaceObjectIn"+o+"AtIndexWithObject",replaceObjectsAtIndexes:"replace"+o+"AtIndexesWith"+o});b.objectAtIndex=d[j.objectAtIndex];b.objectsAtIndexes=d[j.objectsAtIndexes];b.insertObjectAtIndex=d[j.insertObjectAtIndex];b.insertObjectsAtIndexes=d[j.insertObjectsAtIndexes];b.addObject=d[j.addObject];b.addObjects=d[j.addObjects];b.removeObject=d[j.removeObject];b.removeObjects=d[j.removeObjects];b.removeObjectAtIndex=d[j.removeObjectAtIndex];b.removeObjectsAtIndexes=d[j.removeObjectsAtIndexes];b.replaceObjectAtIndex=d[j.replaceObjectAtIndex];b.replaceObjectsAtIndexes=d[j.replaceObjectsAtIndexes]}else{if("function"!==typeof(b.get)){m=b.get;b.get=b.set=null;i=coherent.Support.Properties;if(i){k.createWrappedPropertyMethodsForKey(f,n)}}else{if(b.get){if(b.get.__key===n){f.get=b.get;b.get=b.get.originalMethod}else{f.get=k.wrapMethod(k.wrapGetMethod,b.get,n)}}if(b.set){if(b.set.__key===n){f.set=b.set;b.set=b.set.originalMethod}else{f.set=k.wrapMethod(k.wrapSetMethod,b.set,n)}}}}f.validate=b.validate;f.properties=i;if(i){if(h.hasOwnProperty(n)){m=h[n];delete h[n]}h.__defineGetter__(n,f.get);h.__defineSetter__(n,f.set)}else{if(b.get){if(d.hasOwnProperty(j.get)){d[j.get]=f.get}else{h[j.get]=f.get}if(b.set){if(d.hasOwnProperty(j.set)){d[j.set]=f.set}else{h[j.set]=f.set}}}}for(var a in j){if(!f[a]||f[a]===d[a]){continue}f[a].displayName=j[a];if("get"===a||"set"===a){continue}if(d.hasOwnProperty(a)){d[a]=f[a]}else{h[a]=f[a]}}return l.methods[n]={value:m,methods:b,properties:i}};coherent.KeyInfo.createWrappedPropertyMethodsForKey=function(a,b){function c(){var f=this.infoForKey(c.__key);var e=f.value;if(e&&e.addObserverForKeyPath){coherent.KVO.linkChildToParent(e,this,f)}else{if(f.parentLink){coherent.KVO.breakParentChildLink(f)}}return e}function d(f){var e=d.__key;var g=this.infoForKey(e);this.willChangeValueForKey(e,g);if("undefined"===typeof(f)){f=null}g.value=f;this.didChangeValueForKey(e,g);return f}a.get=c;a.set=d;a.get.__key=b;a.set.__key=b;return a};coherent.KeyInfo.wrapMethod=function(d,c,b){var a=d();a.valueOf=function(){return c};a.toString=function(){return String(c)};a.__key=b;a.originalMethod=c;return a};coherent.KeyInfo.wrapSetMethod=function(){function a(c){var d=this.infoForKey(a.__key);this.willChangeValueForKey(a.__key,d);var b=a.originalMethod.call(this,c);this.didChangeValueForKey(a.__key,d);return b}return a};coherent.KeyInfo.wrapGetMethod=function(){function a(){var b=a.originalMethod.call(this);var c=this.__kvo.keys[a.__key];if(!c){return b}if(b&&b.addObserverForKeyPath){coherent.KVO.linkChildToParent(b,this,c)}else{if(c.parentLink){coherent.KVO.breakParentChildLink(c)}}return b}return a};Object.markMethods(coherent.KeyInfo);coherent.KeyPathTrie=Class._create({constructor:function(){this.root={value:null,children:{}}},add:function(a,g){var f,e,d=this.root;if("string"===typeof(a)){a=a.split(".")}for(var c=0,b=a.length;c<b;c++){e=a[c];f=d.children;if(e in f){d=f[e]}else{d=f[e]={value:null,children:{}}}}d.value=g},find:function(a){var e,d=this.root;if("string"===typeof(a)){a=a.split(".")}for(var c=0,b=a.length;c<b;c++){e=a[c];if(!(d=d.children[e])){return null}}return d.value},findByPrefix:function(a){var e,d=this.root;if("string"===typeof(a)){a=a.split(".")}for(var c=0,b=a.length;c<b;c++){e=a[c];if(e in d.children){d=d.children[e]}else{return{value:d.value,remainder:a.slice(c)}}}return{value:d.value,remainder:[]}},getValuesWithPrefix:function(f){if("string"===typeof(f)){f=f.split(".")}var j,c,a=this.root;for(var e=0,k=f.length;e<k;e++){j=f[e];if(!(a=a.children[j])){return[]}}var d,h=[a],g=[];while(h.length>0){d=h.pop();if(d.value){g.unshift(d.value)}c=d.children;for(var b in c){h.push(c[b])}}return g}});coherent.KVO=Class.create({constructor:function(c){this.initialiseKeyValueObserving();var a;if(!c){return}for(var b in c){a=c[b];if("function"===typeof(a)){this[b]=a}else{this.setValueForKey(a,b)}}},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}},setValueForKeyPath:function(c,d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"===typeof(d)){d=d.split(".")}var b=d.shift();if(!d.length){this.setValueForKey(c,b);return}if("@"===b.charAt(0)){return}var a=this.valueForKey(b);if(!a){return}a.setValueForKeyPath(c,d)},setValueForKey:function(b,a){if(!a||0===a.length){throw new InvalidArgumentError("key may not be empty")}var c=this.infoForKey(a);if(!c||!c.mutable){return}c.set(this,b)},valueForKeyPath:function(e){if(!e||0===e.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"===typeof(e)){e=e.split(".")}var d=e.shift();if(!e.length){return this.valueForKey(d)}if("@"===d.charAt(0)){var b=d.substr(1);var a=this.valueForKeyPath(e);return coherent.ArrayOperator[b](a)}var c=this.valueForKey(d);if("undefined"===typeof(c)||null===c){return undefined}return c.valueForKeyPath(e)},valueForKey:function(a){if(!a||0===a.length){throw new InvalidArgumentError("the key is empty")}var b=this.infoForKey(a);if(!b){return null}return b.get(this)},validateValueForKeyPath:function(c,d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(d)){d=d.split(".")}var b=d.shift();if(!d.length){return this.validateValueForKey(c,b)}var a=this.valueForKey(b);if("undefined"===typeof(a)||null===a){return c}return a.validateValueForKeyPath(c,d)},validateValueForKey:function(b,a){if(!a||!a.length){throw new InvalidArgumentError("missing key")}var c=this.infoForKey(a);return c.validate(this,b)},observeChildObjectChangeForKeyPath:function(d,c,a){if(coherent.KVO.kAllPropertiesKey!==c){c=[a,".",c].join("")}else{c=a}var b=d.object;d.object=this;this.notifyObserversOfChangeForKeyPath(d,c);d.object=b},infoForKeyPath:function(c){if(!c||0===c.length){throw new InvalidArgumentError("keyPath is empty")}if("string"==typeof(c)){c=c.split(".")}var b=c.shift();if(!c.length){return this.infoForKey(b)}if("@"===b.charAt(0)){return{mutable:false}}var a=this.valueForKey(b);if(!a){return undefined}if(!a.infoForKeyPath){return undefined}return a.infoForKeyPath(c)},infoForKey:function(a){if(coherent.KVO.kAllPropertiesKey==a){return null}if(!this.__kvo){this.initialiseKeyValueObserving()}var b=this.__kvo.keys;if(a in b){return b[a]}return b[a]=new coherent.KeyInfo(a,this)},setKeysTriggerChangeNotificationsForDependentKey:function(e,d){if(!e||!e.length){throw new InvalidArgumentError("keys array is not valid")}if(!d){throw new InvalidArgumentError("dependentKey can not be null")}if(-1!==d.indexOf(".")){throw new InvalidArgumentError("dependentKey may not be a key path")}if("string"===typeof(e)){e=[e]}var h;var g=(this.constructor.prototype===this);if(g){h=coherent.KVO.getClassInfoForObject(this).dependentKeys}else{if(!this.__kvo){this.initialiseKeyValueObserving()}h=this.__kvo.dependentKeys}var a=coherent.KeyInfo.getInfoForKeyOnObject;var c;var b=e.length;var f;while(b--){c=e[b];if(!c){throw new InvalidArgumentError("key at index "+b+" was null")}if(g){a(c,this)}else{this.infoForKey(c)}if(c in h){f=h[c]}else{f=(h[c]=[])}if(-1==f.indexOf(d)){f.push(d)}}},initialiseKeyValueObserving:function(){if(!this.hasOwnProperty("__uid")){this.__uid=coherent.generateUid()}coherent.KVO.createInstanceDataForObject(this)},addObserverForKeyPath:function(a,f,e,b){if(!e||0===e.length){throw new InvalidArgumentError("keyPath is empty")}if(!a){throw new InvalidArgumentError("Observer may not be null")}if(!a.hasOwnProperty("__uid")){a.__uid=coherent.generateUid()}if(!f){f=a.observeChangeForKeyPath}if("string"===typeof(f)){f=a[f]}if(!f){throw new InvalidArgumentError("Missing callback method")}if(!this.__kvo){this.initialiseKeyValueObserving()}var c=this.__kvo.observers;if(!c[e]){this.infoForKeyPath(e);c[e]=[]}this.__kvo.keypathTrie.add(e,e);var d=new coherent.ObserverEntry(a,f,b);c[e].push(d)},removeObserverForKeyPath:function(b,f){if(!f||0===f.length){throw new InvalidArgumentError("keyPath may not be empty")}if(!b){throw new InvalidArgumentError("Observer may not be null")}if(!this.__kvo){this.initialiseKeyValueObserving()}var c=this.__kvo.observers;if(!c[f]){return}var e=c[f];var a=e.length;var d;while(a--){d=e[a];if(d.observer==b){e.splice(a,1);return}}},willChangeValueForKey:function(a,b){if(!this.__kvo){return}if(!a){throw new InvalidArgumentError("key may not be null")}b=(b&&"get" in b)?b:this.infoForKey(a);if(!b){return}if(1!==++b.changeCount){return}b.previousValue=b.get(this)},forceChangeNotificationForKey:function(a,b){if(!a){throw new InvalidArgumentError("key may not be null")}b=(b&&"get" in b)?b:this.infoForKey(a);if(!b){return}if(0!==b.changeCount){return}b.changeCount=1;this.didChangeValueForKey(a,b)},didChangeValueForKey:function(c,g){if(!this.__kvo){return}if(!c){throw new InvalidArgumentError("key may not be null")}g=(g&&"get" in g)?g:this.infoForKey(c);if(!g){return}if(0!==--g.changeCount){return}var d=g.get(this);var b=g.previousValue;g.previousValue=null;if(d!==b){var f=new coherent.ChangeNotification(this,coherent.ChangeType.setting,d,b);this.notifyObserversOfChangeForKeyPath(f,c);if(b&&b.addObserverForKeyPath){coherent.KVO.unlinkChildFromParent(b,this,g)}if(d&&d.addObserverForKeyPath){coherent.KVO.linkChildToParent(d,this,g)}}var e=this.__kvo.dependentKeys[c];var a=e&&e.length;while(a--){g=this.infoForKey(e[a]);if(0!==g.changeCount){continue}g.changeCount=1;this.didChangeValueForKey(g.key,g)}},notifyObserversOfChangeForKeyPath:function(i,t){if(!t){throw new InvalidArgumentError("keyPath may not be null")}if(!this.__kvo){return}var c=this.__kvo.observers;var e;var r;var p;var n;if((r=c[coherent.KVO.kAllPropertiesKey])){var l=i.notifiedObserverUids;l[this.__uid]=true;for(e in r){n=r[e];if(!n.observer||l[n.observer.__uid]){continue}n.callback.call(n.observer,i,t,n.context)}l[this.__uid]=false}if(coherent.KVO.kAllPropertiesKey===t){return}if((r=c[t])&&(p=r.length)){while(p--){n=r[p];n.callback.call(n.observer,i,t,n.context)}}var g=t.length+1;var a;var b;var k=i.newValue;var m=i.oldValue;var u=i.object;var f=i.indexes;var q;var j;var d;if(null===m||"undefined"===typeof(m)||!m.valueForKey){m=null}if(null===k||"undefined"===typeof(k)||!k.valueForKey){k=null}if(m===null&&k===null){return}var s=this.__kvo.keypathTrie.getValuesWithPrefix(t);var h=s.length;if(h&&s[h-1].length===t.length){h--}while(h--){b=s[h];r=c[b];if(!(p=r&&r.length)){continue}a=b.substr(g);q=m&&m.valueForKeyPath(a);j=k&&k.valueForKeyPath(a);if(m&&q===j){continue}d=new coherent.ChangeNotification(u,i.changeType,j,q,f);while(p--){n=r[p];n.callback.call(n.observer,d,b,n.context)}}}});coherent.KVO.kAllPropertiesKey="*";coherent.KVO.keysToIgnore=$S("__kvo","__keysToIgnore","__mutableKeys","__factories__");coherent.KVO.typesOfKeyValuesToIgnore=$S("string","number","boolean","date","regexp","function");coherent.KVO.Proxy=Class._create(coherent.KVO,{constructor:function(a){this.__original=a;this.initialiseKeyValueObserving()},valueForKey:function(a){var b=this.__kvo.keys;if(a in b){return b[a].get(this)}return this.__original.valueForKey(a)}});coherent.KVO.adapt=function(b){if(!b){throw new InvalidArgumentError("Can't adapt a null object")}var a;for(a in coherent.KVO.prototype){if(a in b){continue}b[a]=coherent.KVO.prototype[a]}if("keyDependencies" in b&&!("__dependentKeys" in b)){var c=b.keyDependencies;for(a in c){b.setKeysTriggerChangeNotificationsForDependentKey(c[a],a)}}return b};coherent.KVO.adaptTree=function(c){coherent.KVO.adapt(c);var b;var a;for(b in c){if(b in coherent.KVO.keysToIgnore){continue}a=c[b];if(!a){continue}if(coherent.typeOf(a) in coherent.KVO.typesOfKeyValuesToIgnore){continue}coherent.KVO.adaptTree(a)}return c};coherent.KVO.mutableKeys=function(c){var e=[];var b;var a;var d;if("__mutableKeys" in c&&c.__mutableKeys.concat){return c.__mutableKeys}var f=Set.union(coherent.KVO.keysToIgnore,c.__keysToIgnore);for(b in c){if(b in f||"__"===b.substr(0,2)){continue}a=c[b];if("function"!==typeof(a)){e.push(b);continue}if(1!==a.length||"set"!==b.substr(0,3)){continue}d=b.charAt(3);if(d!==d.toUpperCase()){continue}b=d.toLowerCase()+b.substr(4);if(-1===e.indexOf(b)){e.push(b)}}return e};coherent.KVO.__subclassCreated__=function(a){var d=a.superclass.prototype;var b=a.prototype;if(d.keyDependencies===b.keyDependencies){return}var e=b.keyDependencies||{};for(var c in e){b.setKeysTriggerChangeNotificationsForDependentKey(e[c],c)}};coherent.KVO.classInfo={};coherent.KVO.getClassInfoForObject=function(a){var b=a.constructor.__class_id__;if(!b||b===coherent.KVO.__class_id__){return{dependentKeys:{},methods:{},keypathTrie:new coherent.KeyPathTrie()}}var c=coherent.KVO.classInfo[b];if(c){return c}return coherent.KVO.classInfo[b]={dependentKeys:{},methods:{},keypathTrie:new coherent.KeyPathTrie()}};coherent.KVO.createInstanceDataForObject=function(a){var c=coherent.KVO.getClassInfoForObject(a);if(Object.getPrototypeOf(a)===a){throw new Error("creating instance data for a prototype")}var b=a.__kvo=Object.clone(c);b.observers={};b.keys={};return b};coherent.KVO.linkChildToParent=function(g,e,f,c){if(!g.hasOwnProperty("__kvo")){g.initialiseKeyValueObserving()}var d=g.__kvo.observers;var b=d[coherent.KVO.kAllPropertiesKey]||(d[coherent.KVO.kAllPropertiesKey]={});c=c||f.__uid;if(c in b){return}var a=new coherent.ObserverEntry(e,e.observeChildObjectChangeForKeyPath,f?f.key:"");b[c]=a;if(!f){return}if(f.parentLink){coherent.KVO.breakParentChildLink(f)}f.parentLink=a};coherent.KVO.unlinkChildFromParent=function(f,d,e,b){if(!f.hasOwnProperty("__kvo")){f.initialiseKeyValueObserving()}var c=f.__kvo.observers;var a=c[coherent.KVO.kAllPropertiesKey];if(!a){return}b=b||e.__uid;if(e&&e.parentLink===a[b]){coherent.KVO.breakParentChildLink(e)}delete a[b]};coherent.KVO.breakParentChildLink=function(a){if(!a||!a.parentLink){return}a.parentLink.observer=null;a.parentLink.callback=null;a.parentLink=null};Object.markMethods(coherent.KVO);coherent.Bindable=Class.create(coherent.KVO,{constructor:function(a){this.bindings={};this.__context=coherent.dataModel;this.__copyParameters(a||{})},__createFactoryObjects:function(){var a=coherent.dataModel;var c=this.__context;coherent.dataModel=this.__context=this;var d;var b;for(d in this.__factories__){b=this[d];if(!b.__factoryFn__){continue}this[d]=b.call(this)}coherent.dataModel=a;this.__context=c},exposedBindings:[],maskedBindings:[],defaultPlaceholders:{},defaultPlaceholderForMarkerWithBinding:function(b,c){var a=this.defaultPlaceholders[c];if(!a){return null}return a[b]||null},__createObserverMethod:function(b){function a(c){if(coherent.ChangeType.setting!==c.changeType){return}this.setValueForKey(c.newValue,b)}return a},bindNameToObjectWithKeyPath:function(b,a,f){var c;var e;var d={};if(!this.bindings){this.bindings={}}c=this["observe"+b.titleCase()+"Change"]||this.__createObserverMethod(b);if(this.bindings[b]){this.bindings[b].unbind()}if("object"===typeof(f)){Object.extend(d,f);f=d.keypath}Object.extend(d,coherent.Binding.bindingInfoFromString(f));if("transformedValue" in d){d.transformer={transformedValue:d.transformedValue,reverseTransformedValue:d.reverseTransformedValue||null};delete d.transformValue;delete d.reverseTransformedValue}d.name=b;d.object=a;d.observer=this;d.observerFn=c;e=new coherent.Binding(d);e.bind();this.bindings[b]=e},__postConstruct:function(){this.setupBindings();if(this.init){this.init()}this.updateBindings()},__copyParameters:function(c){if(!c){return}var d;var a;var e;var b=coherent.KVO.adaptTree;for(d in c){if(-1!==d.search(/Binding$/)){continue}a=c[d];if("object"===coherent.typeOf(a)&&!("addObserverForKeyPath" in a)){b(a)}e="set"+d.titleCase();if(e in this){this[e](a)}else{this[d]=a}}this.__parameters=c},bindingInfoForName:function(a){if(!this.__parameters){return null}return this.__parameters[a+"Binding"]},setupBindings:function(){var e=this.exposedBindings;var c=e.length;var f;var a;var d;for(d=0;d<c;++d){a=e[d];f=this.bindingInfoForName(a);if(!f){continue}this.bindNameToObjectWithKeyPath(a,this.__context,f)}},updateBindings:function(){var f=this.bindings;var e=this.exposedBindings;var c=e.length;var a;var d;for(d=0;d<c;++d){a=f[e[d]];if(!a){continue}a.update()}},unbind:function(){for(var a in this.bindings){this.bindings[a].unbind()}}});coherent.Bindable.__subclassCreated__=function(c){var e=c.superclass.prototype;var d=c.prototype;if(d.hasOwnProperty("defaultPlaceholders")){var b=Object.clone(e.defaultPlaceholders);d.defaultPlaceholders=Object.extend(b,d.defaultPlaceholders)}if(e.exposedBindings===d.exposedBindings&&!d.maskedBindings){return}var a=(e.maskedBindings===d.maskedBindings)?{}:$S(d.maskedBindings);function f(h){return !(h in a)}var g=e.exposedBindings.filter(f);if(e.exposedBindings!==d.exposedBindings){g=g.concat(d.exposedBindings.filter(f))}d.exposedBindings=g};coherent.ValueTransformer=Class.create({constructor:function(){if(arguments.length==1&&"object"===typeof(arguments[0])){Object.extend(this,arguments[0])}},transformedValue:function(a){return a},reverseTransformedValue:function(a){return a},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}}});coherent.ValueTransformer.__subclassCreated__=function(a){var c=coherent.ValueTransformer.prototype;var b=a.prototype;if(c.reverseTransformedValue==b.reverseTransformedValue){a.prototype.reverseTransformedValue=null}};coherent.transformer={};coherent.transformerInstances={};coherent.findTransformerWithName=function(transformerName){var valueTransformer=coherent.transformerInstances[transformerName.toLowerCase()];if(valueTransformer){return valueTransformer}if(-1===transformerName.indexOf(".")){valueTransformer=coherent.transformer[transformerName]}if(!valueTransformer){try{valueTransformer=eval(transformerName)}catch(e){}}if(!valueTransformer){throw new InvalidArgumentError("The transformerName argument does not specify a valid ValueTransformer: "+transformerName)}if("function"!==typeof(valueTransformer)){return valueTransformer}if(valueTransformer.__factoryFn__){valueTransformer=valueTransformer()}else{valueTransformer=new valueTransformer()}return valueTransformer};coherent.registerTransformerWithName=function(b,a){if(!b.transformedValue){throw new InvalidArgumentError("The valueTransformer argument does not support the ValueTransformer method transformedValue")}a=a.toLowerCase();coherent.transformerInstances[a]=b};Object.extend(coherent,{NoSelectionMarkerType:"noSelection",MultipleValuesMarkerType:"multipleValues",NullValueMarkerType:"nullValue"});coherent.Binding=Class._create({constructor:function(a){Object.extend(this,a);if("string"===typeof(this.transformer)){this.transformer=coherent.findTransformerWithName(this.transformer)}if("function"===typeof(this.transformer)){if(this.transformer.__factoryFn__){this.transformer=this.transformer()}else{this.transformer=new this.transformer()}}this.refresh()},bind:function(){this.object.addObserverForKeyPath(this,this.observeChangeForKeyPath,this.keypath)},unbind:function(){this.object.removeObserverForKeyPath(this,this.keypath)},refresh:function(){var a=this.object.valueForKeyPath(this.keypath);this.cachedModelValue=a;a=this.transformedValue(a);this.markerType=this.markerTypeFromValue(a);if(this.markerType){if((this.markerType+"Placeholder") in this){a=this[this.markerType+"Placeholder"]}else{a=this.observer.defaultPlaceholderForMarkerWithBinding(this.markerType,this.name)}}this.cachedValue=a},transformedValue:function(a){if(!this.transformer){return a}if("array"!==coherent.typeOf(a)){return this.transformer.transformedValue(a)}return a.map(this.transformer.transformedValue,this.transformer)},reverseTransformedValue:function(a){if(!this.transformer){return a}if(!this.transformer.reverseTransformedValue){return undefined}if("array"!==coherent.typeOf(a)){return this.transformer.reverseTransformedValue(a)}return a.map(this.transformer.reverseTransformedValue,this.transformer)},validateProposedValue:function(c){if(this.transformer&&!this.transformer.reverseTransformedValue){throw new Error("Can't validate a value when the transformer doesn't have a reverseTransformedValue method")}var b=this.reverseTransformedValue(c);var a=this.object.validateValueForKeyPath(b,this.keypath);if(a instanceof coherent.Error){return a}if(a===b){return c}return this.transformedValue(a)},setValue:function(b){if(this.cachedValue===b){return}this.markerType=this.markerTypeFromValue(b);this.cachedValue=b;if(this.transformer&&!this.transformer.reverseTransformedValue){return}var a=this.reverseTransformedValue(b);this.cachedModelValue=a;var c=this.updating;this.updating=true;this.object.setValueForKeyPath(a,this.keypath);this.updating=c},mutable:function(){if(this.transformer&&!this.transformer.reverseTransformedValue){return false}var a=this.object.infoForKeyPath(this.keypath);return a&&a.mutable},value:function(){return this.cachedValue},update:function(){var b=this.value();var c=new coherent.ChangeNotification(this.object,coherent.ChangeType.setting,b);this.updating=true;try{this.observerFn.call(this.observer,c,this.keypath)}catch(a){console.error('Exception while bindng "'+this.name+'" to keypath "'+this.keypath+' ": '+a)}this.updating=false},observerFn:function(c,a,b){},markerTypeFromValue:function(a){if(null===a||"undefined"===typeof(a)||""===a){return coherent.NullValueMarkerType}if(coherent.Markers.MultipleValues===a){return coherent.MultipleValuesMarkerType}if(coherent.Markers.NoSelection===a){return coherent.NoSelectionMarkerType}return null},placeholderValue:function(a){var b;a=a||this.markerType;if((a+"Placeholder") in this){b=this[a+"Placeholder"]}else{b=this.observer.defaultPlaceholderForMarkerWithBinding(a,this.name)}if("function"===typeof(b)){b=b.call(this.object)}return b},observeChangeForKeyPath:function(h,a,b){if(this.updating&&h.newValue===this.cachedModelValue){return}if(coherent.ChangeType.setting===h.changeType){this.cachedModelValue=h.newValue}var f=this.transformedValue(h.newValue);this.markerType=this.markerTypeFromValue(f);if(this.markerType){f=this.placeholderValue()}var c=Object.clone(h);c.newValue=f;if(coherent.ChangeType.setting===h.changeType){this.cachedValue=f}var g=this.updating;this.updating=true;try{this.observerFn.call(this.observer,c,a,b)}catch(d){console.error('Exception while bindng "'+this.name+'" to keypath "'+this.keypath+' ": '+d)}this.updating=g}});coherent.Binding.bindingRegex=/^(.*?)(?:\((.*)\))?$/;coherent.Binding.compoundRegex=/^\s*([^&|].*?)\s*(\&\&|\|\|)\s*(\S.+)\s*$/;coherent.Binding.bindingInfoFromString=function(b){var a;var c;a=b.match(coherent.Binding.bindingRegex);if(!a||a.length<3){throw new InvalidArgumentError("bindingString isn't in correct format")}var d={keypath:a[1]};if(a[2]){d.transformer=coherent.findTransformerWithName(a[2])}return d};Object.markMethods(coherent.Binding);var Colour=Class._create({constructor:function(f,e,c,d){this.r=f||0;this.g=e||0;this.b=c||0;this.a=d||1},toString:function(){return[this.r,this.g,this.b,this.a].join(",")},subtract:function(a){return new Colour(this.r-a.r,this.g-a.g,this.b-a.b,this.a-a.a)}});Colour.transparent=new Colour(255,255,255,0);Colour.black=new Colour(0,0,0,1);Colour.white=new Colour(255,255,255,1);Colour.fromString=function(b){if(typeof(b)!="string"){return b}b=b.toLowerCase();if(b in Colour){return Colour[b]}var a;if((a=b.match(/^rgb(?:a)?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d(?:\.\d+)?)\s*)?\)$/i))){return new Colour(parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10),parseInt(a[4]||1,10))}if("#"!==b.charAt(0)){throw new Error("Invalid colour: "+b)}if(4==b.length){return new Colour(parseInt(b.charAt(1)+b.charAt(1),16),parseInt(b.charAt(2)+b.charAt(2),16),parseInt(b.charAt(3)+b.charAt(3),16))}else{return new Colour(parseInt(b.substr(1,2),16),parseInt(b.substr(3,2),16),parseInt(b.substr(5,2),16))}};function IndexRange(d,a){var c;var e=[];if(1==arguments.length&&d.length){a=d.length-1;d=0}if(d>a){var b=a;a=d;d=b}for(c=d;c<=a;++c){e.push(c)}return e}Class.extend(Array,{containsObject:function(a){return -1!==this.indexOf(a)},objectAtIndex:function(a){return this[a]},count:function(){return this.length},valueForKey:function(c){if(!c||0===c.length){throw new InvalidArgumentError("the key is empty")}if("@count"==c){return this.length}var d=new Array(this.length);var a=this.length;var b;while(a--){b=this[a];d[a]=b?b.valueForKey(c):null}return d},setValueForKey:function(c,b){if(!b||0===b.length){throw new InvalidArgumentError("key is empty")}var a=this.length;while(a--){this[a].setValueForKey(c,b)}},infoForKey:function(b){var d;if(coherent.KVO.kAllPropertiesKey==b){return null}if(!this.__kvo){this.initialiseKeyValueObserving()}d=this.__kvo.keys[b];if(d){return d}var c=new Array(this.length);var a=this.length;while(a--){c[a]=this[a].infoForKey(b)}return null},indexesOfObjects:function(e){var d;var b=e.length;var a=[];var c;for(d=0;d<b;++d){if(-1===(c=this.indexOf(e[d]))){continue}a.push(c)}return a},addObject:function(b){var a=this.length;var c=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,[b],null,[a]);this.push(b);this.observeElementAtIndex(a);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},addObjects:function(h){var b=h.length;var f=this.length;var c=[];var a=[];var g=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,c,null,a);for(var e=0;e<b;++e){var d=h[e];this.push(d);this.observeElementAtIndex(f);c.push(d);a.push(f++)}this.notifyObserversOfChangeForKeyPath(g,coherent.KVO.kAllPropertiesKey)},insertObjectAtIndex:function(b,a){if(a<0||a>=this.length){throw new RangeError("index must be within the bounds of the array")}var c=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,[b],null,[a]);this.splice(a,0,b);this.observeElementAtIndex(a);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},insertObjectsAtIndexes:function(e,c){if(e.length!==c.length){throw new InvalidArgumentError("length of objects and indexes parameters must be equal")}var a=e.length;var d;var b;for(d=0;d<a;++d){b=c[d];this.splice(b,0,e[d]);this.observeElementAtIndex(b)}var f=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,e,null,c);this.notifyObserversOfChangeForKeyPath(f,coherent.KVO.kAllPropertiesKey)},replaceObjectAtIndexWithObject:function(c,b){var a=this[c];this[c]=b;var d=new coherent.ChangeNotification(this,coherent.ChangeType.replacement,[b],[a],[c]);this.notifyObserversOfChangeForKeyPath(d,coherent.KVO.kAllPropertiesKey)},replaceObjectsAtIndexesWithObjects:function(d,f){var b=[];var a=f.length;var e;var c;for(e=0;e<a;++e){c=d[e];b[e]=this[c];this.stopObservingElementAtIndex(c);this[c]=f[e];this.observeElementAtIndex(c)}var g=new coherent.ChangeNotification(this,coherent.ChangeType.replacement,f,null,d);this.notifyObserversOfChangeForKeyPath(g,coherent.KVO.kAllPropertiesKey)},removeObject:function(b){var a=this.indexOf(b);if(-1===a){return}this.removeObjectAtIndex(a)},removeObjects:function(e){var a=e.length;var c=[];var b;for(var d=0;d<a;++d){b=this.indexOf(e[d]);if(-1===b){continue}c.push(b)}if(c.length){this.removeObjectsAtIndexes(c)}},removeObjectsAtIndexes:function(d){var c;var e=d.sort(coherent.reverseCompareNumbers);var a=d.length;var b=[];for(c=0;c<a;++c){var f=e[c];this.stopObservingElementAtIndex(f);b.push(this[f]);this.splice(f,1)}var g=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,b,e);this.notifyObserversOfChangeForKeyPath(g,coherent.KVO.kAllPropertiesKey)},removeObjectsInRange:function(c,f){if(0===f){return}if(!f){if(c.splice){f=c[1];c=c[0]}else{if(c.location){f=c.length;c=c.location}}}var b=c+f;var e=[];for(var d=c;d<b;++d){this.stopObservingElementAtIndex(d);e.push(d)}var a=this.splice(c,f);var g=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,a,e);this.notifyObserversOfChangeForKeyPath(g,coherent.KVO.kAllPropertiesKey)},removeObjectAtIndex:function(b){if(b<0||b>=this.length){throw new RangeError("index must be within the bounds of the array")}this.stopObservingElementAtIndex(b);var a=this.splice(b,1);var c=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,a,[b]);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},removeAllObjects:function(){var d;var c=[];var a=this.length;c.length=a;for(d=0;d<a;++d){this.stopObservingElementAtIndex(d);c[d]=d}var b=this.splice(0,a);var e=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,b,c);this.notifyObserversOfChangeForKeyPath(e,coherent.KVO.kAllPropertiesKey)},objectsAtIndexes:function(c){var d;var b=[];var a=c.length;b.length=c.length;for(d=0;d<a;++d){b[d]=this[c[d]]}return b},observeChildObjectChangeForKeyPath:function(f,e,b){var d=f.object;var c=this.indexOf(d);if(!this.__uid){this.initialiseKeyValueObserving()}if(-1===c){coherent.KVO.unlinkChildFromParent(d,this,null,this.__uid);return}var a=new coherent.ChangeNotification(d,coherent.ChangeType.replacement,[f.newValue],[f.oldValue],[c]);a.notifiedObserverUids=Object.clone(f.notifiedObserverUids);this.notifyObserversOfChangeForKeyPath(a,e)},observeElementAtIndex:function(a){var b=this[a];if(!b||!b.addObserverForKeyPath){return}if(!this.__uid){this.initialiseKeyValueObserving()}coherent.KVO.linkChildToParent(b,this,null,this.__uid)},stopObservingElementAtIndex:function(a){var b=this[a];if(!b||!b.addObserverForKeyPath){return}if(!this.__uid){this.initialiseKeyValueObserving()}coherent.KVO.unlinkChildFromParent(b,this,null,this.__uid)},initialiseKeyValueObserving:function(){coherent.KVO.prototype.initialiseKeyValueObserving.call(this);var b;var a=this.length;for(b=0;b<a;++b){this.observeElementAtIndex(b)}}});coherent.KVO.adapt(Array.prototype);Array.prototype.indexOfObject=Array.prototype.indexOf;Array.prototype.copy=Array.prototype.concat;coherent.ArrayOperator={avg:function(a){return this.sum(a)/a.length},count:function(a){throw new InvalidArgumentError("@count operator must end the keyPath")},distinctUnionOfArrays:function(a){return this.unionOfArrays(a).distinct()},distinctUnionOfObjects:function(a){return a.distinct()},max:function(d){var b=null;var e;var a;var c;for(e=0,a=d.length;e<a;++e){c=d[e];if(null===b||c>b){b=c}}return b},min:function(c){var e=null;var d;var a;var b;for(d=0,a=c.length;d<a;++d){b=c[d];if(null===e||b<e){e=b}}return e},sum:function(b){var d=0;var a=b.length;var c;for(c=0;c<a;++c){d+=b[c]}return d},unionOfArrays:function(b){var d=[];var a;var c;for(c=0,a=b.length;c<a;++c){d=d.concat(b[c])}return d},unionOfObjects:function(a){return a}};Object.extend(coherent,{dataModel:new coherent.KVO(),registerModelWithName:function(b,a){coherent.dataModel.setValueForKey(b,a)},unregisterModelWithName:function(a){delete coherent.dataModel[a]}});coherent.Scripts={extract:function(b){var c=RegExp("(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)","img");var a=[];var d=new String(b.replace(c,function(){a.push(arguments[1]);return""}));d.scripts=a;return d},install:function(d,b){if(!d){return}var c=document.getElementsByTagName("head").item(0);var a=document.createElement("script");if(coherent.Browser.IE){a.text=d}else{a.appendChild(document.createTextNode(d))}a.type="text/javascript";a.defer=false;window.__filename__=b;c.appendChild(a);window.__filename__=null},currentScriptUrl:function(){if(window.__filename__){return window.__filename__}var a=document.getElementsByTagName("script");if(!a||!a.length){throw new Error("Could not find script")}var b=a.length;var c;while(b--){c=a[b];if(c.src){return c.src}}return null}};coherent.SortDescriptor=Class.create({constructor:function(d,a,b){this.keyPath=d;this.ascending=a;this.comparisonFn=b||this.defaultCompare;var c=typeof(this.comparisonFn);if("string"!=c&&"function"!=c){throw new InvalidArgumentError("comparisonFn must be either the name of a method or a function reference")}},resolveComparisonFn:function(b){var a=this.comparisonFn;if("string"===typeof(a)){a=b[a]}if("function"!==typeof(a)){throw new TypeError("comparisonFn does not resolve to a function")}return a},compareObjects:function(c,b){if(!c.valueForKeyPath||!b.valueForKeyPath){throw new InvalidArgumentError("Objects are not Key Value compliant")}var e=c.valueForKeyPath(this.keyPath);var d=b.valueForKeyPath(this.keyPath);var a=this.resolveComparisonFn(e);return a.call(e,d)},defaultCompare:function(a){return coherent.compareValues(this,a)},reversedSortDescriptor:function(){return new coherent.SortDescriptor(this.keyPath,!this.ascending,this.comparisonFn)}});coherent.SortDescriptor.comparisonFunctionFromDescriptors=function(b){var c=b.length;if(!c){return null}else{return function a(g,f){var e;var d;for(e=0;e<c;++e){d=b[e].compareObjects(g,f);if(0===d){continue}if(!b[e].ascending){d*=-1}return d>0?1:-1}return 0}}};var CancelledError=coherent.defineError("CancelledError");var InvalidStateError=coherent.defineError("InvalidStateError");(function(){var c=-1;var a=0;var b=1;coherent.Deferred=Class.create({constructor:function(d){this.canceller=d;this._result=null;this._status=c;this._callbacks=[]},_fire:function(d){while(this._callbacks.length){this._status=(d instanceof Error)?b:a;this._result=d;var e=this._callbacks.shift();var g=e[this._status];var f=e[2];if(!g){continue}d=g.call(f,d);if(d instanceof coherent.Deferred){d.addMethods(this._fire,this._fire,this);return}}this._status=(d instanceof Error)?b:a;this._result=d},result:function(){return this._result},cancel:function(){if(c!==this._status){throw new InvalidStateError("Can not cancel Deferred because it is already complete")}var d=(this.canceller&&this.canceller());if(!(d instanceof Error)){d=new CancelledError("Deferred operation cancelled")}this.failure(d)},addMethods:function(e,f,d){this._callbacks.push([e,f,d]);if(c===this._status){return this}this._fire(this._result);return this},addCallback:function(e,d){return this.addMethods(e,null,d)},addErrorHandler:function(e,d){return this.addMethods(null,e,d)},callback:function(d){if(c!==this._status){throw new InvalidStateError("Can not signal callback because Deferred is already complete: result="+d)}this._fire(d)},failure:function(d){if(c!==this._status){throw new InvalidStateError("Can not signal failure because Deferred is already complete: error="+d)}this._fire(d)}})})();function URL(b){this.url=b.trim();var c=(/^(([^\:\/\?#]+)\:)?(\/\/([^\/\?#]*))?([^\?#]*)(\?([^#]*))?(#(.*))?$/);var a=this.url.match(c)||[];this.protocol=(a[2]||"").toLowerCase();this.authority=a[4]||"";this.path=a[5].trim()||"";this.query=a[7]||"";this.fragment=a[9]||"";c=(/^(([^@]+)@)?([^\:]+)(:(.+))?$/);a=this.authority.match(c);this.userInfo=a[2]||"";this.host=a[3]||"";this.port=a[5]||""}coherent.transformer.Boolean=Class.create(coherent.ValueTransformer,{constructor:function(a,b){this.trueValue=a;this.falseValue=b},transformedValue:function(a){return(a==this.trueValue)},reverseTransformedValue:function(a){return(a?this.trueValue:this.falseValue)}});coherent.transformer.FirstObject=Class.create(coherent.ValueTransformer,{transformedValue:function(a){if("array"!==coherent.typeOf(a)){return a}return a[0]}});coherent.transformer.Generic=Class.create(coherent.ValueTransformer,{constructor:function(a,b){this.modelValues=a;this.displayValues=b},transformedValue:function(b){var a=this.modelValues.indexOf(b);var c;if(-1==a){return c}else{return this.displayValues[a]}},reverseTransformedValue:function(b){var a=this.displayValues.indexOf(b);var c;if(-1==a){return c}else{return this.modelValues[a]}}});coherent.transformer.Matches=Class.create(coherent.ValueTransformer,{constructor:function(a){this.trueRegex=a},transformedValue:function(a){return this.trueRegex.test(a)}});coherent.transformer.Not=Class.create(coherent.ValueTransformer,{transformedValue:function(a){return(a?false:true)},reverseTransformedValue:function(a){return(a?false:true)}});coherent.registerTransformerWithName(new coherent.transformer.Not(),"not");coherent.transformer.StringToObject=Class.create(coherent.ValueTransformer,{constructor:function(a){this.key=a||"string"},transformedValue:function(b){if("string"!==typeof(b)){return b}var a=new coherent.KVO();a[this.key]=b;return a},reverseTransformedValue:function(a){return a&&(this.key in a)?a[this.key]:a}});coherent.registerTransformerWithName(new coherent.transformer.StringToObject("string"),"StringToObject");coherent.transformer.Trim=Class.create(coherent.ValueTransformer,{compressWhitespace:false,transformedValue:function(a){if("string"!==typeof(a)){return a}if(this.compressWhitespace){return a.trim().replace(/\s+/g," ")}return a.trim()},reverseTransformedValue:function(a){if("string"!==typeof(a)){return a}if(this.compressWhitespace){return a.trim().replace(/\s+/g," ")}return a.trim()}});coherent.registerTransformerWithName(new coherent.transformer.Trim(),"trim");coherent.transformer.Truncate=Class.create(coherent.ValueTransformer,{constructor:function(a){this.max=a||50},ellipsis:String.fromCharCode(8230),transformedValue:function(c){if(!c&&0!==c){return c}c=""+c;var a=c.length;if(a<=this.max){return c}var b=this.max/2-2;return[c.substr(0,b),this.ellipsis,c.substr(a-b)].join(" ")}});coherent.registerTransformerWithName(new coherent.transformer.Truncate(50),"truncated");coherent.Controller=Class.create(coherent.Bindable,{registerWithName:function(a){if(!a){return}this.name=a;coherent.registerModelWithName(this,a)}});(function(){var a=this.Element;this.Element={};Object.extend(this.Element,a||{})}).call(window);Object.extend(Element,{uniqueId:function(){return"coherent_id_"+Element.assignId.uniqueId++},assignId:function(a){return a.id||(a.id=("coherent_id_"+Element.assignId.uniqueId++))},contains:function(a,b){return a==b||!!(a.compareDocumentPosition(b)&16)},regexForClassName:function(a){var b=Element.__regexLookup||(Element.__regexLookup={});if(a in b){return b[a]}return(b[a]=new RegExp("(^|\\s)"+a+"(\\s|$)"))},hasClassName:function(a,b){var c=a.className;if(!c){return false}if(c==b){return true}return Element.regexForClassName(b).test(c)},addClassName:function(a,b){if(!b){return}if(Element.hasClassName(a,b)){return}a.className+=" "+b},removeClassName:function(a,b){if(!a||!b){return}var c=Element.regexForClassName(b);a.className=a.className.replace(c," ").trim()},replaceClassName:function(b,c,a){if(!c){return}if(!a){Element.removeClassName(b,c);return}var d=Element.regexForClassName(c);b.className=b.className.replace(d,"$1"+a+"$2").trim()},toggleClassName:function(a,b){if(!b){return}var c=Element.regexForClassName(b);var d=a.className;if(c.test(d)){a.className=d.replace(c," ").trim()}else{a.className+=" "+b}},updateClass:function(f,g,c){var e=$S(f.className.split(" "));var h=Set.add;var b=Set.remove;var d;var a;if("string"===typeof(g)){h(e,g)}else{a=g.length;while(a--){h(e,g[a])}}if("string"===typeof(c)){b(e,c)}else{a=c.length;while(a--){b(e,c[a])}}f.className=Set.join(e," ")},PROPERTIES:["backgroundColor","backgroundPosition","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","color","display","fontSize","letterSpacing","lineHeight","opacity","width","height","top","bottom","left","right","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft"],getStyles:function(d,c){var e={};var b=window.getComputedStyle(d,null);if("string"===typeof(c)){return d.style[c]||b[c]||null}c=c||Element.PROPERTIES;var f;var a=c.length;while(a--){f=c[a];e[f]=d.style[f]||b[f]||null}return e},setStyle:function(a,b,c){a.style[b]=c},setStyles:function(a,b){var c=a.style;for(var d in b){c[d]=b[d]}},getDimensions:function(e){var g=Element.getStyle(e,"display");if(g&&g!="none"){return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}var b=e.style;var f=b.visibility;var c=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="block";var d={width:e.offsetWidth,height:e.offsetHeight,left:e.offsetLeft,top:e.offsetTop};b.display=a;b.position=c;b.visibility=f;return d},set3PiecesBorderImage:function(g,b,e,j){if(coherent.Support.BorderImage){g.style.borderWidth=b?"0px "+j+"px 0px "+e+"px ":"0px";var k=b?"url("+b+") 0 "+j+" 0 "+e+" repeat stretch":"";g.style.webkitBorderImage=k;g.style.MozBorderImage=k}else{if(!b){g.innerHTML="";return}var a=document.createElement("div");var f=a.style;f.position="absolute";f.top="0px";f.bottom="0px";var l=a.cloneNode(false);l.style.left="0px";l.style.right="0px";var c=a.cloneNode(false);var d=c.style;d.backgroundImage="url("+b+")";d.backgroundRepeat="no-repeat";var h=c.cloneNode(false);var i=h.style;d.left="0px";d.width=e+"px";i.right="0px";i.width=j+"px";i.backgroundPosition="100% 0px";f.left=e+"px";f.right=j+"px";f.backgroundImage="url("+b.replace(/.png/,"__mid.png")+")";f.backgroundRepeat="repeat-x";if(g.firstChild){g.insertBefore(l,g.firstChild)}else{g.appendChild(l)}l.appendChild(c);l.appendChild(a);l.appendChild(h)}},clone:function(a){return a.cloneNode(true)},depthFirstTraversal:function(d,e,c){if(!d||!e){return}var a=d.nextSibling||d.parentNode;var b;c=c||e;while(d!==a){if(1===d.nodeType){b=e.call(c,d);if(false!==b&&d.firstChild){d=d.firstChild;continue}}while(!d.nextSibling){d=d.parentNode;if(d===a){return}}d=d.nextSibling}},query:function(b,a){if("undefined"===typeof(a)){a=b;b=document}else{if(b!==document){a=["#",Element.assignId(b)," ",a].join("")}}return b.querySelector(a)},queryAll:function(b,a){if("undefined"===typeof(a)){a=b;b=document}else{if(b!==document){a=["#",Element.assignId(b)," ",a].join("")}}return Array.from(b.querySelectorAll(a))},getViewport:function(){var b=document.documentElement;var a=document.body;return{left:window.scrollLeft||b.scrollLeft||a.scrollLeft,top:window.scrollTop||b.scrollTop||a.scrollTop,width:window.innerWidth||b.clientWidth||a.clientWidth,height:window.innerHeight|b.clientHeight||a.clientHeight}},scrollParent:function(f){var e;var c=Element.getStyles;var a=document.body;while(f&&f!=a){e=c(f,["overflow","overflowX","overflowY"]);for(var b in e){var d=e[b];if("auto"==d||"scroll"==d){return f}}f=f.parentNode}return f},getRect:function(p,n){if(!p){return null}var r=document.documentElement;var m=document.body;var d=0;var o=0;if(p!=document.body&&p.getBoundingClientRect){var l=p.getBoundingClientRect();l={left:l.left,right:l.right,top:l.top,bottom:l.bottom};if(!n){l.left+=Math.max(r.scrollLeft,m.scrollLeft);l.right+=Math.max(r.scrollLeft,m.scrollLeft);l.top+=Math.max(r.scrollTop,m.scrollTop);l.bottom+=Math.max(r.scrollTop,m.scrollTop)}l.left-=r.clientLeft;l.right-=r.clientLeft;l.top-=r.clientTop;l.bottom-=r.clientTop;l.width=l.right-l.left+1;l.height=l.bottom-l.top+1;return l}var j=p.parentNode;var f=p;var a=p.offsetParent;var k=coherent.Browser.Mozilla;var q=coherent.Browser.Safari&&!coherent.Browser.Safari2;var b=coherent.Browser.Safari2;var h=Element.getStyles;var g=Element.getDimensions(p);var c=("fixed"===Element.getStyles(p,"position"));var i;d+=p.offsetLeft;o+=p.offsetTop;while(!c&&a){d+=a.offsetLeft;o+=a.offsetTop;if(k&&!((/^t(able|d|h)$/i).test(a.tagName))||q){i=h(a,["borderLeftWidth","borderTopWidth"]);d+=parseInt(i.borderLeftWidth||0,10);o+=parseInt(i.borderTopWidth||0,10)}if(!c){c=("fixed"===h(a,"position"))}if("BODY"!==a.tagName){f=a}a=a.offsetParent}var e=k?["display","overflow","borderLeftWidth","borderTopWidth"]:["display"];while(j&&j.tagName&&"BODY"!==j.tagName&&"HTML"!==j.tagName){i=h(j,e);if(!((/^inline|table.*$/i).test(i.display))){d-=j.scrollLeft;o-=j.scrollTop}if(k&&"visible"!=i.overflow){d+=parseInt(i.borderLeftWidth||0,10);o+=parseInt(i.borderTopWidth||0,10)}j=j.parentNode}var s=h(f,"position");if((b&&(c||s=="absolute"))||(k&&s!="absolute")){d-=m.offsetLeft;o-=m.offsetTop}if(n===true&&!c){d-=Math.max(r.scrollLeft,m.scrollLeft);o-=Math.max(r.scrollTop,m.scrollTop)}return{left:d,top:o,right:d+g.width-1,bottom:o+g.height-1,width:g.width,height:g.height}},fromPoint:function(d,c){if(coherent.Browser.Safari){var b=document.documentElement;var a=document.body;d+=window.scrollLeft||b.scrollLeft||a.scrollLeft;c+=window.scrollTop||b.scrollTop||a.scrollTop}var f=document.elementFromPoint(d,c);return f}});Element.getStyle=Element.getStyles;Element.assignId.uniqueId=1;if(!coherent.Support.QuerySelector){coherent.Asset("sizzle.js").load();Object.extend(Element,{query:function(b,a){if(1==arguments.length){a=b;b=document}return(Sizzle(a,b)[0]||null)},queryAll:function(b,a){if(1==arguments.length){a=b;b=document}return(Sizzle(a,b)||null)}})}if("undefined"===typeof(document.documentElement.children)){HTMLElement.prototype.__defineGetter__("children",function(){var b=[];var a=this.childNodes.length;var c;while(a--){c=this.childNodes[a];if(Node.ELEMENT_NODE!==c.nodeType){continue}b.unshift(c)}return b})}if("undefined"===typeof(document.documentElement.innerText)){HTMLElement.prototype.__defineGetter__("innerText",function(){return this.textContent});HTMLElement.prototype.__defineSetter__("innerText",function(a){this.textContent=a})}(function(){var a=this.Event;this.Event={};Object.extend(this.Event,a||{})}).call(window);Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_HELP:47,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_NUMPAD_MULTIPLY:106,KEY_NUMPAD_PLUS:107,KEY_NUMPAD_ENTER:108,KEY_NUMPAD_MINUS:109,KEY_NUMPAD_PERIOD:110,KEY_NUMPAD_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145,isNumpadNumKey:function(a){return a>=96&&a<=111},isAlphaNumKey:function(a){if(!this._reverseKeys){this._reverseKeys=(function(){var d={};var c=Event;for(var b in c){if("KEY_"!==b.slice(0,4)){continue}d[c[b]]=b}return d})()}return this.isNumpadNumKey(a)||!this._reverseKeys[a]},_domHasFinishedLoading:function(){if(arguments.callee.done){return}arguments.callee.done=true;if(this._domLoadedTimer){window.clearInterval(this._domLoadedTimer)}Event.stopObserving(window,"load",Event._domHasFinishedLoading);var c=Event._readyCallbacks;var a=c.length;var b;for(b=0;b<a;++b){c[b]()}Event._readyCallbacks=null},observe:function(c,a,b){if("on"==a.slice(0,2)){a=a.slice(2)}c.addEventListener(a,b,false);if(!b.displayName){b.displayName=a+" event observer"}return b},stopObserving:function(c,a,b){if(!c||!a||!b){return null}if("on"==a.slice(0,2)){a=a.slice(2)}c.removeEventListener(a,b,false);return b},stop:function(a){a.preventDefault();a.stopPropagation()},preventDefault:function(a){a.preventDefault()},onDomReady:function(a){if(Event._domHasFinishedLoading.done){window.setTimeout(a,0);return}if(!Event._readyCallbacks){document.addEventListener("DOMContentLoaded",Event._domHasFinishedLoading,false);function b(){if((/loaded|complete/).test(document.readyState)){Event._domHasFinishedLoading()}}if(coherent.Browser.Safari){Event._domLoadedTimer=window.setInterval(b,10)}Event.observe(window,"load",Event._domHasFinishedLoading);Event._readyCallbacks=[]}Event._readyCallbacks.push(a)}});Object.markMethods(Event,"Event");coherent.Style={PREFIX:"ui-",kSelectedClass:"ui-selected",kDisabledClass:"ui-disabled",kReadOnlyClass:"ui-readonly",kMarkerClass:"ui-placeholder",kFocusClass:"ui-focused",kHoverClass:"ui-hover",kAscendingClass:"ui-sort-ascending",kDescendingClass:"ui-sort-descending",kActiveClass:"ui-active",kUpdatingClass:"ui-updating",kFadingClass:"ui-hidden",kInvalidValueClass:"ui-invalid",kInsertedClass:"ui-inserted",kDeletedClass:"ui-deleted",kReplacingClass:"ui-replacing",kLoadingClass:"ui-loading",kFirstClass:"ui-first",kLastClass:"ui-last",kDragAndDropCopy:"ui-drag-and-drop-copy",kDragAndDropMove:"ui-drag-and-drop-move",kDragAndDropLink:"ui-drag-and-drop-link",kDragAndDropNo:"ui-drag-and-drop-no",kInactiveWindow:"ui-window-inactive",kOutlineExpanded:"ui-outline-expanded",kOutlineLeaf:"ui-outline-leaf",kOutlineLevelPrefix:"ui-outline-level-",kOutlineDisclosureButton:"ui-outline-disclosure-button",kOverlayAbove:"ui-overlay-above",kOverlayBelow:"ui-overlay-below",kOverlayLeft:"ui-overlay-left",kOverlayRight:"ui-overlay-right"};window.FIRST_RESPONDER="__first_responder__";coherent.Responder=Class.create(coherent.Bindable,{sendActionToView:function(b,a){if(FIRST_RESPONDER===a){a=coherent.page.firstResponder}var c=a||coherent.page.firstResponder||this;while(c){if(b in c){c[b](this);return true}c=c.nextResponder()}return false},acceptsFirstResponder:function(){return false},becomeFirstResponder:function(){return true},resignFirstResponder:function(){return true},nextResponder:function(){return this.__nextResponder||null},setNextResponder:function(a){this.__nextResponder=a},presentError:function(b){this.willPresentError(b);if(!("field" in b)){b.field=this}var a=this.nextResponder();if(a){return a.presentError(b)}return false},clearAllErrors:function(b){var a=this.nextResponder();if(a){a.clearAllErrors(b||this)}},willPresentError:function(a){},onfocus:function(a){var b=this.nextResponder();if(b){b.onfocus(a)}},onblur:function(a){var b=this.nextResponder();if(b){b.onblur(a)}},onchange:function(a){},onsubmit:function(a){},onreset:function(a){},onmousedown:function(a){var b=this.nextResponder();if(b){b.onmousedown(a)}},onmouseup:function(a){var b=this.nextResponder();if(b){b.onmouseup(a)}},onmousedrag:function(a){var b=this.nextResponder();if(b){b.onmousedrag(a)}},onmouseenter:function(a){var b=this.nextResponder();if(b){b.onmouseenter(a)}},onmouseleave:function(a){var b=this.nextResponder();if(b){b.onmouseleave(a)}},onclick:function(a){var b=this.nextResponder();if(b){b.onclick(a)}},ondblclick:function(a){var b=this.nextResponder();if(b){b.ondblclick(a)}},onkeydown:function(a){var b=this.nextResponder();if(b){b.onkeydown(a)}},onkeyup:function(a){var b=this.nextResponder();if(b){b.onkeyup(a)}},onkeypress:function(a){var b=this.nextResponder();if(b){b.onkeypress(a)}},ontouchstart:function(a){var b=this.nextResponder();if(b){b.ontouchstart(a)}},ontouchmove:function(a){var b=this.nextResponder();if(b){b.ontouchmove(a)}},ontouchend:function(a){var b=this.nextResponder();if(b){b.ontouchend(a)}},onswipe:function(a){var b=this.nextResponder();if(b){b.onswipe(a)}},ondragstart:function(a){var b=this.nextResponder();if(b){b.ondragstart(a)}}});(function(){function a(b){return parseInt(b||"",10)||0}coherent.DragAndDropHelper=function(){};coherent.DragAndDropHelper.prototype={initFakeDragAndDrop:function(e,d){var f=Element.clone(e);var c=Element.getRect(e,true);var b=Element.getStyles(e,["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","opacity"]);f.style.position="fixed";f.style.top=c.top+"px";f.style.left=c.left+"px";f.style.width=(c.width-a(b.borderLeftWidth)-a(b.borderRightWidth)-a(b.paddingLeft)-a(b.paddingRight))+"px";f.style.heigh=(c.height-a(b.borderTopWidth)-a(b.borderBottomWidth)-a(b.paddingTop)-a(b.paddingBottom))+"px";e.parentNode.appendChild(f);this.node=f;this.originalNode=e;this.offset={left:c.left-d.clientX,top:c.top-d.clientY};this.classname=e.className;this.rect=c;this.viewport=Element.getViewport();this.originalScroll=this.getScrollOffset(c.left,c.top)},getScrollOffset:function(d,c){var e;var b;if(c<0){b=c}else{b=c+this.rect.height-this.viewport.height;if(b<0){b=0}}if(d<0){e=d}else{e=d+this.rect.width-this.viewport.width;if(e<0){e=0}}return{scrollX:e,scrollY:b}},emptyFn:function(){},onmousemove:function(b){var c=(b.clientX+this.offset.left);var i=(b.clientY+this.offset.top);var d=this.node;d.style.left=c+"px";d.style.top=i+"px";var f=this.getScrollOffset(c,i);if(!f.scrollX){this.originalScroll.scrollX=0}if(!f.scrollY){this.originalScroll.scrollY=0}var l=!this.originalScroll.scrollX&&f.scrollX;var k=!this.originalScroll.scrollY&&f.scrollY;window.scrollBy(l,k);var h=d.style.display;d.style.display="none";var j=Element.fromPoint(b.clientX,b.clientY);d.style.display=h;var g={target:j,clientX:b.clientX,clientY:b.clientY,preventDefault:this.emptyFn,dataTransfer:b.dataTransfer||{}};if(j!==this.overNode){coherent.page._ondragenter(g);this.overNode=j}else{coherent.page._ondragover(g)}var e=null;switch(coherent.page._draggingLastDropEffect){case"copy":e=coherent.Style.kDragAndDropCopy;break;case"move":e=coherent.Style.kDragAndDropMove;break;case"link":e=coherent.Style.kDragAndDropLink;break;case"none":default:e=coherent.Style.kDragAndDropNo;break}if(e){d.className=this.classname+" "+e}if(!coherent.Support.DragAndDrop){Event.preventDefault(b)}},cleanup:function(){if(this.node){this.node.parentNode.removeChild(this.node)}this.node=null},onmouseup:function(b){this.cleanup();if(coherent.Support.DragAndDrop){return}var c={target:this.overNode,clientX:b.clientX,clientY:b.clientY,dataTransfer:{},preventDefault:this.emptyFn};coherent.page._ondrop(c);coherent.page._ondragend(c)}}})();coherent.View=Class.create(coherent.Responder,{exposedBindings:["visible","class","enabled","editable","html","text","toolTip","argument"],defaultPlaceholders:{text:{multipleValues:_("marker.text.multipleValues"),nullValue:_("marker.text.placeholder"),noSelection:_("marker.text.noSelection")},html:{multipleValues:_("marker.text.multipleValues"),nullValue:_("marker.text.placeholder"),noSelection:_("marker.text.noSelection")}},animationOptions:{"class":{},visible:{classname:coherent.Style.kFadingClass,reverse:true},enabled:{classname:coherent.Style.kDisabledClass,reverse:true},editable:{classname:coherent.Style.kReadOnlyClass,reverse:true},focus:{classname:coherent.Style.kFocusClass},text:{classname:coherent.Style.kUpdatingClass},html:{classname:coherent.Style.kUpdatingClass}},defaultAnimationOptions:{duration:200},formatter:null,target:null,action:null,sendActionOn:["click"],constructor:function(b,a){if((null===b||"undefined"===typeof(b))&&this.markup){this.node=coherent.View.createNodeFromMarkup(this.markup);this.id=Element.assignId(this.node)}else{if("string"===typeof(b)){this.id=b;this.node=document.getElementById(this.id);if(!this.node){throw new Error("Node not found for ID: "+this.id)}}else{if(1===b.nodeType){this.id=Element.assignId(b);this.node=b}else{throw new Error("Unexpected value for node: ",+b)}}}if(this.id in coherent.View.viewLookup){throw new Error("Two views share the same ID: "+this.id)}this.node.object=this;coherent.View.viewLookup[this.id]=this;if(this.formatter&&"function"===typeof(this.formatter)){if(this.formatter.__factoryFn__){this.formatter=this.formatter()}else{this.formatter=new (this.formatter)()}}this.base(a);this.__createStructure()},__createStructure:function(){var e=this.node;var c;var f;if(this.innerHTML&&""===String(e.innerHTML).trim()){e.innerHTML=this.innerHTML}var a=coherent.dataModel;var d=this.__context;coherent.dataModel=this.__context=this;var b=this.structure()||{};for(f in b){c=b[f];if(c&&"function"==typeof(c)&&(c=c.valueOf()).__factoryFn__){c.call(this,f)}}this.__context=d;coherent.dataModel=a},teardown:function(){for(var a in this.bindings){this.bindings[a].unbind()}if(this.node){this.node.object=null}delete this.node;delete coherent.View.viewLookup[this.id]},__factory__:function(b,f,d){var a=this;var e=Element.queryAll;if("string"!==typeof(b)){d=f;f=b;b=null}f=f||{};function c(h){var g=coherent.View.fromNode(h)||new a(h,f);if("action" in f&&!f.target){g.target=this}}return function(h){if(h&&1===h.nodeType){return new a(h,f)}var i=d||(this?this.node:document);var g=e(i,b||h);if(!g.length){return null}Array.forEach(g,c,this);return coherent.View.fromNode(g[0])}},init:function(){},structure:function(){return this.__structure__},viewElement:function(){return this.node||document.getElementById(this.id)},container:function(){return this.__container||this.node},setContainer:function(a){this.__container=a;return a},wrap:function(b,d){var c=this.node;var a=document.createElement(b||"span");a.classname=d;c.parentNode.replaceChild(a,c);a.appendChild(c);return(this.__container=a)},superview:function(){var b=this.node;if(!b){return null}var a=null;while(b&&!a){b=b.parentNode;if(!b){return null}if(document==b){return coherent.page}a=coherent.View.fromNode(b)}return a},isDescendantOf:function(b){if(!b){return false}var a=b.node;var c=this.node;return Element.contains(a,c)},addSubview:function(b){var a=this.container();a.appendChild(b.node)},viewWithSelector:function(a){var b=Element.query(this.node,a);return coherent.View.fromNode(b)},nextResponder:function(){return this.__nextResponder||this.superview()},delegate:function(){return this.__delegate},setDelegate:function(b){if("string"!==typeof(b)){this.__delegate=b;return}var a=this.__context&&this.__context.valueForKey(b);if(a){this.__delegate=a;return}this.delegate=function(){this.__delegate=(this.__context&&this.__context.valueForKey(b));if(this.__delegate){delete this.delegate}return this.__delegate}},focus:function(){this.node.focus()},blur:function(){this.node.blur()},"class":function(){return this.node.className},setClass:function(b){var c=this.node;var f=c.className;var g=$S((b||"").split(" "));var a=coherent.Style.PREFIX.length;function d(h){if(h.slice(0,a)===coherent.Style.PREFIX){Set.add(g,h)}}f.split(" ").forEach(d);b=Set.join(g," ");if(b===f){return}var e=this.__animationOptionsForProperty("class");if(e.duration){coherent.Animator.setClassName(c,b,e)}else{c.className=b}},addClassName:function(b,a){if(a){coherent.Animator.addClassName(this.node,b,a)}else{Element.addClassName(this.node,b)}},removeClassName:function(b,a){if(a){coherent.Animator.removeClassName(this.node,b,a)}else{Element.addClassName(this.node,b)}},animateClassName:function(b,a){var c=("reverse" in b);if(c){var d=b.reverse;b.reverse=a?!b.reverse:b.reverse}else{b.reverse=!!a}coherent.Animator.animateClassName(this.node,b);if(!c){delete b.reverse}else{b.reverse=d}},sendAction:function(){if(!this.action){return}var a=this.target||this;if(FIRST_RESPONDER===a){a=coherent.page.firstResponder}else{if("string"===typeof(a)){a=this.__context.valueForKeyPath(a)}}var b=this.argument||null;if("string"!==typeof(this.action)){this.action.call(a,this,b);return}var c=this.action;while(a){if(c in a){a[c](this,b);return}a=a.nextResponder()}},onclick:function(a){if(this.disabled){Event.stop(a);return}if(!this.action){this.base(a);return}if(this.sendActionOn.containsObject("click")){this.sendAction()}Event.stop(a)},addTrackingInfo:function(a){coherent.page.addTrackingInfo(this.id,a)},__animationOptionsForProperty:function(c){var a=this.animate&&this.animate[c];var b=typeof(a);if(!a){a={duration:0}}else{if("boolean"===b){a={}}else{if("number"===b){a={duration:a}}else{a=Object.clone(a)}}}if(c in this.animationOptions){Object.applyDefaults(a,this.animationOptions[c])}else{throw new Error("No default animation options specified for property: "+c)}Object.applyDefaults(a,this.defaultAnimationOptions);return a},__animatePropertyChange:function(h,i){var b=this.node;var e=this.__animationOptionsForProperty(h);var c=coherent.Animator;var g=this;function a(){i.cleanup.call(g,b,e)}function f(){i.update.call(g,b,e);e.reverse=!i.reverse;e.callback=i.cleanup?a:null;c.animateClassName(b,e)}function d(){if(i.setup){i.setup.call(g,b,e)}if("reverse" in e){if(i.reverse){e.reverse=!e.reverse}}else{e.reverse=!!i.reverse}if(i.update){e.callback=f}else{e.callback=i.cleanup?a:null}c.animateClassName(b,e)}if(!e.duration){d()}else{d.delay(0)}},visible:function(){return"none"!==Element.getStyle(this.node,"display")},setVisible:function(a){this.__animatePropertyChange("visible",{setup:function(c,b){if(!a){return}if(b.duration){Element.addClassName(c,b.classname||b.add)}c.style.display=""},cleanup:function(c,b){c.style.display=a?"":"none";if(a){return}if(b.duration){Element.removeClassName(c,b.classname||b.add)}},reverse:!a})},enabled:function(){return !this.node.disabled},setEnabled:function(a){this.__animatePropertyChange("enabled",{reverse:!a,cleanup:function(b){b.disabled=!a}})},editable:function(){return !this.node.readOnly},setEditable:function(a){this.__animatePropertyChange("editable",{reverse:!a,cleanup:function(b){b.readOnly=!a}})},text:function(){var a=this.node;return a.textContent||a.innerText},setText:function(a){this.__animatePropertyChange("text",{update:function(b){b.innerHTML="";b.appendChild(document.createTextNode(a))}})},observeTextChange:function(g,f,c){var b=this.node;var e=this.bindings.text;var a=e&&e.markerType;var d=g.newValue;if(a){if(null===d||"undefined"===typeof(d)){d=""}Element.addClassName(b,coherent.Style.kMarkerClass)}else{Element.removeClassName(b,coherent.Style.kMarkerClass);if(this.formatter){d=this.formatter.stringForValue(d)}}this.setText(d)},html:function(){return this.node.innerHTML},setHtml:function(a){this.__animatePropertyChange("html",{update:function(b){b.innerHTML=a}})},observeHtmlChange:function(g,f,b){var c=this.node;var e=this.bindings.html;var a=e&&e.markerType;var d=g.newValue;if(a){if(null===d||"undefined"===typeof(d)){d=""}Element.addClassName(c,coherent.Style.kMarkerClass)}else{Element.removeClassName(c,coherent.Style.kMarkerClass);if(this.formatter){d=this.formatter.stringForValue(d)}}this.setHtml(d)},toolTip:function(){return this.node.title},setToolTip:function(a){var b=this.node;if(!a){b.removeAttribute("title")}else{b.title=a}},removeChild:function(a){if(!a){return null}coherent.View.teardownViewsForNodeTree(a);if(this.beforeRemoveElement){this.beforeRemoveElement(a)}return a.parentNode.removeChild(a)},clonedFrom:function(a){},registerForDraggedTypes:function(c){var b=c;if(1===arguments.length&&"string"===typeof(c)){b=[c]}else{if(arguments.length>1){b=arguments}}var a=b.length;if(!this.registeredDraggedTypes){this.registeredDraggedTypes={}}while(a--){this.registeredDraggedTypes[b[a]]=true}},unregisterForDraggedTypes:function(c){var b=c;if(arguments.length>1){b=arguments}var a=b.length;if(!this.registeredDraggedTypes){return}while(a--){delete this.registeredDraggedTypes[b[a]]}},dragElementWithOperationAndData:function(j,g,i,h,a){var f;var b=coherent.EventLoop.currentEvent;if(!coherent.page._mousedownView){throw new Error("Can't initiate a drag & drop operation except during dragstart event.")}coherent.page._draggingSourceView=this;coherent.page._draggingData=i;if(coherent.Support.DragAndDrop){var d=b.dataTransfer;d.clearData();d.effectAllowed=g;if(coherent.Browser.IE){if(j){f=coherent.page._dragging=new coherent.DragAndDropHelper();f.initFakeDragAndDrop(j,b)}if("text/plain" in i){d.setData("Text",i["text/plain"])}if("text/uri-list" in i){d.setData("URL",i["text/uri-list"])}}else{for(var c in i){d.setData(c,i[c])}var k=Element.getRect(j);d.setDragImage(j,b.pageX-k.left,b.pageY-k.top)}}else{f=coherent.page._dragging=new coherent.DragAndDropHelper();f.initFakeDragAndDrop(j,b);Event.preventDefault(b)}},draggingEndedWithOperation:function(a){},draggingEntered:function(b){var a=this.delegate();if(a&&"draggingEntered" in a){return a.draggingEntered(b)}return"none"},draggingExited:function(b){var a=this.delegate();if(a&&"draggingExited" in a){a.draggingExited(b)}},draggingUpdated:function(b){var a=this.delegate();if(a&&"draggingUpdated" in a){return a.draggingUpdated(b)}return null},prepareForDragOperation:function(b){var a=this.delegate();if(a&&"prepareForDragOperation" in a){return a.prepareForDragOperation(b)}return false},performDragOperation:function(b){var a=this.delegate();if(a&&"performDragOperation" in a){return a.performDragOperation(b)}return false},concludeDragOperation:function(b){var a=this.delegate();if(a&&"concludeDragOperation" in a){a.concludeDragOperation(b)}}});coherent.View.viewLookup={};coherent.View.__subclassCreated__=function(a){var b=a.prototype;var c=a.superclass.prototype;if(b.__structure__!==c.__structure__){Object.applyDefaults(b.__structure__,c.__structure__)}if(b.animationOptions!==c.animationOptions){Object.applyDefaults(b.animationOptions,c.animationOptions)}if(b.markup&&b.markup instanceof coherent.Asset){b.markup=b.markup.content()}};coherent.View.fromNode=function(a){var b=coherent.View.viewLookup;var c=null;if(coherent.typeOf(a)=="string"){c=a}else{if("id" in a){c=a.id}}if(!b||!c||!b[c]){return null}return b[c]};coherent.View.teardownViewsForNodeTree=function(a){function b(d){var c=coherent.View.fromNode(d);if(!c){return}c.teardown()}Element.depthFirstTraversal(a||document.body,b)};coherent.View.addToHoldingArea=function(b){var a=coherent.View.__holdingArea;if(!a){coherent.View.__holdingArea=a=document.createElement("div");a.style.position="absolute";a.style.left="-9999px";a.style.top="-9999px";a.style.width="0";a.style.height="0";a.style.overflow="hidden";a.id="coherent_holding_area";document.body.appendChild(a)}Element.assignId(b);a.appendChild(b)};coherent.View.createNodeFromMarkup=function(a){var b=coherent.View.__incubator;if(!b){coherent.View.__incubator=b=document.createElement("div");b.style.position="absolute";b.style.left="-9999px";b.style.top="-9999px";b.style.width="0";b.style.height="0";b.style.overflow="hidden";b.id="coherent_incubator";document.body.appendChild(b)}b.innerHTML=String(a).trim();var c=b.removeChild(b.firstChild);coherent.View.addToHoldingArea(c);return c};Object.markMethods(coherent.View,"coherent.View");function VIEW(b,a){if(1==arguments.length){a=b;b=null}function c(e){var d;if(b&&1===b.nodeType){e=b}if(!e){if("string"!==typeof(b)){b=b.content()}e=coherent.View.createNodeFromMarkup(b)}var f;var g;if(":root" in a){f=a[":root"];if(f&&"function"===typeof(f)&&f.__factoryFn__){d=f.call(this,e)}}if(!d){d=new coherent.View(e)}for(g in a){if(":root"===g){continue}f=a[g];if(!f||"function"!==typeof(f)||!f.__factoryFn__){continue}f.call(d,g)}return d}c.__factoryFn__=true;return c}if(coherent.Browser.IE){Object.extend(Event,{observe:function(c,a,b){if("on"!=a.slice(0,2)){a="on"+a}c.attachEvent(a,b);return b},stopObserving:function(c,a,b){if(!c||!a||!b){return}if("on"!=a.slice(0,2)){a="on"+a}c.detachEvent(a,b)},stop:function(a){a=a||window.event;a.returnValue=false;a.cancelBubble=true},preventDefault:function(a){a.returnValue=false},onDomReady:function(b){if(Event._domHasFinishedLoading.done){window.setTimeout(b,0);return}if(!Event._readyCallbacks){document.write("<script id=__ie_onload defer src=javascript:void(0)><\/script>");var a=document.getElementById("__ie_onload");a.onreadystatechange=function(){if("complete"===this.readyState){Event._domHasFinishedLoading()}};a=null;Event.observe(window,"load",Event._domHasFinishedLoading);Event._readyCallbacks=[]}Event._readyCallbacks.push(b)}})}
/*
    Adapted from the dojo.hash source code.
    
    Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
    Available via Academic Free License >= 2.1 OR the modified BSD license.
    see: http://dojotoolkit.org/license for details
*/
(function(){coherent.hash=new coherent.KVO();coherent.hash.value=i();coherent.hash.setValue=function(j){if("#"!==j.charAt(0)){j="#"+j}window.location.href=j};var b=null;var g=null;var f=coherent.hash.hashPollFrequency||100;function i(){var k=window.location.href;var j=k.indexOf("#");if(-1===j){return""}return decodeURIComponent(k.substring(j+1))}function d(){var j=i();var k=new coherent.ChangeNotification(coherent.hash,coherent.ChangeType.setting,j);coherent.hash.notifyObserversOfChangeForKeyPath(k,"value")}function a(){var j=i();if(j===b){return}b=j;d()}function c(l){if(g){if(g.isTransitioning()){c.delay(f,l);return}var j=g.iframe.location.href;var k=j.indexOf("?");g.iframe.location.replace(j.substring(0,k)+"?"+l);return}window.location.replace("#"+l);a()}function h(){var p=document.createElement("iframe");var r="coherent-hash-iframe";var t=coherent.hash.blankHtmlUrl;p.id=r;p.src=t+"?"+i();p.style.display="none";document.body.appendChild(p);this.iframe=window[r];var q;var s;var j;var m;var k;var o=this.iframe.location;var n=window.location;function l(){b=n.hash;q=k?b:o.search;s=false;j=null}this.isTransitioning=function(){return s};this.pollLocation=function(){if(!k){try{o.search;if(document.title!=m){m=this.iframe.document.title=document.title}}catch(u){k=true;console.error("coherent.hash: Error adding history entry. Server unreachable.")}}if(s&&b===n.hash){if(k||o.search===j){l();d()}else{this.pollLocation.bindAndDelay(this,0);return}}else{if(b===n.hash&&(k||q===o.search)){}else{if(b!==n.hash){b=n.hash;s=true;j="?"+i();p.src=t+j;k=false;this.pollLocation.bindAndDelay(this,0);return}else{if(!k){n.href="#"+o.search.substring(1);l();d()}}}}this.pollLocation.bindAndDelay(this,f)};l();this.pollLocation.bindAndDelay(this,f)}function e(){if("onhashchange" in window&&(!coherent.Browser.IE||(coherent.Browser.IE>=8&&document.compatMode!="BackCompat"))){Event.observe(window,"onhashchange",d)}else{if(document.addEventListener){b=i();window.setInterval(a,f)}else{if(document.attachEvent){g=new h()}}}}Event.onDomReady(e)})();coherent.Application=Class.create(coherent.Responder,{constructor:function(){if(coherent.Application.shared){return coherent.Application.shared}this.__assetLocation="";this.delegate=null;coherent.hash.addObserverForKeyPath(this,"observeHashChange","value");return this},observeHashChange:function(b){var a=b.newValue;if(this.delegate&&"hashDidChange" in this.delegate){this.delegate.hashDidChange(a)}},assetLocation:function(){return this.__assetLocation},setAssetLocation:function(a){if("/"!==a.slice(-1)){a+="/"}this.__assetLocation=a},mainBundle:function(){return this.__mainBundle},setMainBundle:function(b){this.__mainBundle=b;var a=this.__assetLocation+b;if(!/\.\w+$/.test(a)){a+=".jsnib"}var c=NIB.load(a,this);c.addCallback(this.__bundleLoaded,this)},__bundleLoaded:function(e){var b=document.body;var d=e.__views;var a=d.length;var c;for(var f=0;f<a;++f){c=d[f];if(!c.node.parentNode||c.node.parentNode===coherent.View.__holdingArea){b.appendChild(c.node)}}}});coherent.Application.shared=new coherent.Application();coherent.EventLoop={currentEvent:null,getStart:function(){if(!this._start){this._start=new Date().getTime()}return this._start},begin:function(a){this._start=new Date().getTime();this.currentEvent=a},end:function(){this.currentEvent=null;this._start=null}};coherent.Page=Class.create(coherent.Responder,{focusedElement:null,constructor:function(){this.firstResponder=null;this.__mouseEventListeners=[];this.__hoverTrackingIds={}},targetViewForEvent:function(c){var b=c.target||c.srcElement;var a;var d=coherent.View.fromNode;while(b&&b!=document&&!(a=d(b))){b=b.parentNode}if(!b||b==document){return null}return a},makeFirstResponder:function(b){if(this.firstResponder==b){return true}var a=this.firstResponder;if(a&&!a.resignFirstResponder()){return false}if(a){a.animateClassName(a.__animationOptionsForProperty("focus"),true)}if(b&&!b.becomeFirstResponder()){this.willChangeValueForKey("firstResponder");this.firstResponder=null;this.didChangeValueForKey("firstResponder");return false}this.willChangeValueForKey("firstResponder");this.firstResponder=b;this.didChangeValueForKey("firstResponder");if(b){b.focus();b.animateClassName(b.__animationOptionsForProperty("focus"))}return true},addTrackingInfo:function(c,b){if("string"!==typeof(c)){c=Element.assignId(c)}var a=this.__hoverTrackingIds[c];if(!a){a=this.__hoverTrackingIds[c]=[]}a.push(b)},presentError:function(a){function b(){var c=a.description;if(a.recoverySuggestion){c+="\n"+a.recoverySuggestion}window.alert(c);coherent.page.makeFirstResponder(a.field)}b.delay(0)},superview:function(){return null},nextResponder:function(){return coherent.Application.shared},_findFirstResponder:function(a){while(a&&!a.acceptsFirstResponder()){a=a.nextResponder()}if(!a){return}this.makeFirstResponder(a)},_onmousedown:function(b){var a=this.targetViewForEvent(b);if(this.__mouseEventListeners.length){this.__mouseEventListeners.forEach(function(c){c.onmousedown(b)})}if(a){this._findFirstResponder(a);a.onmousedown(b);Event.observe(document,"mousemove",this._onmousedragHandler);this._mousedownPoint={x:b.clientX,y:b.clientY,dragging:false}}this._mousedownView=a},_onmouseup:function(a){if(this._dragging){this._dragging.onmouseup(a);delete this._dragging}else{if(this._mousedownView){this._mousedownView.onmouseup(a)}}if(this.__mouseEventListeners.length){this.__mouseEventListeners.forEach(function(b){b.onmouseup(a)})}this._mousedownView=null;Event.stopObserving(document,"mousemove",this._onmousedragHandler)},_onmousedrag:function(c){if(this._dragging){this._dragging.onmousemove(c);return}if(this._draggingSourceView){return}if(!this._mousedownView){return}if(!coherent.Support.DragAndDrop&&!this._mousedownPoint.dragging){var b=c.clientX-this._mousedownPoint.x;var a=c.clientY-this._mousedownPoint.y;if(25>=(b*b+a*a)){return}this._mousedownPoint.dragging=true;this._mousedownView.ondragstart(c);return}this._mousedownView.onmousedrag(c)},_onmouseover:function(a){var g=this.__hoverTrackingIds||{};var o=this.__mouseOverIds||{};var d={};var k=a.target||a.srcElement;var h=document.body;var l;var n;var b;var f;var j;var m;for(;k&&k!=h;k=k.parentNode){b=k.id;if(!b||!(b in g)){continue}d[b]=true;if(b in o){continue}l=g[b];j=l.length;while(j--){m=l[j];if(m.onmouseenter){m.onmouseenter.call(m.owner,k,m.ownerInfo)}}}for(b in o){if(b in d){continue}k=document.getElementById(b);if(!k){continue}l=g[b];j=l.length;while(j--){m=l[j];if(m.onmouseleave){m.onmouseleave.call(m.owner,k,m.ownerInfo)}}}this.__mouseOverIds=d},_onmouseout:function(a){},_onclick:function(b){if(coherent.Browser.Mozilla&&b.button===2){return}if(this.__mouseEventListeners.length){this.__mouseEventListeners.forEach(function(c){c.onclick(b)})}var a=this.targetViewForEvent(b);if(a){a.onclick(b)}else{this.onclick(b)}},_ondblclick:function(a){if(this.__mouseEventListeners.length){this.__mouseEventListeners.forEach(function(b){b.ondblclick(a)})}if(this._mousedownView){this._mousedownView.ondblclick(a)}},_onkeydown:function(a){var b=this.firstResponder;if(b){b.onkeydown(a)}},_onkeyup:function(a){var b=this.firstResponder;if(b){b.onkeyup(a)}},_onkeypress:function(a){var b=this.firstResponder;if(b){b.onkeypress(a)}},_onfocus:function(b){var c=(b.target||b.srcElement);if(!c){return}var d=(c===window);if(d){if(window.dashcode&&!window.dashcode.inDesign&&document.body){Element.removeClassName(document.body,coherent.Style.kInactiveWindow)}if(!this._documentFocused){this.makeFirstResponder(this._previousFirstResponder||null);this._previousFirstResponder=null}}else{var a=this.targetViewForEvent(b);if(a){a.onfocus(b)}if(a&&a.acceptsFirstResponder()){this.makeFirstResponder(a)}else{this.makeFirstResponder(null)}this.focusedElement=b.target||b.srcElement}this._documentFocused=true},_onblur:function(b){var c=(b.target||b.srcElement);if(!c){return}var d=(c===window);if(d){this._documentFocused=false;this._previousFirstResponder=this.firstResponder;this.makeFirstResponder(null);if(window.dashcode&&!window.dashcode.inDesign&&document.body){Element.addClassName(document.body,coherent.Style.kInactiveWindow)}}else{var a=this.targetViewForEvent(b);if(a){a.onblur(b)}this.focusedElement=null;if(a&&a.acceptsFirstResponder()){this.makeFirstResponder(null)}}},_onchange:function(b){var a=this.targetViewForEvent(b);if(a){a.onchange(b)}},_onsubmit:function(b){var a=this.targetViewForEvent(b);if(a){a.onsubmit(b)}},_onreset:function(b){var a=this.targetViewForEvent(b);if(a){a.onreset(b)}},_ontouchstart:function(c){var a=this.targetViewForEvent(c);if(a){var b=this;a.ontouchstart(c);this._touchstartMouseDownDelay=window.setTimeout(function(){a.onmousedown(c);b._touchsentMD=true;delete b._touchstartMouseDownDelay},100)}this._touchstartView=a;this._touchmovedX=false;this._touchmovedY=false;this._touchsentMD=false;this._touchstartX=c.targetTouches[0].clientX;this._touchstartY=c.targetTouches[0].clientY},_ontouchmove:function(d){var a=d.targetTouches[0].clientX;var e=d.targetTouches[0].clientY;var b=false;var c=false;if(!this._touchmovedX&&Math.abs(this._touchstartX-a)>5){b=this._touchmovedX=true}if(!this._touchmovedY&&Math.abs(this._touchstartY-e)>5){c=this._touchmovedY=true}if(this._touchstartView){this._touchstartView.ontouchmove(d);if(this._touchstartMouseDownDelay){window.clearTimeout(this._touchstartMouseDownDelay);delete this._touchstartMouseDownDelay}if(b||c){if(this._touchsentMD){this._touchstartView.onmouseup(d);this._touchsentMD=false}if(!this._touchmovedY&&b){this._touchstartView.onswipe(d)}}}},_ontouchend:function(a){if(this._touchstartView){this._touchstartView.ontouchend(a);if(this._touchstartMouseDownDelay){var b=this._touchstartView;window.clearTimeout(this._touchstartMouseDownDelay);delete this._touchstartMouseDownDelay;this._touchstartView.onmousedown(a);this._touchsentMD=true;window.setTimeout(function(){b.onmouseup(a);b.onclick(a)},0)}else{if(this._touchsentMD){this._touchstartView.onmouseup(a);if(!this._touchmovedX&&!this._touchmovedY){this._touchstartView.onclick(a)}}}}},_ontouchcancel:function(a){if(this._touchstartView){this._touchstartView.ontouchend(a);if(this._touchstartMouseDownDelay){window.clearTimeout(this._touchstartMouseDownDelay);delete this._touchstartMouseDownDelay}else{if(this._touchsentMD){this._touchstartView.onmouseup(a)}}}},_onunload:function(){var b;var a=coherent.View.viewLookup;for(b in a){a[b].teardown();delete a[b]}},_ondragstart:function(a){if(this._mousedownView){this._draggingSourceView=null;this._mousedownView.ondragstart(a);if(!this._draggingSourceView){Event.preventDefault(a)}}},_ondrag:function(a){if(this._dragging){this._dragging.onmousemove(a)}},_ondragend:function(a){if(this._draggingView){this._draggingView.concludeDragOperation(this._draggingLastDropEffect)}this._draggingView=null;if(this._draggingSourceView){this._draggingSourceView.draggingEndedWithOperation(this._draggingLastDropEffect)}this._draggingSourceView=null;if(this._dragging){this._dragging.cleanup();delete this._dragging}},_exitOldDragView:function(a){if(!this._draggingView){return}var b=this._dragInfoFromEvent(a);this._draggingView.draggingExited(b);this._draggingLastDropEffect=null;this._draggingView=null},_dragInfoFromEvent:(function(){if(coherent.Browser.IE){var a={"text/plain":"Text","text/uri-list":"URL"};return function(d){var e=this._draggingData;var c=this._dragging.node;var g=c.style.display;c.style.display="none";var f=Element.fromPoint(d.clientX,d.clientY);c.style.display=g;if(e){return{location:{x:d.clientX,y:d.clientY},target:f,types:Set.toArray(e),operation:this._draggingLastDropEffect,getData:function(h){return e[h]||null}}}else{var b=[];if(d.dataTransfer.getData("Text")){b.push("text/plain")}if(d.dataTransfer.getData("URL")){b.push("text/uri-list")}return{location:{x:d.clientX,y:d.clientY},target:f,types:b,operation:d.dataTransfer.dropEffect,getData:function(h){h=a[h];return d.dataTransfer.getData(h)}}}}}if(coherent.Support.DragAndDrop){return function(b){return{location:{x:b.clientX,y:b.clientY},target:Element.fromPoint(b.clientX,b.clientY),types:Array.from(b.dataTransfer.types),operation:b.dataTransfer.dropEffect||this._draggingLastDropEffect,getData:function(c){return b.dataTransfer.getData(c)}}}}return function(c){var d=this._draggingData;var b=this._dragging.node;var f;if(b){f=b.style.display;b.style.display="none"}var e=Element.fromPoint(c.clientX,c.clientY);if(b){b.style.display=f}return{location:{x:c.clientX,y:c.clientY},target:e,types:Set.toArray(d),operation:this._draggingLastDropEffect,getData:function(g){return d[g]||null}}}})(),_ondragenter:function(f){var b=this.targetViewForEvent(f);if(!b){this._exitOldDragView(f);return}var g=this._dragInfoFromEvent(f);var d=g.types;var a=g.types.length;var c;var e;while(b){if(b.registeredDraggedTypes){while(a--){if(d[a] in b.registeredDraggedTypes){e=b;break}}}b=b.superview()}if(e===this._draggingView){return}if(!e){this._exitOldDragView(f);this._draggingLastDropEffect="none";return}var h=e.draggingEntered(g);this._draggingView=e;this._draggingLastDropEffect=h;if(f.dataTransfer){f.dataTransfer.dropEffect=h}Event.preventDefault(f)},_ondragleave:function(a){},_ondragover:function(a){if(!this._draggingView){a.dataTransfer.dropEffect="none";Event.preventDefault(a);return}var b=this._dragInfoFromEvent(a);var c=this._draggingView.draggingUpdated(b);this._draggingLastDropEffect=c||this._draggingLastDropEffect;if(coherent.Support.DragAndDrop){a.dataTransfer.dropEffect=this._draggingLastDropEffect}Event.preventDefault(a)},_ondrop:function(a){if(!this._draggingView){return}var b=this._dragInfoFromEvent(a);if(!this._draggingView.prepareForDragOperation(b)){this._draggingLastDropEffect="none";a.dataTransfer.dropEffect="none";Event.preventDefault(a);return}if(!this._draggingView.performDragOperation(b)){this._draggingLastDropEffect="none";Event.preventDefault(a);return}}});(function(){coherent.page=new coherent.Page();window._setTimeout=window.setTimeout;window.setTimeout=function(f,d){if(!f){return null}if("string"===typeof(f)){f="coherent.EventLoop.begin();do {"+f+"} while (false); coherent.EventLoop.end();";return window._setTimeout(f,d)}var c=Array.from(arguments,2);function e(){coherent.EventLoop.begin();var g=f.apply(this,c);coherent.EventLoop.end();return g}return window._setTimeout(e,d)};window._setInterval=window.setInterval;window.setInterval=function(f,e){if(!f){return null}if("string"===typeof(f)){f="coherent.EventLoop.begin();do {"+f+"} while (false); coherent.EventLoop.end();";return window._setInterval(f,e)}var d=Array.from(arguments,2);function c(){coherent.EventLoop.begin();var g=f.apply(this,d);coherent.EventLoop.end();return g}return window._setInterval(c,e)};var b=coherent.page;var a;if(coherent.Browser.IE){a=function(c){return function(){coherent.EventLoop.begin(window.event);b[c](window.event);coherent.EventLoop.end()}};b._onmousedragHandler=a("_onmousedrag");document.attachEvent("onmouseover",a("_onmouseover"));document.attachEvent("onmouseout",a("_onmouseout"));document.attachEvent("onmousedown",a("_onmousedown"));document.attachEvent("onmouseup",a("_onmouseup"));document.attachEvent("onclick",a("_onclick"));document.attachEvent("ondblclick",a("_ondblclick"));document.attachEvent("onkeydown",a("_onkeydown"));document.attachEvent("onkeyup",a("_onkeyup"));document.attachEvent("onkeypress",a("_onkeypress"));document.attachEvent("onfocusin",a("_onfocus"));document.attachEvent("onfocusout",a("_onblur"));window.attachEvent("onfocus",a("_onfocus"));window.attachEvent("onblur",a("_onblur"));window.attachEvent("onunload",a("_onunload"));if(coherent.Support.DragAndDrop){document.attachEvent("ondragstart",a("_ondragstart"));document.documentElement.attachEvent("ondragend",a("_ondragend"));document.documentElement.attachEvent("ondragenter",a("_ondragenter"));document.documentElement.attachEvent("ondrag",a("_ondrag"));document.documentElement.attachEvent("ondragover",a("_ondragover"));document.documentElement.attachEvent("ondrop",a("_ondrop"))}}else{a=function(c){return function(d){coherent.EventLoop.begin(d);b[c](d);coherent.EventLoop.end()}};b._onmousedragHandler=a("_onmousedrag");document.addEventListener("mouseover",a("_onmouseover"),false);document.addEventListener("mouseout",a("_onmouseout"),false);document.addEventListener("mousedown",a("_onmousedown"),false);document.addEventListener("mouseup",a("_onmouseup"),false);document.addEventListener("keydown",a("_onkeydown"),false);document.addEventListener("keyup",a("_onkeyup"),false);document.addEventListener("keypress",a("_onkeypress"),false);document.addEventListener("focus",a("_onfocus"),true);document.addEventListener("blur",a("_onblur"),true);document.addEventListener("change",a("_onchange"),true);document.addEventListener("submit",a("_onsubmit"),true);document.addEventListener("reset",a("_onreset"),true);window.addEventListener("focus",a("_onfocus"),false);window.addEventListener("blur",a("_onblur"),false);document.addEventListener("click",a("_onclick"),false);document.addEventListener("dblclick",a("_ondblclick"),false);if(coherent.Support.Touches){document.addEventListener("touchstart",a("_ontouchstart"),true);document.addEventListener("touchmove",a("_ontouchmove"),true);document.addEventListener("touchend",a("_ontouchend"),true);document.addEventListener("touchcancel",a("_ontouchcancel"),true)}if(coherent.Support.DragAndDrop){document.addEventListener("dragstart",a("_ondragstart"),false);document.addEventListener("dragend",a("_ondragend"),false);document.addEventListener("dragenter",a("_ondragenter"),false);document.addEventListener("dragover",a("_ondragover"),false);document.addEventListener("drop",a("_ondrop"),false)}}})();coherent.Markers={MultipleValues:"ThisIsAnUniqueStringThatRepresentsMultipleValues",NoSelection:"ThisIsAnUniqueStringThatRepresentsNoSelection"};coherent.SelectionProxy=Class.create(coherent.KVO,{constructor:function(a){this.controller=a;this.mutable=true},infoForKey:function(b){var a=this.controller.selectedObjects();var c=a.infoForKey(b);if(c){c.mutable&=this.mutable}return c},infoForKeyPath:function(c){var a=this.controller.selectedObjects();var b=a.infoForKeyPath(c);if(b){b.mutable&=this.mutable}return b},translateValue:function(d){if("array"!==coherent.typeOf(d)){return d}if(1===d.length){return d[0]}var c;var a=d.length;var b=d[0];while(--a){if(0!==coherent.compareValues(b,d[a])){return coherent.Markers.MultipleValues}}return b},validateValueForKey:function(f,e){var b=this.controller.selectedObjects();var a=b.length;var d;if(0===a){return f}var c;while(a--){c=b[a].validateValueForKey(f,e);if(c instanceof coherent.Error){return c}}return c},validateValueForKeyPath:function(e,f){var b=this.controller.selectedObjects();var a=b.length;var d;if(0===a){return e}var c;while(a--){c=b[a].validateValueForKeyPath(e,f);if(c instanceof coherent.Error){return c}}return c},valueForKey:function(c){var b=this.controller.selectedObjects();if(0===b.length){return coherent.Markers.NoSelection}var a=b.valueForKey(c);return this.translateValue(a)},valueForKeyPath:function(c){var b=this.controller.selectedObjects();if(0===b.length){return coherent.Markers.NoSelection}var a=b.valueForKeyPath(c);return this.translateValue(a)},setValueForKey:function(c,b){if(!this.mutable){return}var a=this.controller.selectedObjects();a.setValueForKey(c,b)},setValueForKeyPath:function(b,c){if(!this.mutable){return}var a=this.controller.selectedObjects();a.setValueForKeyPath(b,c)}});coherent.ObjectController=Class.create(coherent.Controller,{constructor:function(a){this.base(a);this.objectClass=coherent.KVO;this.__content=null;this.__editable=true;this.__selectedObjects=[];this.__selection=new coherent.SelectionProxy(this)},observeChildObjectChangeForKeyPath:function(f,e,b){this.base(f,e,b);if("selectedObjects"!==b){return}var c="selection."+e;var d=this.valueForKeyPath(c);var a=new coherent.ChangeNotification(this,coherent.ChangeType.setting,d,null);this.notifyObserversOfChangeForKeyPath(a,c)},exposedBindings:["editable","content"],editable:function(){var a=this.__editable;if(this.bindings.content){a&=this.bindings.content.mutable()}return a},setEditable:function(a){if(this.bindings.content){a&=this.bindings.content.mutable()}if(this.bindings.editable){this.bingings.editable.setValue(a)}this.__editable=a},content:function(){return this.__content},setContent:function(a){if(this.bindings.content){this.bindings.content.setValue(a)}this.__content=a;this.willChangeValueForKey("selectedObjects");if(!a){this.__selectedObjects=[]}else{this.__selectedObjects=[a]}this.didChangeValueForKey("selectedObjects");this.forceChangeNotificationForKey("selection")},selectedObjects:function(){return this.__selectedObjects},selection:function(){return this.__selection}});coherent.AjaxController=Class.create(coherent.ObjectController,{flushContentBeforeQuery:false,fetchesInitially:true,constructor:function(a){this.queryDelay=0;this.url="";this.method="GET";this.base(a);if(this.parameters){coherent.KVO.adaptTree(this.parameters)}else{this.parameters=new coherent.KVO()}this.addObserverForKeyPath(this,this.queryUpdated,"url");this.addObserverForKeyPath(this,this.queryUpdated,"method")},__postConstruct:function(){this.base();if(this.fetchesInitially&&this.url&&this.url.length&&this.validateParameters()){this.forceChangeNotificationForKey("url")}},validateParameters:function(){return true},fullURL:function(){var g={};var e=coherent.KVO.mutableKeys(this.parameters);var a=e.length;var b=this.url;var d;var f;for(var c=0;c<a;++c){f=e[c];if(this.parameters.hasOwnProperty(f)){g[f]=this.parameters[f]}}d=Object.toQueryString(g);if(d){if("?"!==b.slice(-1)){b+="?"}b+=d}return b},observeChildObjectChangeForKeyPath:function(c,b,a){this.base(c,b,a);if("parameters"===a){this.queryUpdated(c,b,a)}},queryUpdated:function(c,b,a){if(!this.parameters||!this.validateParameters()){return}this.setValueForKey(true,"queryInProgress");if(this.__queryTimer){window.clearTimeout(this.__queryTimer)}this.__queryTimer=this.performQuery.bindAndDelay(this,this.queryDelay)},performQuery:function(){var f={};var e=coherent.KVO.mutableKeys(this.parameters);var a=e.length;var g;var c;var b="application/json";this.setValueForKey(true,"queryInProgress");for(var d=0;d<a;++d){g=e[d];if(!this.parameters.hasOwnProperty(g)){continue}c=this.parameters[g];if(null===c||"undefined"===typeof(c)){continue}f[g]=c}if(this.dataModel&&("xml"==this.dataModel.dataType)){b="text/xml"}this.__request=XHR.get(this.url,f,{responseContentType:b});this.__request.addMethods(this.querySucceeded.bind(this),this.queryFailed.bind(this));if(this.flushContentBeforeQuery){this.setContent(null)}},extractContent:function(a){return a},querySucceeded:function(a){var f=null;var c="json";if(this.dataModel){if("xml"==this.dataModel.dataType){c="xml"}}if(c=="json"){coherent.KVO.adaptTree(a);f=a}else{if(c=="xml"&&a){if(this.dataModel.model){var b=this.dataModel.model;var e=a;var g;for(g=e.firstChild;g;g=g.nextSibling){if(1!==g.nodeType){continue}e=g;break}if(b&&e){f=new coherent.ModeledXMLProxy(a,e,b)}}}}if(!f){var d=new Error("XHR request failed");d.url=this.url;d.method=this.method;d.status=400;d.statusText="Invalid feed.";return this.queryFailed(d)}this.setContent(this.extractContent(f));this.setValueForKey("","statusCode");this.setValueForKey("","errorMessage");this.setValueForKey(false,"queryInProgress");return f},queryFailed:function(a){this.setValueForKey(-1,"statusCode");this.setValueForKey(a.statusText,"errorMessage");this.setContent(null);this.setValueForKey(false,"queryInProgress");return a}});coherent.ArrayController=Class.create(coherent.ObjectController,{constructor:function(a){this.base(a);this.__arrangedObjects=[];this.__sortDescriptors=[];this.__filterPredicate=null;this.__selectionIndexes=[];this.__selectedObjects=[];this.__content=[]},exposedBindings:["selectionIndexes","sortDescriptors","filterPredicate"],preservesSelection:true,avoidsEmptySelection:true,selectsInsertedObjects:true,content:function(){return this.__content},setContent:function(a){this.__content=a?a.copy():[];this.rearrangeObjects();if(!this.preservesSelection){this.setSelectionIndexes([])}},observeContentChange:function(a){if(coherent.ChangeType.setting===a.changeType){this.setContent(a.newValue);return}switch(a.changeType){case coherent.ChangeType.insertion:this.__content.insertObjectsAtIndexes(a.newValue,a.indexes);this.__insertObjectsIntoArrangedObjects(a.newValue);break;case coherent.ChangeType.replacement:this.__content.replaceObjectsAtIndexesWithObjects(a.indexes,a.newValue);this.__removeObjectsFromArrangedObjects(a.oldValue);this.__insertObjectsIntoArrangedObjects(a.newValue);break;case coherent.ChangeType.deletion:this.__content.removeObjectsAtIndexes(a.indexes);this.__removeObjectsFromArrangedObjects(a.oldValue);break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+a.changeType);break}},sortDescriptors:function(){return this.__sortDescriptors},setSortDescriptors:function(a){a=a?a.copy():[];this.__sortDescriptors=a;if(this.bindings.sortDescriptors){this.bindings.sortDescriptors.setValue(a)}this.rearrangeObjects()},observeSortDescriptorsChange:function(a){if(coherent.ChangeType.setting===a.changeType){this.setSortDescriptors(a.newValue);return}switch(a.changeType){case coherent.ChangeType.insertion:this.__sortDescriptors.insertObjectsAtIndexes(a.newValue,a.indexes);break;case coherent.ChangeType.replacement:this.__sortDescriptors.replaceObjectsAtIndexesWithObjects(a.indexes,a.newValue);break;case coherent.ChangeType.deletion:this.__sortDescriptors.removeObjectsAtIndexes(a.indexes);break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+a.changeType);break}this.rearrangeObjects()},filterPredicate:function(){return this.__filterPredicate},setFilterPredicate:function(a){this.__filterPredicate=a;if(this.bindings.filterPredicate){this.bindings.filterPredicate.setValue(a)}this.rearrangeObjects()},rearrangeObjects:function(){var a;var b;if(this.preservesSelection){a=this.selectedObjects()}this.willChangeValueForKey("arrangedObjects");this.__arrangedObjects=this.arrangeObjects(this.__content);this.didChangeValueForKey("arrangedObjects");if(this.preservesSelection){b=this.__arrangedObjects.indexesOfObjects(a);this.setSelectionIndexes(b)}},arrangedObjects:function(){return this.__arrangedObjects},arrangeObjects:function(b){b=b.copy();var a=this.filterObjects(b);var c=this.sortObjects(a);return c},__insertObjectsIntoArrangedObjects:function(l){var h=this.arrangeObjects(l);var k=h.length;var b=this.__arrangedObjects;var f=b.length;var g=[];var j=0;var c;var e;var d;var m;var a=coherent.SortDescriptor.comparisonFunctionFromDescriptors(this.sortDescriptors());if(this.selectsInsertedObjects){m=h}else{if(this.preservesSelection){m=this.selectedObjects()}}if(a){g.length=k;for(d=0;d<k;++d){e=h[d];while(j<f){c=b[j];if(-1===a(e,c)){break}++j}g[d]=j+d}b.insertObjectsAtIndexes(h,g)}else{b.addObjects(h)}if(m){this.setSelectedObjects(m)}},__removeObjectsFromArrangedObjects:function(c){var a=this.selectedObjects();var b=this.__arrangedObjects.removeObjects(c);this.setSelectedObjects(a)},filterObjects:function(b){var a=this.__filterPredicate;if(!a){return b}return b.filter(a)},sortObjects:function(b){var a=coherent.SortDescriptor.comparisonFunctionFromDescriptors(this.sortDescriptors());if(!a){return b}return b.sort(a)},selectedObjects:function(){return this.__selectedObjects},setSelectedObjects:function(a){var b=this.__arrangedObjects.indexesOfObjects(a);return this.setSelectionIndexes(b)},selectionIndex:function(){var a=this.__selectionIndexes;if(0===a.length){return -1}return a[0]},setSelectionIndex:function(a){if(-1===a){return this.setSelectionIndexes([])}return this.setSelectionIndexes([a])},hasSelection:function(){return this.__selectionIndexes.length},selectionIndexes:function(){return this.__selectionIndexes},setSelectionIndexes:function(a){a=a||[];a.sort(coherent.compareNumbers);if(this.avoidsEmptySelection&&!a.length&&this.__content.length){a=[0]}this.willChangeValueForKey("selectionIndex");this.willChangeValueForKey("selectedObjects");this.willChangeValueForKey("hasSelection");this.willChangeValueForKey("canSelectNext");this.willChangeValueForKey("canSelectPrevious");this.willChangeValueForKey("canRemove");if(this.__selectionIndexes.compare(a)){this.__selectionIndexes=a.copy()}this.__selectedObjects=this.__arrangedObjects.objectsAtIndexes(a);if(this.bindings.selectionIndexes){this.bindings.selectionIndexes.setValue(a)}this.didChangeValueForKey("canRemove");this.didChangeValueForKey("canSelectNext");this.didChangeValueForKey("canSelectPrevious");this.didChangeValueForKey("hasSelection");this.didChangeValueForKey("selectedObjects");this.didChangeValueForKey("selectionIndex");this.forceChangeNotificationForKey("selection");return true},observeSelectionIndexesChange:function(a){if(coherent.ChangeType.setting===a.changeType){this.setSelectionIndexes(a.newValue);return}switch(a.changeType){case coherent.ChangeType.insertion:this.__selectionIndexes.insertObjectsAtIndexes(a.newValue,a.indexes);break;case coherent.ChangeType.replacement:this.__selectionIndexes.replaceObjectsAtIndexesWithObjects(a.indexes,a.newValue);break;case coherent.ChangeType.deletion:this.__selectionIndexes.removeObjectsAtIndexes(a.indexes);break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+a.changeType);break}this.willChangeValueForKey("selectionIndex");this.willChangeValueForKey("selectedObjects");this.__selectedObjects=this.__arrangedObjects.objectsAtIndexes(this.__selectionIndexes);this.didChangeValueForKey("selectedObjects");this.didChangeValueForKey("selectionIndex");this.forceChangeNotificationForKey("selection")},addObject:function(a){this.__content.addObject(a);this.__insertObjectsIntoArrangedObjects([a])},addObjects:function(a){this.__content.addObjects(a);this.__insertObjectsIntoArrangedObjects(a)},removeObject:function(a){this.__content.removeObject(a);this.__removeObjectsFromArrangedObjects([a])},removeObjects:function(a){this.__content.removeObjects(a);this.__removeObjectsFromArrangedObjects(a)},newObject:function(){return new (this.objectClass)()},canAdd:function(){return this.editable()},add:function(){var a=new (this.objectClass)();this.addObject(a)},canRemove:function(){return this.editable()&&this.hasSelection()},remove:function(){var a=this.selectedObjects();this.removeObjects(a)},canSelectNext:function(){var b=this.selectionIndex();var a=this.__arrangedObjects.length;return a&&b<a-1},selectNext:function(){var b=this.selectionIndex();var a=this.__arrangedObjects.length;if(!a||b===a-1){return}this.setSelectionIndexes([b+1])},canSelectPrevious:function(){var b=this.selectionIndex();var a=this.__arrangedObjects.length;return a&&b>0},selectPrevious:function(){var b=this.selectionIndex();var a=this.__arrangedObjects.length;if(!a||b<1){return}this.setSelectionIndexes([b-1])}});coherent.ModeledXMLProxy=Class.create(coherent.KVO,{_xmlRoot:null,_xmlNode:null,constructor:function(a,c,b){this._xmlRoot=a;this._xmlNode=c;this._xmlModel=b;this._valueCache={};if(b){if(coherent.typeOf(b)=="array"){this._xmlModel=b[0]}}},_typeOfChild:function(a){var c="string";var d=false;if(!this._xmlModel){return null}var b=this._xmlModel[a];if(b==undefined){if(a!="#content"){return{type:"string",toMany:false}}else{return null}}c=coherent.typeOf(b);if(c=="array"){d=true;c=coherent.typeOf(b[0])}if(c=="string"&&b=="xhtml"){c="xhtml"}return{type:c,toMany:d}},_valueOfNode:function(d,c){var a=null;var e=null;var b=this;if(c=="object"){return new coherent.ModeledXMLProxy(b._xmlRoot,d,model)}for(var f=d.firstChild;f;f=f.nextSibling){if(c=="xhtml"){if(f.nodeType==1&&(f.namespaceURI==coherent.ModeledXMLProxy.NS_XHTML)){return f.outerHTML||f.xml||f.innerHTML}}else{if((f.nodeType==3)||(f.nodeType==4)){if(!(/[^\t\n\r ]/.test(f.data))){continue}a=f.data}}}if(a){if(c=="boolean"){if(a=="true"||a=="YES"){e=true}else{if(a=="false"||a=="NO"){e=false}}}else{if(c=="number"){e=Number(a);if(e==NaN){e=a}}else{e=a}}}return e},_valueOfChild:function(h){var i=this;var e=null;var f=null;var c=false;function b(m,l){var k=new Array();for(var n=m.firstChild;n;n=n.nextSibling){var j=n.nodeName;if(j==l){k.push(n)}}return k.length?k:undefined}var d=this._typeOfChild(h);if(!d){return null}f=d.type;c=d.toMany;if(h=="#content"){return this._valueOfNode(this._xmlNode,f)}var a=b(this._xmlNode,h);var g=null;if(c){g=new Array();if(a){a.forEach(function(j){g.push(i._valueOfNode(j,f))})}}else{if(a&&a.length){g=this._valueOfNode(a[0],f)}}return g},_rawValueForKey:function(a){var b=null;if(0===a.indexOf("$")){b=this._xmlNode.getAttribute(a.substr(1))}else{if(0===a.indexOf("#")){b=this._valueOfChild(a)}else{b=this._valueOfChild(a)}}return b},toString:function(){if(this._typeOfChild("#content")){return this.valueForKey("#content")}return"OBJECT"},valueForKey:function(a){var b=this._valueCache[a];if(!a||0===a.length){throw new InvalidArgumentError("the key is empty")}if(undefined===b){var c;if(!this.__keys){this.__keys={}}this.__keys[a]=c=new coherent.ModeledXMLKeyInfo(this,a);b=c.get(this)}if(!this._valueAccessedViaKeyPath&&b&&(b instanceof coherent.ModeledXMLProxy)){if(b._typeOfChild("#content")){return b.valueForKey("#content")}}return b},valueForKeyPath:function(c){if(!c||0===c.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(c)){c=c.split(".")}this._valueAccessedViaKeyPath=true;var a=c[0];var b=this.base(c);delete this._valueAccessedViaKeyPath;if(1==c.length&&b){if(b instanceof coherent.ModeledXMLProxy){if(b._typeOfChild("#content")){return b.valueForKey("#content")}}}return b}});coherent.ModeledXMLProxy.NS_XHTML="http://www.w3.org/1999/xhtml";coherent.ModeledXMLKeyInfo=Class.create(coherent.KeyInfo,{constructor:function(d,c){var a=coherent.KVO.getPropertyMethodsForKeyOnObject;var b=d._rawValueForKey(c);coherent.KVO.getPropertyMethodsForKeyOnObject=function(e,f){return{value:b,getter:function(){return this._valueCache[e]},mutator:function(g){this.willChangeValueForKey(e);this._valueCache[e]=g;this.didChangeValueForKey(e)}}};this.base(d,c);d._valueCache[this.key]=b;coherent.KVO.getPropertyMethodsForKeyOnObject=a}});(function(){var b=document.documentElement.className;if(coherent.Browser.Safari){b+=" safari"}if(coherent.Browser.MobileSafari){b+=" mobile-safari"}if(coherent.Browser.Mozilla){b+=" mozilla"}if(coherent.Browser.IE){b+=" msie msie"+coherent.Browser.IE}var a=window.navigator.userAgent;if(/Windows/.test(a)){b+=" windows"}if(/Macintosh/.test(a)){b+=" mac"}document.documentElement.className=b.trim()})();Element.colours={black:"#000000",white:"#ffffff"};if(coherent.Browser.IE){Object.extend(Element,{contains:function(a,b){return a==b||a.contains(b)},setStyle:function(a,e,d){if("opacity"!=e){a.style[e]=d;return}var c=a.style.filter;var b=a.style;if(d==1||d===""){b.filter=c.replace(/alpha\([^\)]*\)/gi,"");return}if(d<0.00001){d=0}b.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(d*100)+")"},setStyles:function(a,b){var c=a.style;for(var d in b){if("opacity"==d){Element.setStyle(a,d,b[d])}else{c[d]=b[d]}}},getStyles:function(f,e){var d=f.currentStyle;var g={};var c;var b;if("string"===typeof(e)){switch(e){case"opacity":c=d.filter.match(/opacity=(\d+)/i);return(null===c?1:parseInt(c[1],10)/100);case"width":b+=parseInt(d.borderLeftWidth,10)||0+parseInt(d.borderRightWidth,10)||0+parseInt(d.paddingLeft,10)||0+parseInt(d.paddingRight,10)||0;return Math.max(0,f.offsetWidth-b)+"px";case"height":b+=parseInt(d.borderTopWidth,10)||0+parseInt(d.borderBottomWidth,10)||0+parseInt(d.paddingTop,10)||0+parseInt(d.paddingBottom,10)||0;return Math.max(0,f.offsetHeight-b)+"px";case"backgroundPosition":return d.backgroundPositionX+" "+d.backgroundPositionY;default:return d[e]}}e=e||Element.PROPERTIES;var h;var a=e.length;while(a--){h=e[a];switch(h){case"opacity":c=d.filter.match(/opacity=(\d+)/i);g[h]=(null===c?1:parseInt(c[1],10)/100);break;case"width":b+=parseInt(d.borderLeftWidth,10)||0+parseInt(d.borderRightWidth,10)||0+parseInt(d.paddingLeft,10)||0+parseInt(d.paddingRight,10)||0;g[h]=Math.max(0,f.offsetWidth-b)+"px";break;case"height":b+=parseInt(d.borderTopWidth,10)||0+parseInt(d.borderBottomWidth,10)||0+parseInt(d.paddingTop,10)||0+parseInt(d.paddingBottom,10)||0;g[h]=Math.max(0,f.offsetHeight-b)+"px";break;case"backgroundPosition":g[h]=d.backgroundPositionX+" "+d.backgroundPositionY;break;default:g[h]=d[h];break}}return g},clone:function(c){var d=c.cloneNode(false);if("TR"!=c.tagName){d.innerHTML=c.innerHTML;return d}var b;var a;var e;for(b=0;b<c.children.length;++b){a=c.children[b];e=a.cloneNode(false);e.id="";e.innerHTML=a.innerHTML;d.appendChild(e)}return d}});Element.getStyle=Element.getStyles}coherent.Formatter=Class.create({invalidValueMessage:_("error.invalid_value"),constructor:function(a){Object.extend(this,a)},stringForValue:function(a){if(null===a||"undefined"===typeof(a)){return""}return String(a)},valueForString:function(a){return a},isStringValid:function(a){return true},isValidInputCharacter:function(a){return true},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}}});coherent.NumberFormatter=Class.create(coherent.Formatter,{invalidValueMessage:_("error.invalid_number"),validFloatCharacters:"0123456789.-",validIntCharacters:"0123456789-",allowsFloats:true,allowsEmptyString:false,valueForEmptyString:0,stringForValue:function(a){if(null===a||"undefined"===typeof(a)){return""}if(!this.allowFloats){a=Math.round(a)}return String(a)},valueForString:function(a){a=a.trim();if(!a&&this.allowsEmptyString){return this.valueForEmptyString}if(this.allowsFloats){return parseFloat(a)}else{return parseInt(a,10)}},isStringValid:function(a){a=a.trim();if(!a&&this.allowEmptyString){return true}var c=this.valueForString(a);var b=!isNaN(c);if(b&&!isNaN(this.minimum)){b=(c>=this.minimum)}if(b&&!isNaN(this.maximum)){b=(c<=this.maximum)}if(b){return true}return new coherent.Error({description:this.invalidValueMessage})},isValidInputCharacter:function(a){if(this.allowsFloats){return(-1!==this.validFloatCharacters.indexOf(a))}else{return(-1!==this.validIntCharacters.indexOf(a))}}});coherent.RegexFormatter=Class.create(coherent.Formatter,{constructor:function(a){this.base(a);this.typeofValidCharacters=typeof(this.validCharacters);if(this.invalidRegex&&"exec" in this.invalidRegex){this.invalidRegex=[this.invalidRegex]}if(this.validRegex&&"exec" in this.validRegex){this.validRegex=[this.validRegex]}},isStringValid:function(b){var c;var a;var e;function d(f){return f.test(b)}if(!(this.invalidRegex&&this.invalidRegex.some(d))&&(this.validRegex&&this.validRegex.some(d))){return true}return new coherent.Error({description:this.invalidValueMessage})},isValidInputCharacter:function(a){if(!this.validCharacters){return true}if("string"===this.typeofValidCharacters){return(-1!==this.validCharacters.indexOf(a))}else{return this.validCharacters.test(a)}}});coherent.easing=(function(){var b=Math.PI/2;var a=Math.PI;return{linear:function(c){return c},linearCompleteAndReverse:function(c){return(c>0.5)?2-2*c:2*c},inSine:function(c){return 1-Math.cos(c*b)},outSine:function(c){return Math.sin(c*b)},inOutSine:function(c){return(1-Math.cos(c*a))/2},inBack:function(c,d){if(d==undefined){d=1.70158}return c*c*((d+1)*c-d)},outBack:function(c,d){if(d==undefined){d=1.70158}c=c-1;return(c*c*((d+1)*c+d)+1)},outBackStrong:function(c,d){if(d==undefined){d=1.70158*1.5}c=c-1;return(c*c*((d+1)*c+d)+1)}}})();coherent.fx=coherent.fx||{};(function(){coherent.fx.StepperBase=Class._create({cleanup:function(){this.element.style[this.property]=""},convertKeywords:function(a){switch(a){case"top":return"0% 50%";case"right":return"100% 50%";case"bottom":return"50% 100%";case"left":return"0% 50%";case"center":return"50% 50%";default:a=a.replace(/top|left/g,"0%");a=a.replace(/bottom|right/g,"100%");return a}},stripUnits:function(a){return parseInt(a,10)}});coherent.fx.ColourStepper=Class._create(coherent.fx.StepperBase,{constructor:function(d,b,e,a,c){this.property=d;this.element=b;this.start=Colour.fromString(e);this.end=Colour.fromString(a);if(coherent.Support.CSS3ColorModel){this.step=this.stepRGBA}else{this.step=this.stepRGB}this.delta={r:this.end.r-this.start.r,g:this.end.g-this.start.g,b:this.end.b-this.start.b,a:this.end.a-this.start.a};this.shouldCleanup=!!c},stepRGB:function(b){if(this.curve){b=this.curve(b)}var a=["rgb(",Math.round(b*this.delta.r+this.start.r),",",Math.round(b*this.delta.g+this.start.g),",",Math.round(b*this.delta.b+this.start.b),")"].join("");this.element.style[this.property]=a},stepRGBA:function(b){if(this.curve){b=this.curve(b)}var a=["rgba(",Math.round(b*this.delta.r+this.start.r),",",Math.round(b*this.delta.g+this.start.g),",",Math.round(b*this.delta.b+this.start.b),",",b*this.delta.a+this.start.a,")"].join("");this.element.style[this.property]=a},normaliseAlpha:function(){if(this.start.a===0){this.start.r=this.end.r;this.start.g=this.end.g;this.start.b=this.end.b}else{if(this.end.a===0){this.end.r=this.start.r;this.end.g=this.start.g;this.end.b=this.start.b}}}});if(!coherent.Support.CSS3ColorModel){coherent.fx.ColourStepper.prototype.step=coherent.fx.ColourStepper.prototype.stepRGB;coherent.fx.ColourStepper.prototype.normaliseAlpha=Class.emptyFn}coherent.fx.NumericStepper=Class._create(coherent.fx.StepperBase,{constructor:function(d,b,e,a,c){this.property=d;this.element=b;this.start=parseInt(e||0,10);this.end=parseInt(a||0,10);this.delta=this.end-this.start;this.shouldCleanup=!!c},step:function(a){if(this.curve){a=this.curve(a)}this.element.style[this.property]=Math.round(a*this.delta+this.start)+"px"}});coherent.fx.OpacityStepper=Class._create(coherent.fx.StepperBase,{constructor:function(b,d,a,c){this.element=b;this.start=parseFloat(d||0);this.end=parseFloat(a||0);this.delta=a-d;this.shouldCleanup=!!c},step:function(b){if(this.curve){b=this.curve(b)}var a=b*this.delta+this.start;this.element.style.opacity=(a>=1)?1:a},cleanup:function(){this.element.style.opacity=""}});coherent.fx.DiscreteStepper=Class._create(coherent.fx.StepperBase,{constructor:function(d,b,e,a,c){this.property=d;this.element=b;this.start=e;this.end=a;this.shouldCleanup=!!c},step:function(a){if(a<this.discreteTransitionPoint){return}this.element.style[this.property]=this.end;this.step=Class.emptyFn}});coherent.fx.ClassNameStepper=Class._create(coherent.fx.StepperBase,{constructor:function(b,c,a){this.element=b;this.start=c;this.end=a},step:function(a){if(a<this.discreteTransitionPoint){return}this.element.className=this.end;this.step=Class.emptyFn},cleanup:false});coherent.fx.BackgroundPositionStepper=Class._create(coherent.fx.StepperBase,{constructor:function(d,f,b,e){f=this.convertKeywords(f);b=this.convertKeywords(b);var c=f.match(/%|px/)[0];var a=b.match(/%|px/)[0];if(c!=a){return new coherent.fx.DiscreteStepper("backgroundPosition",d,f,b,e)}this.element=d;this.unit=c;this.start=Array.map(f.split(" "),this.stripUnits);this.end=Array.map(b.split(" "),this.stripUnits);this.delta=[this.end[0]-this.start[0],this.end[1]-this.start[1]];this.shouldCleanup=!!e;return this},step:function(a){if(this.curve){a=this.curve(a)}this.element.style.backgroundPosition=Math.round(a*this.delta[0]+this.start[0])+this.unit+" "+Math.round(a*this.delta[1]+this.start[1])+this.unit},cleanup:function(){if(coherent.Browser.IE){this.element.style.backgroundPositionX="";this.element.style.backgroundPositionY=""}else{this.element.style.backgroundPosition=""}}});Object.extend(coherent.fx,{getStepper:function(d,b,e,a,c){switch(d){case"classname":return new coherent.fx.ClassNameStepper(b,e,a);case"display":return new coherent.fx.DiscreteStepper(d,b,e,a,c);case"backgroundPosition":return new coherent.fx.BackgroundPositionStepper(b,e,a,c);case"backgroundColor":case"color":case"borderColor":case"borderTopColor":case"borderRightColor":case"borderBottomColor":case"borderLeftColor":return new coherent.fx.ColourStepper(d,b,e,a,c);case"opacity":return new coherent.fx.OpacityStepper(b,e,a,c);default:return new coherent.fx.NumericStepper(d,b,e,a,c)}}})})();if(coherent.Browser.IE){Class.extend(coherent.fx.OpacityStepper,{step:function(b){if(this.curve){b=this.curve(b)}var a=b*this.delta+this.start;this.element.style.filter=(a>=1)?"":"Alpha(Opacity="+a*100+")"},cleanup:function(){this.element.style.filter=""}})}coherent.Animator={Action:{MORPH_NODE:1,IGNORE_NODE:18,FADE_NODE:19,FADE_IN_NODE:20,FADE_OUT_NODE:21,MORPH_NODE_IGNORE_CHILDREN:22,IGNORE_CHILDREN_MASK:16}};(function(){var c=coherent.fx;var a={duration:500,discreteTransitionPoint:0.5,actions:{}};var h=null;var q={};var b=0;var p=0;var f=Element.getStyles;function s(t){var v=s.assignId(t);var u=s.actions[v]||s.MORPH_NODE;if(s.MORPH_NODE===u||s.MORPH_NODE_IGNORE_CHILDREN===u){s.info.__count++;s.info[v]=s.getStyles(t,s.propsToGet)}return(u&s.IGNORE_CHILDREN_MASK)?false:true}s.getStyles=Element.getStyles;s.assignId=Element.assignId;s.MORPH_NODE=coherent.Animator.Action.MORPH_NODE;s.MORPH_NODE_IGNORE_CHILDREN=coherent.Animator.Action.MORPH_NODE_IGNORE_CHILDREN;s.IGNORE_CHILDREN_MASK=coherent.Animator.Action.IGNORE_CHILDREN_MASK;function d(u,t,w){var v={};s.propsToGet=t;s.actions=w||{};s.info=v;Element.depthFirstTraversal(u,s);return v}function k(t){if("margin" in t){t.marginLeft=t.marginRight=t.marginTop=t.marginBottom=t.margin;delete t.margin}if("padding" in t){t.paddingLeft=t.paddingRight=t.paddingTop=t.paddingBottom=t.padding;delete t.padding}if("borderColor" in t){t.borderLeftColor=t.borderRightColor=t.borderTopColor=t.borderBottomColor=t.borderColor;delete t.borderColor}if("borderWidth" in t){t.borderLeftWidth=t.borderRightWidth=t.borderTopWidth=t.borderBottomWidth=t.borderWidth;delete t.borderWidth}return t}function g(){if(h){return}p=Date.now();h=window.setInterval(e,10)}function l(){if(!h){return}window.clearInterval(h);h=null;q={}}function e(){var w=coherent.EventLoop.getStart();var z;var y;var u;for(var v in q){var A=q[v];var x=A.properties;for(var B in x){u=x[B][0];if(w>=u.endTime){u.step(1);m(A,B)}else{if(u.startTime<=w){y=(w-u.startTime)/u.totalTime;u.step(y)}}}}p=w}function m(v,x){var w=[];var t=v.properties[x].shift();if(t.shouldCleanup&&t.cleanup){t.cleanup()}if(t.callback){w.push(t.callback)}if(!v.properties[x].length){delete v.properties[x];v.propCount--}if(!v.propCount){if(v.callback){w.push(v.callback)}delete (q[v.id]);b--}if(!b){l()}var u=w.length;for(var y=0;y<u;y++){w[y](v.node,x)}}function j(w,v,y){y=Object.applyDefaults(y,a);if(y.delay){j.delay(y.delay,w,v,y);delete y.delay;return}var E=Element.assignId(w);var x=q[E];if(!x){b++;x=q[E]={node:w,id:E,propCount:0,properties:{}}}if(y.callback){x.callback=y.callback}var u=coherent.EventLoop.getStart();var t=u+y.duration;var L=y.startStyles||f(w,Object.keys(v));k(v);for(var G in v){var C=v[G];var H=C;if("object"===typeof(H)&&"value" in H){H=H.value}var M=C.delay||0;var B=u+M;var z;if(C.duration){z=C.duration+B}else{z=t}var F=C.curve||y.curve;var K=C.discreteTransitionPoint||y.discreteTransitionPoint;var D=typeof(C.cleanup)!=="undefined"?C.cleanup:y.cleanup;var A;if(G in x.properties){A=x.properties[G]}else{x.propCount++;A=[]}function J(Q,R,N){var P=R.startTime<z&&R.endTime>z;var O=R.startTime<B&&R.endTime>B;var S=R.startTime<=B&&R.endTime>=z;if(!(O||P||S)){Q.push(R)}return Q}if(A.length){A=A.reduce(J,[])}var I=c.getStepper(G,w,L[G],H,D);I.startTime=B;I.endTime=z;I.totalTime=z-B;I.curve=F;I.discreteTransitionPoint=K;if("object"===typeof(C)&&"callback" in C){I.callback=C.callback}if(y.stepBackToZero){I.step(0)}A.push(I);x.properties[G]=A}g()}function n(t){var u=Element.assignId(t);return !!document.getElementById(u)}function r(D,G,H){var A;var t;H=Object.applyDefaults(Object.clone(H),a);if(H.delay){r.delay(H.delay,D,G,H);delete H.delay;return}if(!n(D)){D.className=G;if(H.callback){H.callback(D)}return}var C=H.only;var y=d(D,C,H.actions);var w=D.className;D.className=G;for(var v in y){var B=q[v];if(!B){continue}t=B.node.style;for(var u in B.properties){t[u]=""}}var z=d(D,C,H.actions);D.className=w;var F={};F[D.id]={classname:{value:G,duration:H.duration,callback:H.callback}};H.callback=null;function E(L){var K=L.id;var N=H.actions[K];var Q=y[K];var R=z[K];var T={};if(!N){var S=Q.display;var P=R.display;if(S=="none"&&P=="none"){N=coherent.Animator.Action.IGNORE_NODE}if(S=="none"&&P!=="none"){N=coherent.Animator.Action.FADE_IN_NODE}if(S!=="none"&&P=="none"){N=coherent.Animator.Action.FADE_OUT_NODE}}if("function"===typeof(N)){N=N(L,y,z)}if("object"===typeof(N)){T=N;N=coherent.Animator.Action.MORPH_NODE}switch(N){case coherent.Animator.Action.IGNORE_NODE:return false;case coherent.Animator.Action.FADE_NODE:F[K]=F[K]||{};F[K].opacity={value:0,duration:H.duration,curve:coherent.easing.linearCompleteAndReverse};return false;case coherent.Animator.Action.FADE_OUT_NODE:F[K]=F[K]||{};F[K].opacity={value:0,duration:H.duration/2,cleanup:false};return false;case coherent.Animator.Action.FADE_IN_NODE:Q.opacity=0;F[K]=F[K]||{};F[K].opacity={value:1,duration:H.duration/2,delay:H.duration/2};return false;case coherent.Animator.Action.MORPH_NODE:default:for(var J in Q){var M=q[K];var O=T[J];var I=O?(O.value||O):R[J];if((M&&J in M.properties)||(String(Q[J])!=String(I))){F[K]=F[K]||{};if(J in T){if(O.value){F[K][J]=O}else{F[K][J]={value:O}}F[K][J].cleanup=false}else{F[K][J]=I}}}return(N&coherent.Animator.Action.IGNORE_CHILDREN_MASK)?false:true}}Element.depthFirstTraversal(D,E);H.stepBackToZero=true;H.cleanup=true;for(var x in F){A=document.getElementById(x);if(!A){continue}H.startStyles=y[x];j(A,F[x],H)}}function o(t,v){var u=t.indexOf(v);if(-1!==u){t.splice(u,1)}return t}function i(t,v){var u=t.indexOf(v);if(-1===u){t.push(v)}return t}Object.extend(coherent.Animator,{addClassName:function(v,w,u){if(!w){return}if("object"===typeof(w)&&"classname" in w){u=w;w=u.classname}var x=Element.regexForClassName(w);var t=coherent.Animator.classname(v);if(!x.test(t)){if(t){t+=" "+w}else{t=w}}r(v,t,u)},removeClassName:function(v,w,u){var t=coherent.Animator.classname(v);var x;if("object"===typeof(w)&&"classname" in w){u=w;w=u.classname}if(t===w){r(v,"",u);return}t=t.split(" ");if("string"===typeof(w)){t=o(t,w)}else{t=w.reduce(o,t)}r(v,t.join(" "),u)},setClassName:function(u,v,t){r(u,v,t)},replaceClassName:function(x,w,t,v){var u=coherent.Animator.classname(x);if(w){var y=Element.regexForClassName(w);t=u.replace(y,"$1"+t+"$2")}else{t=u+" "+t}r(x,t,v)},animateClassName:function(x,w){var v=coherent.Animator.classname(x).split(" ");var u=w.reverse;var y=u?w.remove:(w.add||w.classname);var t=u?(w.add||w.classname):w.remove;if(y){if("string"===typeof(y)){v=i(v,y)}else{v=y.reduce(i,v)}}if(t){if("string"===typeof(t)){v=o(v,t)}else{v=t.reduce(o,v)}}if(w.duration){r(x,v.join(" "),w)}else{x.className=v.join(" ");if(w.callback){w.callback(x)}}},classname:function(u){var x=Element.assignId(u);var v;var t;var w;if((v=q[x])&&(w=v.properties.classname)){return w[0].end}else{return(u.className||"")}},setStyles:j,abort:function(){q={};l()}})})();function NIB(c){var o=coherent.dataModel;var g=coherent.dataModel=NIB.__model;var q=!g;if(q){g=coherent.dataModel=new coherent.KVO();g.setValueForKey(coherent.Application.shared,"owner");g.setValueForKey(coherent.Application.shared,"application")}var m;var b;var j=coherent.KVO.typesOfKeyValuesToIgnore;var f=coherent.typeOf;var n=[];var e=NIB.specialKeys;var r=[];for(b in c){if(b in e){continue}m=c[b];if(m&&"function"===typeof(m)&&m.__factoryFn__){m=m.call(g)}if(m instanceof coherent.Asset){m=m.content()}var k=f(m);if("array"===k||!(k in j||"addObserverForKeyPath" in m)){coherent.KVO.adaptTree(m)}if(m instanceof coherent.View){n.push(m)}else{if("awakeFromNib" in m){r.push(m)}}g.setValueForKey(m,b)}g.__views=n;for(var l in e){var a=c[l];var i=g.valueForKey(l);var d;if(!i){continue}for(b in a){m=a[b];if("string"!==typeof(m)){i.setValueForKeyPath(m,b);continue}d=g.valueForKeyPath(m);if(null===d||"undefined"===typeof(d)){i.setValueForKeyPath(m,b);continue}i.setValueForKeyPath(d,b)}}var h=r.length;while(h--){r[h].awakeFromNib()}h=n.length;while(h--){NIB.__awakeViewsFromNib(n[h])}coherent.dataModel=o;if(q){coherent.Application.shared.__bundleLoaded(g)}}Object.extend(NIB,{asset:function(a,b){return new coherent.Asset(a,b)},__awakeViewsFromNib:function(b){var c=b.node;if(!c){return}var a=c.nextSibling||c.parentNode;var d=coherent.View.fromNode;while(c!==a){if(1===c.nodeType&&c.firstChild){c=c.firstChild;continue}while(!c.nextSibling){if(1===c.nodeType&&(b=d(c))&&b.awakeFromNib){b.awakeFromNib()}c=c.parentNode;if(c===a){return}}if(1===c.nodeType&&(b=d(c))&&b.awakeFromNib){b.awakeFromNib()}c=c.nextSibling}},__scriptLoaded:function(c,a,f){var e=document.getElementsByTagName("head")[0];var b=document.createElement("script");b.type="text/javascript";b.defer=false;window.__filename__=String(c);var d=NIB.__model=new coherent.KVO();NIB.__model.setValueForKey(a,"owner");NIB.__model.setValueForKey(coherent.Application.shared,"application");if(coherent.Browser.IE){b.text=f}else{b.appendChild(document.createTextNode(f))}e.appendChild(b);NIB.__model=null;window.__filename__=null;return d},load:function(b,a){var c=XHR.get(b,null,{responseContentType:"text/plain"});c.addCallback(NIB.__scriptLoaded.bind(null,b,a));return c},specialKeys:{owner:true,application:true}});coherent.Anchor=Class.create(coherent.View,{exposedBindings:["href","title"],href:function(){var a=this.node;return a.getAttribute("href")},setHref:function(a){var b=this.node;b.href=a},title:function(){var a=this.node;return a.getAttribute("title")},setTitle:function(b){var a=this.node;a.title=b},onclick:function(b){var a=this.href();if("#"===a){Event.preventDefault(b)}this.base(b)}});coherent.Overlay=Class.create(coherent.View,{modal:false,clickOutsideToDismiss:false,backdropClassName:"modal-overlay-backdrop",guardClassName:"modal-overlay-guard",init:function(){this.node.style.display="none"},showModalBackdrop:function(a){var d=this.__animationOptionsForProperty("visible");var b=coherent.Overlay.modalLayer;if(!b){b=document.createElement("div");b.className=this.backdropClassName;b.style.display="none";Element.addClassName(b,d.classname);document.body.appendChild(b);coherent.Overlay.modalLayer=b}var c=this.node;c.parentNode.insertBefore(b,c);b.style.display="";function e(){b.style.display=a?"":"none"}d.callback=e;d.reverse=a;coherent.Animator.animateClassName(b,d)},showGuard:function(a){var d=this.__animationOptionsForProperty("visible");var c=this.guard;if(!c){this.guard=c=document.createElement("div");c.className=this.guardClassName;c.style.display="none";Element.addClassName(c,d.classname);document.body.appendChild(c)}var b=this.node;b.parentNode.insertBefore(c,b);c.style.display="";function e(){c.style.display=a?"":"none"}d.callback=e;d.reverse=a;coherent.Animator.animateClassName(c,d)},updatePosition:function(){},updateContent:function(){},onmouseup:function(a){var b=a.target||a.srcElement;if(Element.contains(this.node,b)){return}if(this.clickOutsideToDismiss){this.setVisible(false)}},setVisible:function(a){document.body.appendChild(this.node);a=!!a;var c=coherent.page.__mouseEventListeners;var b=c.indexOf(this);if(a){this.updateContent();this.updatePosition();if(this.clickOutsideToDismiss&&-1===b){coherent.page.__mouseEventListeners.push(this)}}else{coherent.page.__mouseEventListeners.removeObjectAtIndex(b)}if(a===this.visible()){return}if(!this.modal){this.base(a);return}if(a){if(!coherent.Overlay.numberOfModalOverlays){this.showModalBackdrop(a)}coherent.Overlay.numberOfModalOverlays++}else{coherent.Overlay.numberOfModalOverlays=Math.max(0,coherent.Overlay.numberOfModalOverlays-1);if(!coherent.Overlay.numberOfModalOverlays){this.showModalBackdrop(a)}}this.showGuard(a);this.base(a)}});coherent.Overlay.numberOfModalOverlays=0;coherent.Overlay.Position={ABOVE:coherent.Style.kOverlayAbove,BELOW:coherent.Style.kOverlayBelow,LEFT:coherent.Style.kOverlayLeft,RIGHT:coherent.Style.kOverlayRight};coherent.Bubble=Class.create(coherent.Overlay,{contentSelector:".ui-bubble-content",markup:'<div class="ui-bubble"></div>',innerHTML:'<span class="ui-bubble-chrome ui-bubble-tl"></span><span class="ui-bubble-chrome ui-bubble-tr"></span><span class="ui-bubble-chrome ui-bubble-top"></span><span class="ui-bubble-chrome ui-bubble-left"></span><span class="ui-bubble-chrome ui-bubble-right"></span><span class="ui-bubble-chrome ui-bubble-bottom"></span><span class="ui-bubble-chrome ui-bubble-bl"></span><span class="ui-bubble-chrome ui-bubble-br"></span><span class="ui-bubble-chrome ui-bubble-center"></span><div class="ui-bubble-container"><div class="ui-bubble-content"></div></div><span class="ui-bubble-chrome ui-bubble-arrow"></span>',relativePosition:coherent.Overlay.Position.ABOVE,arrowSelector:".ui-bubble-arrow",constrainToView:function(a){this.within=(a.node?a.node:a);if(this.visible()){this.updatePosition()}},attachToView:function(a){this.anchor=(a.node?a.node:a);if(this.visible()){this.updatePosition()}},init:function(){this.base();this.setContainer(Element.query(this.node,this.contentSelector))},updatePosition:function(){var c=this.node;var m=Element.query(c,this.arrowSelector);var b=Element.getRect(this.anchor);var i=Element.getViewport();var j;var e=c.style.visibility;var h=c.style.display;c.style.visibility="hidden";c.style.display="";if(this.within){j=Element.getRect(this.within)}else{var a=Element.getDimensions(c);var l=parseInt(b.left,10)+Math.floor(b.width/2);var n=Math.floor(a.width/2);j={left:l-n,right:l+n,width:a.width}}c.style.left=j.left+"px";c.style.width=j.width+"px";c.style.width=(j.width-(c.offsetWidth-j.width))+"px";Element.removeClassName(c,"below");var f;var d;if(m){f=m.offsetHeight;d=m}else{f=0;d=c}var g=f+parseInt(Element.getStyle(d,"marginBottom")||0,10);var k=b.top-c.offsetHeight-g;if(k<i.top||"below"===this.relativePosition){Element.addClassName(c,"below");g=f+parseInt(Element.getStyle(d,"marginTop")||0,10);k=b.bottom+g}c.style.top=k+"px";m.style.left=(b.left-j.left+b.width/2)+"px";c.style.visibility=e;c.style.display=h},onmouseup:function(a){var b=a.target||a.srcElement;if(Element.contains(this.anchor,b)||Element.contains(this.node,b)){return}if(this.clickOutsideToDismiss){this.setVisible(false)}}});coherent.FormControl=Class.create(coherent.View,{exposedBindings:["value","name"],maskedBindings:["text","html"],value:function(){if(this.formatter){return this.formatter.valueForString(this.node.value)}return this.node.value},setValue:function(b){var a=this.bindings.value&&this.bindings.value.markerType;if(!a&&this.formatter){b=this.formatter.stringForValue(b)}this.node.value=b},observeValueChange:function(c){var b=c.newValue;if(coherent.ChangeType.validationError===c.changeType){this.presentError(b);return}var a=this.bindings.value&&this.bindings.value.markerType;if(!a&&this.formatter){b=this.formatter.stringForValue(b)}if(coherent.NoSelectionMarkerType===a){this.setEnabled(false)}else{if(!this.bindings.enabled){this.setEnabled(true)}}if(!this.bindings.editable){this.setEditable(this.bindings.value.mutable())}if(!this.bindings.errorMessage){this.clearAllErrors()}if(this.hasFocus){return}this.setValue(b)},name:function(){return this.node.name},setName:function(a){this.node.name=a},validate:function(){var b=this.node.value;if(this.__showingPlaceholder){b=""}if(this.formatter){var a=this.formatter.isStringValid(b);if(a instanceof coherent.Error){this.presentError(a);return a}b=this.formatter.valueForString(b)}if(this.bindings.value){b=this.bindings.value.validateProposedValue(b);if(b instanceof coherent.Error){this.presentError(b);return b}}return b}});coherent.Button=Class.create(coherent.FormControl,{onmousedown:function(b){var a=this.node;Element.addClassName(a,coherent.Style.kActiveClass)},onmouseup:function(b){var a=this.node;Element.removeClassName(a,coherent.Style.kActiveClass)}});coherent.CollectionView=Class.create(coherent.View,{animationOptions:{selection:{classname:coherent.Style.kSelectedClass},content:{classname:coherent.Style.kUpdatingClass},insertion:{classname:coherent.Style.kInsertedClass,duration:100},deletion:{classname:coherent.Style.kDeletedClass,duration:100},replacement:{classname:coherent.Style.kReplacingClass}},exposedBindings:["content","selectionIndexes"],allowsEmptySelection:true,multiple:false,multipleSelectWithoutModifiers:false,init:function(){this.base();this.__content=[];this.__items=[];this.__selectionIndexes=[];var c=this.node;var a;var b;if("TABLE"===c.tagName){a=this.setContainer(c.tBodies[0]);b=a.rows.length&&a.rows[0]}else{a=this.container();b=a.children[0]}if(b){this.templateNode=Element.clone(b)}while(a.firstChild){a.removeChild(a.firstChild)}if(!this.viewTemplate){throw new Error("No view template specified for CollectionView")}if(this.viewTemplate&&!this.viewTemplate.__factoryFn__){this.viewTemplate=this.viewTemplate()}},acceptsFirstResponder:function(){var a=this.node;return !(a.disabled||a.readOnly)},newItemForRepresentedObject:function(d){var a=coherent.dataModel;var c=new coherent.KVO.Proxy(this.__context);coherent.dataModel=c;var b;if(this.templateNode){b=Element.clone(this.templateNode)}c.setValueForKey(d,"representedObject");c.setValueForKey(this.viewTemplate(b,null),"view");c.setValueForKey(b||c.view.node,"node");coherent.dataModel=a;return c},content:function(){return this.__content},setContentStatic:function(f){var a=this.container();this.__content=f=f?f.copy():[];var e=this.__items;var g=e.length;var b=f.length;var c=Math.min(g,b);var d=0;var j;while(d<c){e[d].setValueForKey(f[d],"representedObject");++d}if(d<b){var h=document.createDocumentFragment();while(d<b){j=this.newItemForRepresentedObject(f[d]);e.push(j);h.appendChild(j.node);++d}a.appendChild(h)}else{while(d<g){this.removeChild(e[d].node);++d}e.length=b}},setContent:function(k){var h=this;var d=coherent.Animator;var a=this.container();var o=this.__animationOptionsForProperty("insertion");o.reverse=true;var j=this.__animationOptionsForProperty("deletion");j.callback=function(r){r.style.display="none";Element.removeClassName(r,j.classname);h.removeChild(r)};if(!o.duration&&!j.duration){this.setContentStatic(k);return}k=k?k.copy():[];var i=this.__content;var b=i.length;var g=k.length;var l=0;var n=0;var c;var m=this.__items;var q=[];var e=[];var p;var f;while(l<b&&n<g){p=m[l];if(k[n]===i[l]){if(p.selected){e.push(n)}q.push(p);n++;l++;continue}c=k.indexOf(i[l],n+1);if(-1===c){l++;d.animateClassName(p.node,j);continue}while(n<c){f=this.newItemForRepresentedObject(k[n]);q.push(f);Element.addClassName(f.node,o.classname);a.insertBefore(f.node,p?p.node:null);d.animateClassName(f.node,o);n++}if(p.selected){e.push(n)}q.push(p);n++;l++}while(l<b){p=m[l];l++;d.animateClassName(p.node,j)}while(n<g){f=this.newItemForRepresentedObject(k[n]);q.push(f);Element.addClassName(f.node,o.classname);a.insertBefore(f.node,null);d.animateClassName(f.node,o);n++}this.willChangeValueForKey("selectionIndexes");this.__content=k;this.__items=q;this.__selectionIndexes=e;this.didChangeValueForKey("selectionIndexes")},observeContentChange:function(l){if(l.changeType===coherent.ChangeType.setting){this.setContent(l.newValue);return}var a=this.container();var b=Array.from(a.children);var k=this.__items;var n;var i;var j=l.indexes.length;var d;var g=l.indexes;var m;var e;var f;var c=coherent.Animator;var h=this;switch(l.changeType){case coherent.ChangeType.insertion:e=this.__animationOptionsForProperty("insertion");e.reverse=true;f=!!e.duration;n=l.newValue.map(this.newItemForRepresentedObject,this);for(i=0;i<j;++i){d=g[i];m=k[d];if(f){Element.addClassName(n[i].node,e.classname)}a.insertBefore(n[i].node,m?m.node:null);if(f){c.animateClassName(n[i].node,e)}}this.__content.insertObjectsAtIndexes(l.newValue,g);k.insertObjectsAtIndexes(n,g);break;case coherent.ChangeType.deletion:e=this.__animationOptionsForProperty("deletion");e.callback=function(o){o.style.display="none";Element.removeClassName(o,e.classname);h.removeChild(o)};f=!!e.duration;g.sort(coherent.reverseCompareNumbers);for(i=0;i<j;++i){d=g[i];if(f){c.animateClassName(k[d].node,e)}else{this.removeChild(k[d].node)}}k.removeObjectsAtIndexes(g);this.__content.removeObjectsAtIndexes(g);break;case coherent.ChangeType.replacement:for(i=0;i<j;++i){k[g[i]].setValueForKey(l.newValue[i],"representedObject")}this.__content.replaceObjectsAtIndexesWithObjects(g,l.newValue);break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+l.changeType);break}},selectionIndexes:function(){return this.__selectionIndexes},setSelectionIndexes:function(g){var c=this.__items;var a=c.length;var d;var f;var e;var b;var h=this.__animationOptionsForProperty("selection");if(g){this.__selectionIndexes=g.sort(coherent.compareNumbers)}else{this.__selectionIndexes=[]}e=this.__selectionIndexes.copy();b=e.shift();for(d=0;d<a;++d){f=c[d];if((f.selected=(d===b))){b=e.shift()}f.view.animateClassName(h,!f.selected)}},observeSelectionIndexesChange:function(d){if(coherent.ChangeType.setting===d.changeType){this.setSelectionIndexes(d.newValue);return}var c=this.__animationOptionsForProperty("selection");var a=this.__items;var b;switch(d.changeType){case coherent.ChangeType.insertion:this.__selectionIndexes.insertObjectsAtIndexes(d.newValue,d.indexes);d.newValue.forEach(function(e){b=a[e];b.selected=true;b.view.animateClassName(c)});break;case coherent.ChangeType.deletion:this.__selectionIndexes.removeObjectsAtIndexes(d.indexes);d.oldValue.forEach(function(e){b=a[e];b.selected=false;b.view.animateClassName(c,true)});break;case coherent.ChangeType.replacement:this.__selectionIndexes.replaceObjectsAtIndexesWithObjects(d.indexes,d.newValue);d.oldValue.forEach(function(e){b=a[e];b.selected=false;b.view.animateClassName(c,true)});d.newValue.forEach(function(e){b=a[e];b.selected=true;b.view.animateClassName(c)});break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+d.changeType);break}},itemNodeFromEvent:function(b){var c=b.target||b.srcElement;var a=this.container();if(c===a){return null}while(c&&c.parentNode!=a){c=c.parentNode}if(c===a){return null}return c},ontouchstart:function(a){this.__touchedRow=this.itemNodeFromEvent(a)},onmousedown:function(b){if(this.node.disabled){return}var a=(coherent.Support.Touches&&this.__touchedRow)||this.itemNodeFromEvent(b);if(!a){return}this.__activeNode=a;Element.addClassName(a,coherent.Style.kActiveClass)},onmouseup:function(a){if(this.node.disabled){return}if(this.__activeNode){Element.removeClassName(this.__activeNode,coherent.Style.kActiveClass)}this.__activeNode=null},ontouchmove:function(a){if(this.node.disabled){return}if(this.__activeNode){Element.removeClassName(this.__activeNode,coherent.Style.kActiveClass)}this.__activeNode=null;this.base(a)},onclick:function(b){var f=this.node;if(f.disabled){this.base(b);Event.stop(b);return}var h=this.itemNodeFromEvent(b);if(!h){return}var c=this.container();var a=Array.from(c.children).indexOf(h);var g=this.selectionIndexes().copy();var j=b.ctrlKey||b.metaKey;var d=b.shiftKey;this.extendIndex=a;if(this.multipleSelectWithoutModifiers||j){this.anchorIndex=a;var i=g.indexOf(a);if(-1===i){if(this.multiple){g.push(a)}else{g=[a]}}else{if(this.allowsEmptySelection||g.length>1){g.splice(i,1)}}}else{if(d&&this.multiple){g=IndexRange(a,this.anchorIndex)}else{g=[this.anchorIndex=a]}}this.setSelectionIndexes(g);if(this.bindings.selectionIndexes){this.bindings.selectionIndexes.setValue(g)}this.sendAction()},onkeydown:function(a){var d=this.node;if(d.disabled){return}var m=a.keyCode;if(Event.KEY_UP_ARROW!==m&&Event.KEY_DOWN_ARROW!==m){return}Event.stop(a);var h=this.selectionIndexes().copy();var f=this.__content.length-1;var i=h.length;var j=this.extendIndex;if(Event.KEY_UP_ARROW==m){j=i?Math.max(0,j-1):f}else{j=i?Math.min(f,j+1):0}if(j===this.extendIndex){return}this.extendIndex=j;if(i&&this.multiple&&a.shiftKey){h=IndexRange(this.anchorIndex,j)}else{h=[this.anchorIndex=j]}var b=this.container();var l=b.children[j];var k=Element.scrollParent(d);var g=k.offsetHeight;var c=l.offsetTop-k.scrollTop;var e=l.offsetHeight;if(l.offsetParent!==b){c-=b.offsetTop}if(c<0){l.scrollIntoView(true)}else{if(c+e>g){l.scrollIntoView(false)}}this.setSelectionIndexes(h);if(this.bindings.selectionIndexes){this.bindings.selectionIndexes.setValue(h)}}});coherent.ErrorBubble=Class.create(coherent.Bubble,{markup:'<div class="bubble"></div>',innerHTML:'<span class="chrome tl"></span><span class="chrome tr"></span><span class="chrome top"></span><span class="chrome left"></span><span class="chrome right"></span><span class="chrome bottom"></span><span class="chrome bl"></span><span class="chrome br"></span><a href="#" class="close">close</a><span class="chrome center"></span><div class="container"><div class="content"></div><ul class="buttons"><li><button></button></li></ul></div><span class="chrome arrow"></span>',__structure__:{".buttons":coherent.CollectionView({visibleBinding:"recoveryOptions",contentBinding:"recoveryOptions",action:"recoveryButtonClicked",viewTemplate:VIEW({button:coherent.Button({textBinding:"representedObject.text"})})})},error:function(){return this.__error},setError:function(a){this.__error=a},updateContent:function(){if(!this.__error){return}var e=this.__error;var c=this.container();var b;b=document.createTextNode(e.description);c.innerHTML="";c.appendChild(b);if(e.recoveryOptions&&e.recoveryAttempter){function a(g){var f=new coherent.KVO();f.text=g;return f}var d=e.recoveryOptions.map(a);this.setValueForKey(d,"recoveryOptions")}}});coherent.FieldGroup=Class.create(coherent.View,{capturePresentError:true,presentErrorsImmediately:false,init:function(){this.__currentViewId=false;this.__fieldErrors={};if(!this.__bubble){coherent.FieldGroup.prototype.__bubble=new coherent.ErrorBubble()}coherent.page.addObserverForKeyPath(this,"observeFirstResponderChange","firstResponder")},teardown:function(){coherent.page.removeObserverForKeyPath(this,"firstResponder");this.base()},validateFields:function(){var b=Element.queryAll(this.node,"input,textarea");var a=b.length;var h;var e;var c;var g=true;for(var d=0;d<a;++d){h=coherent.View.fromNode(b[d]);if(!h){continue}if("validate" in h){c=h.validate();if(c instanceof coherent.Error){g=false;e=e||h}}}if(e){e.focus()}return g},presentError:function(a){if(!this.capturePresentError){this.base(a);return}var b=a.field;if(!b){return}this.__fieldErrors[b.id]=a;if(this.presentErrorsImmediately){this.__presentError(a)}},__presentError:function(a){var b=a.field;this.__currentViewId=b.id;this.__bubble.constrainToView(this);this.__bubble.attachToView(b);this.__bubble.setError(a);this.__bubble.setVisible(true)},clearAllErrors:function(a){if(!this.capturePresentError){this.base(a);return}delete this.__fieldErrors[a.id];if(this.__currentViewId==a.id){if(this.__bubble.anchor&&this.__currentViewId===this.__bubble.anchor.id){this.__bubble.setVisible(false)}this.__currentViewId=false}},observeFirstResponderChange:function(c){if(!this.capturePresentError){return}var b=c.newValue;var a=!!b&&this.__fieldErrors[b.id];if(!a||!b.isDescendantOf(this)){if(this.__bubble.anchor&&this.__currentViewId===this.__bubble.anchor.id){this.__bubble.setVisible(false)}this.__currentViewId="";return}if(this.__currentViewId===b.id){return}this.__presentError(a)}});coherent.Form=Class.create(coherent.FieldGroup,{exposedBindings:["actionUrl","method"],sendActionOn:["submit"],onsubmit:function(a){if(!this.action||!this.sendActionOn.containsObject("submit")){return}Event.stop(a);this.sendAction()},actionUrl:function(){return this.node.action},setActionUrl:function(a){this.node.action=a},method:function(){return this.node.method},setMethod:function(a){this.node.method=a}});if(coherent.Browser.IE){Class.extend(coherent.Form,{onfocus:function(b){var a=this.node;Event.stopObserving(a,"submit",this.__submitHandler);Event.stopObserving(a,"reset",this.__resetHandler);this.__submitHandler=Event.observe(a,"submit",this.onsubmit.bind(this));this.__resetHandler=Event.observe(a,"reset",this.onreset.bind(this))},onblur:function(b){var a=this.node;Event.stopObserving(a,"submit",this.__submitHandler);Event.stopObserving(a,"reset",this.__resetHandler)}})}coherent.Image=Class.create(coherent.View,{exposedBindings:["src","alt","width","height"],maskedBindings:["text","html"],init:function(){this.base();var b=this.node;if(!this.defaultPlaceholders.src&&b.src){var a=this.defaultPlaceholders.src={};a.nullValue=a.noSelection=b.src}},teardown:function(){var a=this.node;Event.stopObserving(a,"load",this.__onloadHandler);Event.stopObserving(a,"error",this.__onerrorHandler);this.base()},onload:function(){var a=this.node;this.setValueForKey(false,"loading");Element.removeClassName(a,coherent.Style.kLoadingClass);Event.stopObserving(a,"load",this.__onloadHandler);Event.stopObserving(a,"error",this.__onerrorHandler)},onerror:function(){var a=this.node;this.setValueForKey(false,"loading");Element.updateClass(a,coherent.Style.kInvalidValueClass,coherent.Style.kLoadingClass);Event.stopObserving(a,"load",this.__onloadHandler);Event.stopObserving(a,"error",this.__onerrorHandler)},src:function(){var a=this.node.src;return("about:blank"===a)?null:a},setSrc:function(b){if(this.bindings.src){this.bindings.src.setValue(b)}this.setValueForKey(true,"loading");var c=this.node;Element.updateClass(c,coherent.Style.kLoadingClass,coherent.Style.kInvalidValueClass);if(!b){b="about:blank"}Event.stopObserving(c,"load",this.__onloadHandler);Event.stopObserving(c,"error",this.__onerrorHandler);this.__onloadHandler=Event.observe(c,"load",this.onload.bind(this));this.__onerrorHandler=Event.observe(c,"error",this.onerror.bind(this));var a=c.src;c.src=b;if(coherent.Browser.Safari&&c.src===a){this.onload()}},observeSrcChange:function(c){var b=this.node;var a=this.bindings.src&&this.bindings.src.markerType;if(a){Element.addClassName(b,coherent.Style.kMarkerClass)}else{Element.removeClassName(b,coherent.Style.kMarkerClass)}this.setSrc(c.newValue)},width:function(){return parseInt(this.node.width,10)},setWidth:function(c){var b=this.node;var a=parseInt(c,10);if(isNaN(a)){b.removeAttribute("width")}else{b.width=a}},height:function(){return parseInt(this.node.height,10)},setHeight:function(b){var c=this.node;var a=parseInt(b,10);if(isNaN(a)){c.removeAttribute("height")}else{c.height=a}},alt:function(){return this.node.alt},setAlt:function(a){this.node.alt=(a||"")}});coherent.Media=Class.create(coherent.View,{exposedBindings:["src","currentTime","volume","muted","autoplay","controls","loop","playing"],init:function(){this.base();if(this.initialVolume){this.setVolume(this.initialVolume)}var a=this.node;this.__onendedHandler=Event.observe(a,"ended",this.mediaDidEnd.bind(this));this.__onplayHandler=Event.observe(a,"play",this.mediaPlayingStateChanged.bind(this));this.__onpauseHandler=Event.observe(a,"pause",this.mediaPlayingStateChanged.bind(this))},teardown:function(){var a=this.node;Event.stopObserving(a,"ended",this.__onendedHandler);Event.stopObserving(a,"play",this.__onplayHandler);Event.stopObserving(a,"pause",this.__onpauseHandler);this.base()},isSupported:function(){return("paused" in this.node)},pause:function(){var a=this.node;if(!a.paused){a.pause()}},mediaPlayingStateUpdated:function(){this.forceChangeNotificationForKey("playing")},play:function(){this.node.play();this.forceChangeNotificationForKey("ended")},playing:function(){return !this.node.paused},stop:function(){var a=this.node;a.currentTime=a.duration},muted:function(){return this.node.muted},setMuted:function(a){if(this.bindings.muted){this.bindings.muted.setValue(a)}this.node.muted=a},volume:function(){return this.node.volume},setVolume:function(a){if(this.bindings.volume){this.bindings.volume.setValue(a)}this.node.volume=Math.min(1,a)},mediaDidEnd:function(a){this.forceChangeNotificationForKey("ended");this.forceChangeNotificationForKey("playing")},ended:function(){return this.node.ended},autoplay:function(){return this.node.autoplay},setAutoplay:function(a){if(this.bindings.autoplay){this.bindings.autoplay.setValue(a)}this.node.autoplay=a},controls:function(){return this.node.controls},setControls:function(a){if(this.bindings.controls){this.bindings.controls.setValue(a)}this.node.controls=a},loop:function(){return this.node.loop},setLoop:function(a){if(this.bindings.loop){this.bindings.loop.setValue(a)}this.node.loop=a},src:function(){return this.node.src},setSrc:function(a){if(this.bindings.src){this.bindings.src.setValue(a)}var b=this.node;b.src=a;b.load();this.forceChangeNotificationForKey("ended")}});coherent.OutlineView=Class.create(coherent.View,{animationOptions:{selection:{classname:coherent.Style.kSelectedClass}},exposedBindings:["content","selectedObject","selectedObjects"],childrenKeyPath:"children",disclosureButtonClassName:coherent.Style.kOutlineDisclosureButton,init:function(){this.base();this.__content=[];this.__rootItem=null;this.__selectedObjects=[];this.__objectToItemMap={};this.__nodeToItemMap={};var c=this.node;var a;var b;if("TABLE"===c.tagName){a=this.setContainer(c.tBodies[0]);b=a.rows.length&&a.rows[0]}else{a=this.container();b=c.children[0]}if(b){this.templateNode=Element.clone(b)}while(a.firstChild){a.removeChild(a.firstChild)}if(!this.viewTemplate){throw new Error("No view template specified for OutlineView")}if(this.viewTemplate&&!this.viewTemplate.__factoryFn__){this.viewTemplate=this.viewTemplate()}},acceptsFirstResponder:function(){var a=this.node;return !(a.disabled||a.readOnly)},newItemForRepresentedObject:function(e,b){var a=coherent.dataModel;var d=Object.clone(this.__context);d.initialiseKeyValueObserving();d.__keys={};coherent.dataModel=d;var c;if(this.templateNode){c=Element.clone(this.templateNode)}d.representedObject=e;d.parent=b;d.level=b?b.level+1:1;d.expanded=false;if(this.leafKeyPath){d.leaf=!!e.valueForKeyPath(this.leafKeyPath)}else{d.leaf=(0===(e.valueForKeyPath(this.childrenKeyPath)||[]).length)}d.view=this.viewTemplate(c,null);d.node=c||d.view.node;d.hasDisclosureButton=Element.query(d.node,"."+this.disclosureButtonClassName);this.__objectToItemMap[e.__uid]=d;this.__nodeToItemMap[d.node.id]=d;Element.addClassName(d.node,coherent.Style.kOutlineLevelPrefix+d.level);if(d.leaf){Element.addClassName(d.node,coherent.Style.kOutlineLeaf)}coherent.dataModel=a;return d},updateItemWithRepresentedObject:function(b,a){b.willChangeValueForKey("leaf");b.willChangeValueForKey("representedObject");b.willChangeValueForKey("expanded");if(b.expanded){this.__collapseItem(b)}b.representedObject=a;if(this.leafKeyPath){b.leaf=!!a.valueForKeyPath(this.leafKeyPath)}else{b.leaf=(0===(a.valueForKeyPath(this.childrenKeyPath)||[]).length)}if(b.leaf){Element.addClassName(b.node,coherent.Style.kOutlineLeaf)}else{Element.removeClassName(b.node,coherent.Style.kOutlineLeaf)}b.didChangeValueForKey("leaf");b.didChangeValueForKey("representedObject");b.didChangeValueForKey("expanded")},observeNodeChildrenChange:function(j){var n=this.__objectToItemMap[j.object.__uid];if(coherent.ChangeType.setting===j.changeType){this.__updateChildrenForItem(n,j.newValue);return}var c=this.container();var f=j.indexes;var i=n.childNodes;var h=f.length;var k;var d;var g;switch(j.changeType){case coherent.ChangeType.insertion:var e=n.parentNode;var b;var m;if(e){var a=e.childNodes.indexOf(n);var l=e.childNodes[a+1];b=l?l.node:null}m=j.newValue.map(function(o){return this.newItemForRepresentedObject(o,n)},this);for(g=0;g<h;++g){d=f[g];k=d<h?i[d].node:b;c.insertBefore(m[g].node,k)}i.insertObjectsAtIndexes(m,f);break;case coherent.ChangeType.replacement:for(g=0;g<h;++g){this.updateItemWithRepresentedObject(i[f[g]],j.newValue[g])}break;case coherent.ChangeType.deletion:f.sort(coherent.reverseCompareNumbers);for(g=0;g<h;++g){d=f[g];this.__disposeItem(i[d])}i.removeObjectsAtIndexes(f);break;case coherent.ChangeType.validationError:break;default:throw new Error("Unknown change type: "+j.changeType)}},__disposeItem:function(b){this.removeChild(b.node);delete this.__objectToItemMap[b.representedObject.__uid];delete this.__nodeToItemMap[b.node.id];var a=this.__selectedObjects.indexOf(b.representedObject);if(-1!==a){this.__selectedObjects.removeObjectAtIndex(a)}if(!b.expanded){return}b.expanded=false;b.representedObject.removeObserverForKeyPath(this,this.childrenKeyPath);b.childNodes.forEach(this.__disposeItem,this);b.childNodes=null},__updateChildrenForItem:function(k,d){var b=this.container();var h=k.childNodes;var e=h.length;var a=d.length;var f=Math.min(e,a);var g=0;var c;while(g<f){this.updateItemWithRepresentedObject(h[g],d[g]);++g}if(g<a){var j=document.createDocumentFragment();while(g<a){c=this.newItemForRepresentedObject(d[g],k);h.push(c);j.appendChild(c.node);++g}b.appendChild(j)}else{while(g<e){this.__disposeItem(h[g]);++g}h.length=a}},__collapseItem:function(a){if(!a||a.leaf||!a.expanded){return}a.expanded=false;a.representedObject.removeObserverForKeyPath(this,this.childrenKeyPath);Element.removeClassName(a.node,coherent.Style.kOutlineExpanded);a.childNodes.forEach(this.__disposeItem,this);a.childNodes=null},__expandItem:function(d){if(!d||d.leaf||d.expanded){return}d.expanded=true;d.representedObject.addObserverForKeyPath(this,"observeNodeChildrenChange",this.childrenKeyPath);var c=d.representedObject.valueForKeyPath(this.childrenKeyPath);var e=document.createDocumentFragment();function b(g){var f=this.newItemForRepresentedObject(g,d);e.appendChild(f.node);return f}d.childNodes=c.map(b,this);var a=this.container();a.insertBefore(e,d.node.nextSibling);Element.addClassName(d.node,coherent.Style.kOutlineExpanded)},content:function(){return this.__content},setContent:function(b){if(this.__rootItem){this.__disposeItem(this.__rootItem)}this.__rootItem=b?this.newItemForRepresentedObject(b):null;this.__content=b;var a=this.container();if(this.__rootItem){a.appendChild(this.__rootItem.node)}},selectedObject:function(){return this.__selectedObjects[0]},setSelectedObject:function(a){this.setSelectedObjects(a?[a]:[])},selectedObjects:function(){return this.__selectedObjects},setSelectedObjects:function(a){var d=this.__animationOptionsForProperty("selection");function b(e){var f=this.__objectToItemMap[e.__uid];f.selected=false;f.view.animateClassName(d,!f.selected)}function c(e){var f=this.__objectToItemMap[e.__uid];f.selected=true;f.view.animateClassName(d,!f.selected)}if(a){a=a.copy()}else{a=[]}this.__selectedObjects.forEach(b,this);this.__selectedObjects=a;this.__selectedObjects.forEach(c,this)},infoFromEvent:function(b){var c=b.target||b.srcElement;var a=this.container();var d=false;if(c===a){return null}while(c&&c.parentNode!=a){if(Element.hasClassName(c,this.disclosureButtonClassName)){d=true}c=c.parentNode}if(c===a){return null}return{node:c,disclosure:d}},onclick:function(d){var c=this.node;if(c.disabled){this.base(d);Event.stop(d);return}var e=this.infoFromEvent(d);if(!e){return}var b=this.__nodeToItemMap[e.node.id];if(!b.leaf&&(!b.hasDisclosureButton||e.disclosure)){var a=this.__selectedObjects.length;if(b.expanded){this.__collapseItem(b)}else{this.__expandItem(b)}if(this.__selectedObjects.length!==a){if(this.bindings.selectedObject){this.bindings.selectedObject.setValue(this.__selectedObjects[0])}if(this.bindings.selectedObjects){this.bindings.selectedObjects.setValue(this.__selectedObjects)}}Event.preventDefault(d);return}this.setSelectedObjects([b.representedObject]);if(this.bindings.selectedObject){this.bindings.selectedObject.setValue(b.representedObject)}if(this.bindings.selectedObjects){this.bindings.selectedObjects.setValue([b.representedObject])}this.sendAction()}});coherent.PopupList=Class.create(coherent.FormControl,{exposedBindings:["content","contentObjects","contentValues","selectedIndex","selectedObject","selectedValue"],constructor:function(b,a){this.base(b,a);this.__content=[];this.__selectedIndex=-1;this.__selectedValue=null;this.__selectedObject=null},acceptsFirstResponder:function(){var a=this.node;return !(a.disabled||a.readOnly)},onchange:function(c){var b=this.node;var a=b.selectedIndex;this.setSelectedIndex(a);if(this.bindings.selectedIndex){this.bindings.selectedIndex.setValue(a)}if(this.bindings.selectedObject){this.bindings.selectedObject.setValue(this.selectedObject())}if(this.bindings.selectedValue){this.bindings.selectedValue.setValue(this.selectedValue())}},content:function(){return this.__content},setContent:function(a){this.__content=a?a.copy():[];this.__scheduleUpdate()},observeContentChange:function(a){switch(a.changeType){case coherent.ChangeType.setting:this.setContent(a.newValue);break;case coherent.ChangeType.insertion:this.__content.insertObjectsAtIndexes(a.newValue,a.indexes);this.__scheduleUpdate();break;case coherent.ChangeType.deletion:this.__content.removeObjectsAtIndexes(a.indexes);this.__scheduleUpdate();break;case coherent.ChangeType.replacement:this.__content.replaceObjectsAtIndexesWithObjects(a.indexes,a.newValue);this.__scheduleUpdate();break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+a.changeType);break}},contentValues:function(){return this.__contentValues},setContentValues:function(a){this.__contentValues=a?a.copy():[];this.__scheduleUpdate()},observeContentValuesChange:function(a){switch(a.changeType){case coherent.ChangeType.setting:this.setContentValues(a.newValue);break;case coherent.ChangeType.insertion:this.__contentValues.insertObjectsAtIndexes(a.newValue,a.indexes);this.__scheduleUpdate();break;case coherent.ChangeType.deletion:this.__contentValues.removeObjectsAtIndexes(a.indexes);this.__scheduleUpdate();break;case coherent.ChangeType.replacement:this.__contentValues.replaceObjectsAtIndexesWithObjects(a.indexes,a.newValue);this.__scheduleUpdate();break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+a.changeType);break}},contentObjects:function(){return this.__contentObjects},setContentObjects:function(a){this.__contentObjects=a?a.copy():[];this.__scheduleUpdate()},observeContentObjectsChange:function(a){switch(a.changeType){case coherent.ChangeType.setting:this.setContentObjects(a.newValue);break;case coherent.ChangeType.insertion:this.__contentObjects.insertObjectsAtIndexes(a.newValue,a.indexes);this.__scheduleUpdate();break;case coherent.ChangeType.deletion:this.__contentObjects.removeObjectsAtIndexes(a.indexes);this.__scheduleUpdate();break;case coherent.ChangeType.replacement:this.__contentObjects.replaceObjectsAtIndexesWithObjects(a.indexes,a.newValue);this.__scheduleUpdate();break;case coherent.ChangeType.validationError:break;default:console.log("Unknown change type: "+a.changeType);break}},selectedIndex:function(){return this.__selectedIndex},setSelectedIndex:function(a){var c=this.content();var d=this.contentValues()||c.valueForKey("description");var b=this.node;this.__selectedIndex=Math.min(c.length-1,Math.max(-1,a));b.selectedIndex=this.__selectedIndex;if(-1===this.__selectedIndex){this.__selectedValue=null;this.__selectedObject=null}else{this.__selectedObject=c[this.__selectedIndex];this.__selectedValue=d[this.__selectedIndex]}},selectedValue:function(){return this.__selectedValue},setSelectedValue:function(e){var c=this.content();var d=this.contentValues()||c.valueForKey("description");var b=this.node;this.__selectedValue=e;var a=d.indexOf(e);b.selectedIndex=this.__selectedIndex=a;if(-1===a){this.__selectedObject=null}else{this.__selectedObject=c[a]}},selectedObject:function(){return this.__selectedObject},setSelectedObject:function(b){var d=this.content();var e=this.contentValues()||d.valueForKey("description");var c=this.node;this.__selectedObject=b;var a=d.indexOf(b);c.selectedIndex=this.__selectedIndex=a;if(-1===a){this.__selectedValue=null}else{this.__selectedValue=e[a]}},__updateOptions:function(){if(this.__updateTimer){this.__updateTimer.cancel();this.__updateTimer=null}var e=this.content()||[];var a=this.contentObjects()||e;var f=this.contentValues()||e.valueForKey("description");var b=e.length;var d=this.node;var g;d.innerHTML="";d.options.length=b;for(var c=0;c<b;++c){g=d.options[c];if(coherent.Browser.IE){g.innerText=f[c]}else{g.text=f[c]}g.value=String(a[c]);g.selected=false;if((this.__selectedObject&&e[c]===this.__selectedObject)||(this.__selectedValue&&a[c]===this.__selectedValue)||(c===this.__selectedIndex)){this.__selectedIndex=c;this.__selectedValue=a[c];this.__selectedObject=e[c];g.selected=true}}d.selectedIndex=this.__selectedIndex},__scheduleUpdate:function(){if(this.__updateTimer){return}this.__updateTimer=Function.delay(this.__updateOptions,0,this)}});if(coherent.Browser.IE){Class.extend(coherent.PopupList,{onfocus:function(b){var a=this.node;Event.stopObserving(a,"change",this.__onchangeHandler);this.__onchangeHandler=Event.observe(a,"change",this.onchange.bind(this))},onblur:function(a){Event.stopObserving(this.node,"change",this.__onchangeHandler)}})}coherent.TextField=Class.create(coherent.FormControl,{init:function(){this.base();if(""===this.node.value){this.showPlaceholder()}this.editing=false;this.validationError=null},exposedBindings:["errorMessage"],maskedBindings:["text","html"],defaultPlaceholders:{value:{nullValue:_("marker.input.placeholder"),multipleValues:_("marker.input.multipleValues"),noSelection:_("marker.input.noSelection")}},animationOptions:{placeholder:{classname:coherent.Style.kMarkerClass}},keypressUpdateTimeout:500,continuallyUpdatesValue:true,sendsActionOnEndEditing:true,sendActionOn:["blur","keydown"],beginEditing:function(){this.editing=true},endEditing:function(){this.editing=false;if(this.sendsActionOnEndEditing&&this.action){this.sendAction()}var a=this.node;if(""===a.value){this.showPlaceholder()}if(!this.validationError&&!this.__showingPlaceholder&&this.formatter){var b=this.formatter.valueForString(a.value);b=this.formatter.stringForValue(b);a.value=b}},presentError:function(a){this.validationError=a;Element.addClassName(this.node,coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},clearAllErrors:function(){this.validationError=null;Element.removeClassName(this.node,coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},acceptsFirstResponder:function(){var a=this.node;if(a.disabled||a.readOnly){return false}return true},becomeFirstResponder:function(){var a=this.node;if(a.disabled||a.readOnly){return false}if(this.__showingPlaceholder){Function.delay(this.setSelectedRange,0,this,[0,0])}this.hasFocus=true;this.beginEditing();return true},resignFirstResponder:function(b){var a=this.node;this.hasFocus=false;this.endEditing();return true},showPlaceholder:function(){if(!this.placeholder){return}this.node.value=String(this.placeholder);this.__showingPlaceholder=true;this.animateClassName(this.__animationOptionsForProperty("placeholder"))},hidePlaceholder:function(){if(!this.__showingPlaceholder){return}var a=this.node;if(a.value===this.placeholder){a.value=""}this.__showingPlaceholder=false;this.animateClassName(this.__animationOptionsForProperty("placeholder"),true)},value:function(){if(this.__showingPlaceholder){return""}if(this.formatter){return this.formatter.valueForString(this.node.value)}return this.node.value},setValue:function(b){var a=this.bindings.value&&this.bindings.value.markerType;if(a){b=String(b);if(b){this.placeholder=b}this.node.value="";this.showPlaceholder()}else{if(this.formatter){b=this.formatter.stringForValue(b)}this.node.value=b;this.hidePlaceholder()}},selectedRange:function(){var c=this.node;if(!c){return{start:0,end:0}}if(coherent.Browser.IE){var e=document.selection.createRange();var b=e.duplicate();b.moveToElementText(c);b.setEndPoint("EndToStart",e);var d=b.text.length;var a=d+e.text.length;return{start:d,end:a}}else{return{start:c.selectionStart,end:c.selectionEnd}}},setSelectedRange:function(d,a){var c=this.node;if(!c){return}if(this.__showingPlaceholder){d=a=0}a=Math.max(d,a);if(coherent.Browser.IE){var b=c.createTextRange();b.moveStart("textedit",-1);b.moveEnd("textedit",-1);b.moveStart("character",d);b.moveEnd("character",a-d);b.select()}else{c.selectionStart=d;c.selectionEnd=a}},onchange:function(a){if(this.updateTimer){this.updateTimer.cancel()}var b=this.validate();if(!(b instanceof coherent.Error)&&this.bindings.value){this.bindings.value.setValue(b);if(this.validationError){this.clearAllErrors()}}},onkeyup:function(d){var f=d.keyCode;if(this.accessoryView&&Event.KEY_ESCAPE===f){this.hideAccessoryView();return}if(Event.isAlphaNumKey(f)||Event.KEY_SPACE===f||Event.KEY_BACKSPACE===f||Event.KEY_DELETE===f){var c=this.delegate();if(c&&c.completionsForFieldWithText){var e=this.node.value;var b=c.completionsForFieldWithText(this,e);if(!b){this.hideAccessoryView()}else{var g=b[0];if(Event.KEY_BACKSPACE!==f&&Event.KEY_DELETE!==f&&"string"===typeof(g)&&g.toLowerCase().beginsWith(e.toLowerCase())){this.node.value=g;this.setSelectedRange(e.length,g.length)}this.showAccessoryViewForCompletions(b)}}}if(!this.continuallyUpdatesValue){return}var a=this.node;if(this.updateTimer){this.updateTimer.cancel()}if(a.readOnly||a.disabled){return}this.updateTimer=Function.delay(this.onchange,this.keypressUpdateTimeout,this)},onkeydown:function(a){this.hidePlaceholder();var b=a.keyCode;if(this.accessoryView&&Event.KEY_TAB===b){this.hideAccessoryView()}if(this.action&&Event.KEY_ENTER===b){this.onchange(null);if(this.validationError){return}this.sendAction();Event.stop(a)}},onkeypress:function(a){if(!this.formatter){return}if(!a.charCode||a.altKey||a.metaKey||a.ctrlKey){return}var b=String.fromCharCode(a.charCode||a.keyCode);if(!this.formatter.isValidInputCharacter(b)){Event.stop(a)}},observeErrorMessageChange:function(b){if(!b.newValue){this.clearAllErrors();return}var a=new coherent.Error({description:b.newValue});this.presentError(a)},__completionSelected:function(a){var b=a.selectionIndexes();var c=a.content();var d=c.objectAtIndex(b[0]);this.setValue(d);this.accessoryView.setVisible(false);coherent.page.makeFirstResponder(this)},showAccessoryViewForCompletions:function(b){if(!this.accessoryView){var a=new coherent.Bubble(null,{relativePosition:"below",clickOutsideToDismiss:true});a.node.tabIndex=-1;a.attachToView(this);a.constrainToView(this);a.setNextResponder(this);a.acceptsFirstResponder=function(){console.log("view first?");return true};a.becomeFirstResponder=function(){console.log("become...");Function.delay(function(){coherent.page.makeFirstResponder(this.nextResponder());return true},0,this)};var c=document.createElement("ul");c.innerHTML="<li></li>";var d=new coherent.CollectionView(c,{action:"__completionSelected",viewTemplate:VIEW({":root":coherent.View({textBinding:"representedObject"})})});d.acceptsFirstResponder=function(){console.log("list first?");return false};a.addSubview(d);a.completionsList=d;this.accessoryView=a}this.accessoryView.completionsList.setContent(b);this.accessoryView.setVisible(true)},hideAccessoryView:function(){if(this.accessoryView){this.accessoryView.setVisible(false)}}});coherent.SearchField=Class.create(coherent.TextField,{exposedBindings:["predicate"],onfocus:function(b){var a=this.node;Event.stopObserving(a,"search",this.__searchHandler);this.__searchHandler=Event.observe(a,"search",this.onchange.bind(this))},onblur:function(a){Event.stopObserving(this.node,"search",this.__searchHandler)},keypressUpdateTimeout:25,onchange:function(a){this.base(a);if(this.bindings.predicate){this.bindings.predicate.setValue(this.createFilterPredicate())}},createFilterPredicate:function(){var a=this.node;var d=this.predicate;var c=a.value.toLowerCase();function b(f){var e=f.valueForKeyPath(d);if(!e){return !!c}if(e.toLocaleString){e=e.toLocaleString()}else{e=e.toString()}e=e.toLowerCase();return(-1!==e.indexOf(c))}return b},observePredicateChange:function(a){}});coherent.SegmentedControl=Class.create(coherent.View,{exposedBindings:["selectedIndex","selectedLabel"],segmentSelector:"button",init:function(){this.__selectedIndex=-1;var b=Element.queryAll(this.node,this.segmentSelector);var a=b.length;for(var c=0;c<a;++c){b[c].segmentIndex=c}},selectedIndex:function(){return this.__selectedIndex},setSelectedIndex:function(b){var a=Element.queryAll(this.node,this.segmentSelector);if("number"!==typeof(b)||b<-1||b>=a.length){return}this.willChangeValueForKey("selectedLabel");if(-1!==this.__selectedIndex){Element.removeClassName(a[this.__selectedIndex],coherent.Style.kSelectedClass)}this.__selectedIndex=b;if(-1!==this.__selectedIndex){Element.addClassName(a[this.__selectedIndex],coherent.Style.kSelectedClass)}if(this.bindings.selectedIndex){this.bindings.selectedIndex.setValue(b)}if(this.bindings.selectedLabel){this.bindings.selectedLabel.setValue(this.selectedLabel())}this.didChangeValueForKey("selectedLabel")},selectedLabel:function(){if(-1===this.__selectedIndex){return""}var a=Element.queryAll(this.node,this.segmentSelector);var b=a[this.__selectedIndex];if(!b){return""}return b.textContent||b.innerText},onclick:function(b){var a=this.node;var c=b.target||b.srcElement;while(c&&c!=a&&!("segmentIndex" in c)){c=c.parentNode}if(!c||c===a){return}Event.preventDefault(b);this.setSelectedIndex(c.segmentIndex);this.sendAction()}});coherent.Slider=Class.create(coherent.FormControl,{exposedBindings:["minValue","maxValue","incrementValue"],handleSelector:"a",init:function(){this.base();this.nativeInput=("INPUT"===this.node.tagName);if(!this.nativeInput){this.handle=Element.query(this.node,this.handleSelector)}},value:function(){return parseInt(this.node.value||0,10)},setValue:function(d){var c=this.node;var b=this.incrementValue();d=Math.floor(parseInt(d||0,10)/b)*b;c.value=d;if(this.nativeInput){return}this.__updateCurrentMetrics();var a=(d-this.minValue())/b*this.__stepWidth+this.__paddingLeft;this.handle.style.left=a.toFixed(3)+"px"},onchange:function(a){var b=parseInt(this.node.value,10);if(this.bindings.value){this.bindings.value.setValue(b)}},minValue:function(){return parseInt(this.node.getAttribute("min"),10)},setMinValue:function(b){var a=this.node;b=parseInt(b||0,10);a.setAttribute("min",b);if(this.bindings.value){var c=this.bindings.value.value();if(c>b){this.setValue(c)}}},maxValue:function(){return parseInt(this.node.getAttribute("max"),10)},setMaxValue:function(b){var a=this.node;b=parseInt(b||0,10);a.setAttribute("max",b);if(this.bindings.value){var c=this.bindings.value.value();if(c<b){this.setValue(c)}}},incrementValue:function(){return parseInt(this.node.getAttribute("step"),10)||1},setIncrementValue:function(c){var a=this.node;var b=this.value();c=parseInt(c||0,10)||1;a.setAttribute("step",c);b=Math.floor(b/c)*c;this.setValue(b)},updateHandlePosition:function(c){var b=this.__currentRect;var a=c.clientX-b.left-this.__handleWidth/2;if(a<0){a=0}else{if(a+this.__handleWidth>b.width){a=b.width-this.__handleWidth}}var d=Math.round(a/this.__stepWidth);a=d*this.__stepWidth+this.__paddingLeft;this.handle.style.left=a.toFixed(3)+"px";if(this.bindings.value){this.bindings.value.setValue(d*this.incrementValue()+this.minValue())}},__updateCurrentMetrics:function(){var b=this.node;var a=this.__currentRect=Element.getRect(b,true);var c=Element.getStyles(b,["paddingRight","paddingLeft"]);c.paddingLeft=parseInt(c.paddingLeft||0,10);c.paddingRight=parseInt(c.paddingRight||0,10);a.left+=c.paddingLeft;a.right-=c.paddingRight;a.width-=(c.paddingLeft+c.paddingRight);this.__paddingLeft=c.paddingLeft;this.__handleWidth=this.handle.offsetWidth;this.__stepWidth=(this.__currentRect.width-this.__handleWidth)/(this.maxValue()-this.minValue())*this.incrementValue();if(isNaN(this.__stepWidth)){this.__stepWidth=1}},onmousedown:function(b){var a=this.node;if(this.nativeInput||a.readOnly||a.disabled){return}this.__updateCurrentMetrics();this.updateHandlePosition(b);Event.preventDefault(b)},onmousedrag:function(b){var a=this.node;if(this.nativeInput||a.readOnly||a.disabled){return}this.updateHandlePosition(b)},onmouseup:function(b){var a=this.node;if(this.nativeInput||a.readOnly||a.disabled){return}this.updateHandlePosition(b)},onclick:function(a){Event.preventDefault(a)}});coherent.TableHeader=Class.create(coherent.View,{exposedBindings:["sortDescriptors"],constructor:function(b,a){this.base(b,a);this.__selectedColumn=-1},sortKeys:function(){return this.__sortKeys},setSortKeys:function(c){this.__sortKeys=(c=c?c.copy():[]);var a=c.length;var b;this.__sortKeyIndex={};for(b=0;b<a;++b){if(!c[b]){continue}this.__sortKeyIndex[c[b]]=b}},selectedColumn:function(){return this.__selectedColumn},setSelectedColumn:function(c){var b=this.node;if(!b.rows.length){return}if(this.__selectedColumn===c){return}var e;var d=b.rows[0];if(-1!==this.__selectedColumn){e=d.cells[this.__selectedColumn];var a=e.__ascending?coherent.Style.kAscendingClass:coherent.Style.kDescendingClass;Element.updateClass(e,[],[coherent.Style.kSelectedClass,a])}this.__selectedColumn=c;if(-1!==this.__selectedColumn){e=d.cells[this.__selectedColumn];if("undefined"===typeof(e.__ascending)){e.__ascending=true}var f=e.__ascending?coherent.Style.kAscendingClass:coherent.Style.kDescendingClass;var g=e.__ascending?coherent.Style.kDescendingClass:coherent.Style.kAscendingClass;Element.updateClass(e,[coherent.Style.kSelectedClass,f],g)}},onclick:function(a){var i=this.node;var g=a.target||a.srcElement;var f=i.rows[0];while(g&&g.parentNode!==f){g=g.parentNode}if(!g){return}var h=g.cellIndex;var e=this.__sortKeys[h];if(!e){return}if(this.__selectedColumn==h){g.__ascending=g.__ascending?false:true;var d=coherent.Style.kAscendingClass;var c=coherent.Style.kDescendingClass;if(g.__ascending){Element.updateClass(g,d,c)}else{Element.updateClass(g,c,d)}}else{this.setSelectedColumn(h)}var b=new coherent.SortDescriptor(e,g.__ascending?true:false);if(this.bindings.sortDescriptors){this.bindings.sortDescriptors.setValue([b])}},observeSortDescriptorsChange:function(c){var b=c.newValue;if(!b||!b.length||b.length>1){this.setSelectedColumn(-1);return}var a=this.__sortKeyIndex[b[0].keyPath];if("undefined"===typeof(a)||null===a){a=-1}this.setSelectedColumn(a)}});coherent.ToggleButton=Class.create(coherent.FormControl,{exposedBindings:["checked","selection"],onclick:function(c){var a=this.node;var b=a.checked;var d=a.value;if(this.bindings.selection){this.bindings.selection.setValue(d)}if(this.bindings.checked){this.bindings.checked.setValue(b)}this.sendAction()},observeValueChange:function(c){this.base(c);var a=this.node;var b=c.newValue;a.value=b;if(!this.bindings.selection){return}a.checked=(this.bindings.selection.value()==b);if(this.bindings.checked){this.bindings.checked.setValue(a.checked)}},observeCheckedChange:function(e,d,b){var a=this.node;var c=!!e.newValue;a.checked=c;if(this.bindings.selection){this.bindings.selection.setValue(a.value)}},observeSelectionChange:function(e,d,b){var a=this.node;var c=(e.newValue==a.value);a.checked=c;if(this.bindings.checked){this.bindings.checked.setValue(c)}}});coherent.Video=Class.create(coherent.Media,{exposedBindings:["poster","height","width"],poster:function(){return this.node.poster},setPoster:function(a){if(this.bindings.poster){this.bindings.poster.setValue(a)}this.node.poster=a},width:function(){return parseInt(this.node.width,10)},setWidth:function(c){var b=this.node;var a=parseInt(c,10);if(isNaN(a)){b.removeAttribute("width")}else{b.width=a}},height:function(){return parseInt(this.node.height,10)},setHeight:function(b){var c=this.node;var a=parseInt(b,10);if(isNaN(a)){c.removeAttribute("height")}else{c.height=a}}});coherent.VideoLegacy=Class.create(coherent.View,{exposedBindings:["src","currentTime","volume","muted","autoplay","playing","controls","loop","height","width"],constructor:function(a,d,c){if(window.dashcode.inDesign){return}function b(h,e,g){var f=h.getElementsByTagName(e);if(f&&f.length&&g<f.length){return f[g]}return null}this._object=b(a,"object",coherent.Browser.IE?1:0);this._embed=b(a,"embed",0);this.setContainer(a);this._mediaElement=a;this.base(a,d);this._mediaElement=this._object;if(c.getAttribute("src")&&!coherent.Browser.MobileSafari){this.setSrc(c.getAttribute("src"))}this.setLoop(!(c.getAttribute("loop")===null)?true:false);this.setAutoplay(!(c.getAttribute("autoplay")===null)?true:false);this.setControls(!(c.getAttribute("controls")===null)?true:false);this._signupForEvents()},init:function(){this.base();if(this.initialVolume){this.setVolume(this.initialVolume)}},teardown:function(){this._mediaElement=null;this.base()},viewElement:function(){return this._mediaElement},superview:function(){var a=null;var b=this.viewElement;this.viewElement=function(){return this.container()};a=this.base();this.viewElement=b;return a},_signupForEvents:function(){var b=this;var a=this.node;this._eventsSetup=true;Event.observe(a,"qt_canplay",function(c){b._canPlay=true;if(b._pendingPlay){window.setTimeout(function(){if(b._pendingPlay){b.play()}},1000)}});Event.observe(a,"qt_volumechange",function(c){b.forceChangeNotificationForKey("volume")});Event.observe(a,"qt_ended",function(c){b.forceChangeNotificationForKey("ended")});Event.observe(a,"qt_play",function(c){b._playing=true;b.forceChangeNotificationForKey("playing")});Event.observe(a,"qt_pause",function(c){b._playing=false;b.forceChangeNotificationForKey("playing")})},_setParameter:function(a,c){if(this._object){var h=this._object.getElementsByTagName("param");var g=null;for(var b=0;b<h.length;b++){var f=h.item(b);if(f.name==a){g=f;break}}try{g.value=c}catch(d){console.log("Failed to set param "+a+" to "+c)}}if(this._embed){if(c===true){c="true"}else{if(c===false){c="false"}}this._embed.setAttribute(a,c)}},_getParameter:function(a){if(this._object){var f=this._object.getElementsByTagName("param");var e=null;var c=null;for(var b=0;b<f.length;b++){var d=f.item(b);if(d.name==a){e=d;break}}if(e){c=e.value}}if(!c&&this._embed){c=this._embed.getAttribute(a)}if(c&&!c.length){c=null}else{if(c=="true"){c=true}else{if(c=="false"){c=false}}}return c},_plugin:function(){if(this._object&&("GetURL" in this._object)){return this._object}if(this._embed&&("GetURL" in this._embed)){return this._embed}return null},_safePluginCall:function(c){var a=null;var f=false;var b=this._plugin();try{if(b&&(c in b)){if(arguments.length==1){a=b[c]()}else{if(arguments.length==2){a=b[c](arguments[1])}}f=true}}catch(d){a=null;f=false}return{success:f,returnValue:a}},_pluginGetter:function(a,c){var b=this._safePluginCall(a);if(b.success){return b.returnValue}if(c){return this._getParameter(c)}return null},_pluginSetter:function(f,c,d,b){var a=this._plugin();var e=false;if(!b){b=c}if(this.exposedBindings[b]&&this.bindings[b]){this.bindings[b].setValue(d)}e=this._safePluginCall(f,d).success;if(c){this._setParameter(c,d)}return e},play:function(){if(this._canPlay||coherent.Browser.MobileSafari){this._pendingPlay=false;this._safePluginCall("Play")}else{this._pendingPlay=true}},playing:function(){return this._playing},pause:function(){this._pluginGetter("Stop",null)},stop:function(){this._safePluginCall("Stop");this._safePluginCall("Rewind")},muted:function(){return this._pluginGetter("GetMute",null)},setMuted:function(a){this._pluginSetter("SetMute",null,a?true:false,"muted")},volume:function(){var b=1;var a=this._safePluginCall("GetVolume");if(a.success){b=a.returnValue/255}return b},setVolume:function(a){if(a===null){a=1}this._safePluginCall("SetVolume",a*255)},mediaDidEnd:function(a){this._playing=false;this.forceChangeNotificationForKey("playing");this.forceChangeNotificationForKey("ended")},ended:function(){var a=this._safePluginCall("GetEndTime").returnValue;var b=this._safePluginCall("GetTime").returnValue;return(a==b)},autoplay:function(){return this._pluginGetter("GetAutoPlay","autoplay")},setAutoplay:function(a){var b=this._safePluginCall("GetTime");this._pluginSetter("SetAutoPlay","autoplay",a?true:false);if(a&&!this.playing()&&(!b.success||!b.returnValue)){this.play()}},controls:function(){return this._pluginGetter("GetControllerVisible","controller")},setControls:function(a){this._pluginSetter("SetControllerVisible","controller",a?true:false,"controls")},loop:function(){return this._pluginGetter("GetIsLooping","loop")},setLoop:function(a){this._pluginSetter("SetIsLooping","loop",a?true:false)},src:function(){return this._pluginGetter("GetURL","src")},setSrc:function(a){this._pluginSetter("SetResetPropertiesOnReload",null,false,null);this._pluginSetter("SetURL","src",a?a:"","src")},poster:function(){return null},setPoster:function(a){}});coherent.ViewController=Class.create(coherent.Responder,{view:function(){return this.__view},setView:function(a){if(this.__view){this.__view.setNextResponder(null)}if("string"===typeof(a)){a=this.__context.valueForKeyPath(a)}this.__view=a;a.setNextResponder(this)},loadView:function(){var a=this.valueForKey("nibUrl");if(!a){throw new Error("No URL specified for ViewController NIB.")}return NIB.load(a,this)},nextResponder:function(){return this.__nextResponder||this.__view.superview()}});